<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: PStore &mdash; pstore  Ruby-2.1.10 p492</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "PStore",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
        <a href='../../index.html'>Home</a> &raquo; 
        <a href='../index.html'>Ruby-2.1.10</a> &raquo; 
        <a href='index.html'>pstore</a> &raquo; 
        <a href='_index.html#alpha_P'>Index (P)</a> &raquo; 
        <span class='title'><a id='t2_doc_top' href='#'>PStore&nbsp;&#x25B2;</a></span>
      </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: PStore</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="PStore/Error.html" title="PStore::Error (class)">Error</a>      </div>
    </td></tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L93'>lib/pstore.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>PStore</code> implements a file based persistence mechanism based on
a Hash.  User code can store hierarchies of Ruby objects (values) into the
data store file by name (keys).  An object hierarchy may be just a single
object.  User code may later read values back from the data store or even
update data, as needed.</p>

<p>The transactional behavior ensures that any changes succeed or fail
together. This can be used to ensure that the data store is not left in a
transitory state, where some values were updated but others were not.</p>

<p>Behind the scenes, Ruby objects are stored to the data store file with
Marshal.  That carries the usual limitations.  Proc objects cannot be
marshalled, for example.</p>

<h3 id="label-Usage+example-3A">Usage example:</h3>

<pre class="code ruby"><code class="ruby">require &quot;pstore&quot;

# a mock wiki object...
class WikiPage
  def initialize( page_name, author, contents )
    @page_name = page_name
    @revisions = Array.new

    add_revision(author, contents)
  end

  attr_reader :page_name

  def add_revision( author, contents )
    @revisions &lt;&lt; { :created  =&gt; Time.now,
                    :author   =&gt; author,
                    :contents =&gt; contents }
  end

  def wiki_page_references
    [@page_name] + @revisions.last[:contents].scan(/\b(?:[A-Z][a-z]){2,}/)
  end

  # ...
end

# create a new page...
home_page = WikiPage.new( &quot;HomePage&quot;, &quot;James Edward Gray II&quot;,
                          &quot;A page about the JoysOfDocumentation...&quot; )

# then we want to update page data and the index together, or not at all...
wiki = &lt;code&gt;PStore&lt;/code&gt;.new(&quot;wiki_pages.pstore&quot;)
wiki.transaction do  # begin transaction; do all of this or none of it
  # store page...
  wiki[home_page.page_name] = home_page
  # ensure that an index has been created...
  wiki[:wiki_index] ||= Array.new
  # update wiki index...
  wiki[:wiki_index].push(*home_page.wiki_page_references)
end                   # commit changes to wiki data store file

### Some time later... ###

# read wiki data...
wiki.transaction(true) do  # begin read-only transaction, no changes allowed
  wiki.roots.each do |data_root_name|
    p data_root_name
    p wiki[data_root_name]
  end
end</code></pre>

<h3 id="label-Transaction+modes">Transaction modes</h3>

<p>By default, file integrity is only ensured as long as the operating system
(and the underlying hardware) doesn&#39;t raise any unexpected I/O errors.
If an I/O error occurs while <code>PStore</code> is writing to its file,
then the file will become corrupted.</p>

<p>You can prevent this by setting <em>pstore.ultra_safe = true</em>. However,
this results in a minor performance loss, and only works on platforms that
support atomic file renames. Please consult the documentation for
<a href="#ultra_safe-instance_method" title="PStore#ultra_safe (method)">#ultra_safe</a> for details.</p>

<p>Needless to say, if you&#39;re storing valuable data with
<code>PStore</code>, then you should backup the <code>PStore</code> files
from time to time.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='EMPTY_MARSHAL_CHECKSUM-constant' class='summary_signature'>EMPTY_MARSHAL_CHECKSUM =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L356-L356'># File 'lib/pstore.rb', line 356</a>    <pre class='code ruby'><span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span><span class='lparen'>(</span><span class='const'><a href="#EMPTY_MARSHAL_DATA-constant" title="PStore::EMPTY_MARSHAL_DATA (constant)">EMPTY_MARSHAL_DATA</a></span><span class='rparen'>)</span></pre>
  </li>
  <li>
    <span id='EMPTY_MARSHAL_DATA-constant' class='summary_signature'>EMPTY_MARSHAL_DATA =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L355-L355'># File 'lib/pstore.rb', line 355</a>    <pre class='code ruby'><span class='const'>Marshal</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span></pre>
  </li>
  <li>
    <span id='EMPTY_STRING-constant' class='summary_signature'>EMPTY_STRING =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Constant for relieving Ruby&#39;s garbage collector.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L354-L354'># File 'lib/pstore.rb', line 354</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='RDWR_ACCESS-constant' class='summary_signature'>RDWR_ACCESS =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L94-L94'># File 'lib/pstore.rb', line 94</a>    <pre class='code ruby'><span class='lbrace'>{</span><span class='label'>mode:</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>RDWR</span> <span class='op'>|</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>CREAT</span> <span class='op'>|</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>BINARY</span><span class='comma'>,</span> <span class='label'>encoding:</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ASCII_8BIT</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='RD_ACCESS-constant' class='summary_signature'>RD_ACCESS =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L95-L95'># File 'lib/pstore.rb', line 95</a>    <pre class='code ruby'><span class='lbrace'>{</span><span class='label'>mode:</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>RDONLY</span> <span class='op'>|</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>BINARY</span><span class='comma'>,</span> <span class='label'>encoding:</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ASCII_8BIT</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='WR_ACCESS-constant' class='summary_signature'>WR_ACCESS =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L96-L96'># File 'lib/pstore.rb', line 96</a>    <pre class='code ruby'><span class='lbrace'>{</span><span class='label'>mode:</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WRONLY</span> <span class='op'>|</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>CREAT</span> <span class='op'>|</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>TRUNC</span> <span class='op'>|</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>BINARY</span><span class='comma'>,</span> <span class='label'>encoding:</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ASCII_8BIT</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(file, thread_safe = false)  &#x21d2; PStore </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>To construct a <code>PStore</code> object, pass in the <em>file</em> path
where you would like the data to be stored.</p></div>
    </div>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#ultra_safe-instance_method" title="#ultra_safe (instance method)">#<strong>ultra_safe</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether PStore should do its best to prevent file corruptions, even when
under unlikely-to-occur error conditions such as out-of-space conditions
and other unusual OS filesystem errors.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#on_windows%3F-instance_method" title="#on_windows? (instance method)">#<strong>on_windows?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(name)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Retrieves a value from the <code>PStore</code> file data, by <em>name</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]=-instance_method" title="#[]= (instance method)">#<strong>[]=</strong>(name, value)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Stores an individual Ruby object or a hierarchy of Ruby objects in the data
store file under the root <em>name</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#abort-instance_method" title="#abort (instance method)">#<strong>abort</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Ends the current <a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>, discarding any changes to the data
store.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#commit-instance_method" title="#commit (instance method)">#<strong>commit</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Ends the current <a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>, committing any changes to the data
store immediately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>(name)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Removes an object hierarchy from the data store, by <em>name</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fetch-instance_method" title="#fetch (instance method)">#<strong>fetch</strong>(name, default = PStore::Error)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>This method is just like <a href="#[]-instance_method" title="PStore#[] (method)">#[]</a>, save that you may also provide a
<em>default</em> value for the object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#path-instance_method" title="#path (instance method)">#<strong>path</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the path to the data store file.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#root%3F-instance_method" title="#root? (instance method)">#<strong>root?</strong>(name)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if the supplied <em>name</em> is currently in the data store.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#roots-instance_method" title="#roots (instance method)">#<strong>roots</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the names of all object hierarchies currently in the store.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#transaction-instance_method" title="#transaction (instance method)">#<strong>transaction</strong>(read_only = false)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Opens a new transaction for the data store.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#empty_marshal_checksum-instance_method" title="#empty_marshal_checksum (instance method)">#<strong>empty_marshal_checksum</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#empty_marshal_data-instance_method" title="#empty_marshal_data (instance method)">#<strong>empty_marshal_data</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#in_transaction-instance_method" title="#in_transaction (instance method)">#<strong>in_transaction</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Raises <a href="PStore/Error.html" title="PStore::Error (class)">Error</a> if the calling code is not in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#in_transaction_wr-instance_method" title="#in_transaction_wr (instance method)">#<strong>in_transaction_wr</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Raises <a href="PStore/Error.html" title="PStore::Error (class)">Error</a> if the calling code is not in a <a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>
or if the code is in a read-only <a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#load_data-instance_method" title="#load_data (instance method)">#<strong>load_data</strong>(file, read_only)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Load the given <code>PStore</code> file.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#open_and_lock_file-instance_method" title="#open_and_lock_file (instance method)">#<strong>open_and_lock_file</strong>(filename, read_only)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Open the specified filename (either in read-only mode or in read-write
mode) and lock it for reading or writing.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#save_data-instance_method" title="#save_data (instance method)">#<strong>save_data</strong>(original_checksum, original_file_size, file)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#save_data_with_atomic_file_rename_strategy-instance_method" title="#save_data_with_atomic_file_rename_strategy (instance method)">#<strong>save_data_with_atomic_file_rename_strategy</strong>(data, file)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#save_data_with_fast_strategy-instance_method" title="#save_data_with_fast_strategy (instance method)">#<strong>save_data_with_fast_strategy</strong>(data, file)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(file, thread_safe = false)  &#x21d2; <code>PStore</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>To construct a <code>PStore</code> object, pass in the <em>file</em> path
where you would like the data to be stored.</p>

<p><code>PStore</code> objects are always reentrant. But if
<em>thread_safe</em> is set to true, then it will become thread-safe at the
cost of a minor performance hit.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L118-L131'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 118</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_thread_safe'>thread_safe</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='const'>File</span><span class='op'>::</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='const'>File</span><span class='op'>::</span><span class='id identifier rubyid_directory?'>directory?</span> <span class='id identifier rubyid_dir'>dir</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>PStore</span><span class='op'>::</span><span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span><span class='comma'>,</span> <span class='id identifier rubyid_format'>format</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>directory %s does not exist</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='const'>File</span><span class='op'>::</span><span class='id identifier rubyid_exist?'>exist?</span> <span class='id identifier rubyid_file'>file</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='const'>File</span><span class='op'>::</span><span class='id identifier rubyid_readable?'>readable?</span> <span class='id identifier rubyid_file'>file</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>PStore</span><span class='op'>::</span><span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span><span class='comma'>,</span> <span class='id identifier rubyid_format'>format</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file %s not readable</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='ivar'>@filename</span> <span class='op'>=</span> <span class='id identifier rubyid_file'>file</span>
  <span class='ivar'>@abort</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@ultra_safe</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@thread_safe</span> <span class='op'>=</span> <span class='id identifier rubyid_thread_safe'>thread_safe</span>
  <span class='ivar'>@lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="on_windows?-instance_method">
  <h3 class='signature ro priv first'>
    #<strong>on_windows?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L420-L426'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


420
421
422
423
424
425
426</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 420</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_on_windows?'>on_windows?</span>
  <span class='id identifier rubyid_is_windows'>is_windows</span> <span class='op'>=</span> <span class='const'>RUBY_PLATFORM</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>mswin|mingw|bccwin|wince</span><span class='regexp_end'>/</span></span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid___send__'>__send__</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_define_method'>define_method</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_windows?'>on_windows?</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_is_windows'>is_windows</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_is_windows'>is_windows</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ultra_safe-instance_method">
  <h3 class='signature rw'>
    #<strong>ultra_safe</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether PStore should do its best to prevent file corruptions, even when
under unlikely-to-occur error conditions such as out-of-space conditions
and other unusual OS filesystem errors. Setting this flag comes at the
price in the form of a performance loss.</p>

<p>This flag only has effect on platforms on which file renames are atomic
(e.g. all POSIX platforms: Linux, MacOS X, FreeBSD, etc). The default value
is false.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L109-L109'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


109</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 109</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ultra_safe'>ultra_safe</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="[]-instance_method">
  <h3 class='signature  first'>
    #<strong>[]</strong>(name)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Retrieves a value from the <code>PStore</code> file data, by <em>name</em>.
The hierarchy of Ruby objects stored under that root <em>name</em> will be
returned.</p>

<p><strong>WARNING</strong>:  This method is only valid in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.  It will raise <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if called at any other
time.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L154-L157'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


154
155
156
157</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 154</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_transaction'>in_transaction</span>
  <span class='ivar'>@table</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]=-instance_method">
  <h3 class='signature '>
    #<strong>[]=</strong>(name, value)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Stores an individual Ruby object or a hierarchy of Ruby objects in the data
store file under the root <em>name</em>.  Assigning to a <em>name</em>
already in the data store clobbers the old data.</p>

<h3 id="label-Example-3A">Example:</h3>

<pre class="code ruby"><code class="ruby">require &quot;pstore&quot;

store = &lt;code&gt;PStore&lt;/code&gt;.new(&quot;data_file.pstore&quot;)
store.transaction do  # begin transaction
  # load some data into the store...
  store[:single_object] = &quot;My data...&quot;
  store[:obj_heirarchy] = { &quot;Kev Jackson&quot; =&gt; [&quot;rational.rb&quot;, &quot;pstore.rb&quot;],
                            &quot;James Gray&quot;  =&gt; [&quot;erb.rb&quot;, &quot;pstore.rb&quot;] }
end                   # commit changes to data store file</code></pre>

<p><strong>WARNING</strong>:  This method is only valid in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a> and it cannot be read-only.  It will raise
<a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if called at any other time.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L199-L202'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


199
200
201
202</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 199</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>[]=</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_transaction_wr'>in_transaction_wr</span>
  <span class='ivar'>@table</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="abort-instance_method">
  <h3 class='signature '>
    #<strong>abort</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Ends the current <a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>, discarding any changes to the data
store.</p>

<h3 id="label-Example-3A">Example:</h3>

<pre class="code ruby"><code class="ruby">require &quot;pstore&quot;

store = &lt;code&gt;PStore&lt;/code&gt;.new(&quot;data_file.pstore&quot;)
store.transaction do  # begin transaction
  store[:one] = 1     # this change is not applied, see below...
  store[:two] = 2     # this change is not applied, see below...

  store.abort         # end transaction here, discard all changes

  store[:three] = 3   # this change is never reached
end</code></pre>

<p><strong>WARNING</strong>:  This method is only valid in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.  It will raise <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if called at any other
time.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L287-L291'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


287
288
289
290
291</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 287</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_abort'>abort</span>
  <span class='id identifier rubyid_in_transaction'>in_transaction</span>
  <span class='ivar'>@abort</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_throw'>throw</span> <span class='symbeg'>:</span><span class='id identifier rubyid_pstore_abort_transaction'>pstore_abort_transaction</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="commit-instance_method">
  <h3 class='signature '>
    #<strong>commit</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Ends the current <a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>, committing any changes to the data
store immediately.</p>

<h3 id="label-Example-3A">Example:</h3>

<pre class="code ruby"><code class="ruby">require &quot;pstore&quot;

store = &lt;code&gt;PStore&lt;/code&gt;.new(&quot;data_file.pstore&quot;)
store.transaction do  # begin transaction
  # load some data into the store...
  store[:one] = 1
  store[:two] = 2

  store.commit        # end transaction here, committing changes

  store[:three] = 3   # this change is never reached
end</code></pre>

<p><strong>WARNING</strong>:  This method is only valid in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.  It will raise <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if called at any other
time.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L261-L265'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


261
262
263
264
265</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 261</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_commit'>commit</span>
  <span class='id identifier rubyid_in_transaction'>in_transaction</span>
  <span class='ivar'>@abort</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_throw'>throw</span> <span class='symbeg'>:</span><span class='id identifier rubyid_pstore_abort_transaction'>pstore_abort_transaction</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete-instance_method">
  <h3 class='signature '>
    #<strong>delete</strong>(name)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Removes an object hierarchy from the data store, by <em>name</em>.</p>

<p><strong>WARNING</strong>:  This method is only valid in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a> and it cannot be read-only.  It will raise
<a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if called at any other time.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L209-L212'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


209
210
211
212</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 209</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_transaction_wr'>in_transaction_wr</span>
  <span class='ivar'>@table</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="empty_marshal_checksum-instance_method">
  <h3 class='signature priv'>
    #<strong>empty_marshal_checksum</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L481-L483'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


481
482
483</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 481</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_empty_marshal_checksum'>empty_marshal_checksum</span>
  <span class='const'><a href="#EMPTY_MARSHAL_CHECKSUM-constant" title="PStore::EMPTY_MARSHAL_CHECKSUM (constant)">EMPTY_MARSHAL_CHECKSUM</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="empty_marshal_data-instance_method">
  <h3 class='signature priv'>
    #<strong>empty_marshal_data</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L478-L480'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


478
479
480</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 478</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_empty_marshal_data'>empty_marshal_data</span>
  <span class='const'><a href="#EMPTY_MARSHAL_DATA-constant" title="PStore::EMPTY_MARSHAL_DATA (constant)">EMPTY_MARSHAL_DATA</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fetch-instance_method">
  <h3 class='signature '>
    #<strong>fetch</strong>(name, default = PStore::Error)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This method is just like <a href="#[]-instance_method" title="PStore#[] (method)">#[]</a>, save that you may also provide a
<em>default</em> value for the object.  In the event the specified
<em>name</em> is not found in the data store, your <em>default</em> will be
returned instead.  If you do not specify a default, <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> will be
raised if the object is not found.</p>

<p><strong>WARNING</strong>:  This method is only valid in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.  It will raise <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if called at any other
time.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L168-L178'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


168
169
170
171
172
173
174
175
176
177
178</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 168</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_default'>default</span><span class='op'>=</span><span class='const'>PStore</span><span class='op'>::</span><span class='const'>Error</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_transaction'>in_transaction</span>
  <span class='kw'>unless</span> <span class='ivar'>@table</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span> <span class='id identifier rubyid_name'>name</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_default'>default</span> <span class='op'>==</span> <span class='const'>PStore</span><span class='op'>::</span><span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>PStore</span><span class='op'>::</span><span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span><span class='comma'>,</span> <span class='id identifier rubyid_format'>format</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>undefined root name `%s&#39;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_default'>default</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@table</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="in_transaction-instance_method">
  <h3 class='signature priv'>
    #<strong>in_transaction</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raises <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if the calling code is not in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="PStore/Error.html" title="PStore::Error (class)">PStore::Error</a>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L134-L136'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


134
135
136</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 134</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_in_transaction'>in_transaction</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>PStore</span><span class='op'>::</span><span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not in transaction</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_locked?'>locked?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="in_transaction_wr-instance_method">
  <h3 class='signature priv'>
    #<strong>in_transaction_wr</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raises <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if the calling code is not in a <a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>
or if the code is in a read-only <a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="PStore/Error.html" title="PStore::Error (class)">PStore::Error</a>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L141-L144'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


141
142
143
144</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 141</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_in_transaction_wr'>in_transaction_wr</span>
  <span class='id identifier rubyid_in_transaction'>in_transaction</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>PStore</span><span class='op'>::</span><span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>in read-only transaction</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@rdonly</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="load_data-instance_method">
  <h3 class='signature priv'>
    #<strong>load_data</strong>(file, read_only)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Load the given <code>PStore</code> file. If <code>read_only</code> is true, the
unmarshalled Hash will be returned. If <code>read_only</code> is false, a 3-tuple will
be returned: the unmarshalled Hash, an MD5 checksum of the data, and the
size of the data.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L392-L418'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 392</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_load_data'>load_data</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_read_only'>read_only</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_read_only'>read_only</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_table'>table</span> <span class='op'>=</span> <span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PStore file seems to be corrupted.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>EOFError</span>
      <span class='comment'># This seems to be a newly-created file.
</span>      <span class='id identifier rubyid_table'>table</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_table'>table</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='comment'># This seems to be a newly-created file.
</span>      <span class='id identifier rubyid_table'>table</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_checksum'>checksum</span> <span class='op'>=</span> <span class='id identifier rubyid_empty_marshal_checksum'>empty_marshal_checksum</span>
      <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_empty_marshal_data'>empty_marshal_data</span><span class='period'>.</span><span class='id identifier rubyid_bytesize'>bytesize</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_table'>table</span> <span class='op'>=</span> <span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_checksum'>checksum</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_bytesize'>bytesize</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PStore file seems to be corrupted.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_table'>table</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span><span class='const'><a href="#EMPTY_STRING-constant" title="PStore::EMPTY_STRING (constant)">EMPTY_STRING</a></span><span class='rparen'>)</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_checksum'>checksum</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="open_and_lock_file-instance_method">
  <h3 class='signature priv'>
    #<strong>open_and_lock_file</strong>(filename, read_only)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Open the specified filename (either in read-only mode or in read-write
mode) and lock it for reading or writing.</p>

<p>The opened File object will be returned. If <em>read_only</em> is true, and
the file does not exist, then nil will be returned.</p>

<p>All exceptions are propagated.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L367-L386'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 367</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_open_and_lock_file'>open_and_lock_file</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_read_only'>read_only</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_read_only'>read_only</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='const'><a href="#RD_ACCESS-constant" title="PStore::RD_ACCESS (constant)">RD_ACCESS</a></span><span class='rparen'>)</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_flock'>flock</span><span class='lparen'>(</span><span class='const'>File</span><span class='op'>::</span><span class='const'>LOCK_SH</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_file'>file</span>
      <span class='kw'>rescue</span>
        <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
        <span class='id identifier rubyid_raise'>raise</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span>
      <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='const'><a href="#RDWR_ACCESS-constant" title="PStore::RDWR_ACCESS (constant)">RDWR_ACCESS</a></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_flock'>flock</span><span class='lparen'>(</span><span class='const'>File</span><span class='op'>::</span><span class='const'>LOCK_EX</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_file'>file</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="path-instance_method">
  <h3 class='signature '>
    #<strong>path</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the path to the data store file.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L235-L237'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


235
236
237</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 235</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_path'>path</span>
  <span class='ivar'>@filename</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="root?-instance_method">
  <h3 class='signature '>
    #<strong>root?</strong>(name)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if the supplied <em>name</em> is currently in the data store.</p>

<p><strong>WARNING</strong>:  This method is only valid in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.  It will raise <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if called at any other
time.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L230-L233'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


230
231
232
233</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 230</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_root?'>root?</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_in_transaction'>in_transaction</span>
  <span class='ivar'>@table</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span> <span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="roots-instance_method">
  <h3 class='signature '>
    #<strong>roots</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the names of all object hierarchies currently in the store.</p>

<p><strong>WARNING</strong>:  This method is only valid in a
<a href="#transaction-instance_method" title="PStore#transaction (method)">#transaction</a>.  It will raise <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a> if called at any other
time.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L220-L223'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


220
221
222
223</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 220</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_roots'>roots</span>
  <span class='id identifier rubyid_in_transaction'>in_transaction</span>
  <span class='ivar'>@table</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save_data-instance_method">
  <h3 class='signature priv'>
    #<strong>save_data</strong>(original_checksum, original_file_size, file)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L428-L441'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


428
429
430
431
432
433
434
435
436
437
438
439
440
441</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 428</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save_data'>save_data</span><span class='lparen'>(</span><span class='id identifier rubyid_original_checksum'>original_checksum</span><span class='comma'>,</span> <span class='id identifier rubyid_original_file_size'>original_file_size</span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_data'>new_data</span> <span class='op'>=</span> <span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='ivar'>@table</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_new_data'>new_data</span><span class='period'>.</span><span class='id identifier rubyid_bytesize'>bytesize</span> <span class='op'>!=</span> <span class='id identifier rubyid_original_file_size'>original_file_size</span> <span class='op'>||</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span><span class='lparen'>(</span><span class='id identifier rubyid_new_data'>new_data</span><span class='rparen'>)</span> <span class='op'>!=</span> <span class='id identifier rubyid_original_checksum'>original_checksum</span>
    <span class='kw'>if</span> <span class='ivar'>@ultra_safe</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_on_windows?'>on_windows?</span>
      <span class='comment'># Windows doesn&#39;t support atomic file renames.
</span>      <span class='id identifier rubyid_save_data_with_atomic_file_rename_strategy'>save_data_with_atomic_file_rename_strategy</span><span class='lparen'>(</span><span class='id identifier rubyid_new_data'>new_data</span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_save_data_with_fast_strategy'>save_data_with_fast_strategy</span><span class='lparen'>(</span><span class='id identifier rubyid_new_data'>new_data</span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_new_data'>new_data</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span><span class='const'><a href="#EMPTY_STRING-constant" title="PStore::EMPTY_STRING (constant)">EMPTY_STRING</a></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save_data_with_atomic_file_rename_strategy-instance_method">
  <h3 class='signature priv'>
    #<strong>save_data_with_atomic_file_rename_strategy</strong>(data, file)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L443-L457'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


443
444
445
446
447
448
449
450
451
452
453
454
455
456
457</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 443</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save_data_with_atomic_file_rename_strategy'>save_data_with_atomic_file_rename_strategy</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_temp_filename'>temp_filename</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@filename</span><span class='embexpr_end'>}</span><span class='tstring_content'>.tmp.</span><span class='embexpr_beg'>#{</span><span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_pid'>pid</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rand'>rand</span> <span class='int'>1000000</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_temp_file'>temp_file</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_temp_filename'>temp_filename</span><span class='comma'>,</span> <span class='const'><a href="#WR_ACCESS-constant" title="PStore::WR_ACCESS (constant)">WR_ACCESS</a></span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_temp_file'>temp_file</span><span class='period'>.</span><span class='id identifier rubyid_flock'>flock</span><span class='lparen'>(</span><span class='const'>File</span><span class='op'>::</span><span class='const'>LOCK_EX</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_temp_file'>temp_file</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_temp_file'>temp_file</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_rename'>rename</span><span class='lparen'>(</span><span class='id identifier rubyid_temp_filename'>temp_filename</span><span class='comma'>,</span> <span class='ivar'>@filename</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_unlink'>unlink</span><span class='lparen'>(</span><span class='id identifier rubyid_temp_file'>temp_file</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_temp_file'>temp_file</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save_data_with_fast_strategy-instance_method">
  <h3 class='signature priv'>
    #<strong>save_data_with_fast_strategy</strong>(data, file)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L459-L463'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


459
460
461
462
463</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 459</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save_data_with_fast_strategy'>save_data_with_fast_strategy</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>
  <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_truncate'>truncate</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_bytesize'>bytesize</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="transaction-instance_method">
  <h3 class='signature '>
    #<strong>transaction</strong>(read_only = false)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Opens a new transaction for the data store.  Code executed inside a block
passed to this method may read and write data to and from the data store
file.</p>

<p>At the end of the block, changes are committed to the data store
automatically.  You may exit the transaction early with a call to either
<a href="#commit-instance_method" title="PStore#commit (method)">#commit</a> or <a href="#abort-instance_method" title="PStore#abort (method)">#abort</a>.  See those methods for details about how
changes are handled.  Raising an uncaught Exception in the block is
equivalent to calling <a href="#abort-instance_method" title="PStore#abort (method)">#abort</a>.</p>

<p>If <em>read_only</em> is set to <code>true</code>, you will only be allowed to read
from the data store during the transaction and any attempts to change the
data will raise a <a href="PStore/Error.html" title="PStore::Error (class)">::PStore::Error</a>.</p>

<p>Note that <code>PStore</code> does not support nested transactions.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_1_10/lib/pstore.rb#L310-L350'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/pstore.rb', line 310</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='id identifier rubyid_read_only'>read_only</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>  <span class='comment'># :yields:  pstore
</span>  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@thread_safe</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>PStore</span><span class='op'>::</span><span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nested transaction</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_try_lock'>try_lock</span>
  <span class='kw'>else</span>
    <span class='kw'>begin</span>
      <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_lock'>lock</span>
    <span class='kw'>rescue</span> <span class='const'>ThreadError</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>PStore</span><span class='op'>::</span><span class='const'><a href="PStore/Error.html" title="PStore::Error (class)">Error</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nested transaction</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@rdonly</span> <span class='op'>=</span> <span class='id identifier rubyid_read_only'>read_only</span>
    <span class='ivar'>@abort</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='id identifier rubyid_open_and_lock_file'>open_and_lock_file</span><span class='lparen'>(</span><span class='ivar'>@filename</span><span class='comma'>,</span> <span class='id identifier rubyid_read_only'>read_only</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_file'>file</span>
      <span class='kw'>begin</span>
        <span class='ivar'>@table</span><span class='comma'>,</span> <span class='id identifier rubyid_checksum'>checksum</span><span class='comma'>,</span> <span class='id identifier rubyid_original_data_size'>original_data_size</span> <span class='op'>=</span> <span class='id identifier rubyid_load_data'>load_data</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_read_only'>read_only</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_catch'>catch</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_pstore_abort_transaction'>pstore_abort_transaction</span><span class='rparen'>)</span> <span class='kw'>do</span>
          <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@abort</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_read_only'>read_only</span>
          <span class='id identifier rubyid_save_data'>save_data</span><span class='lparen'>(</span><span class='id identifier rubyid_checksum'>checksum</span><span class='comma'>,</span> <span class='id identifier rubyid_original_data_size'>original_data_size</span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>ensure</span>
        <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='comment'># This can only occur if read_only == true.
</span>      <span class='ivar'>@table</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_catch'>catch</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_pstore_abort_transaction'>pstore_abort_transaction</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>ensure</span>
    <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.8 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.5.0p-1)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>