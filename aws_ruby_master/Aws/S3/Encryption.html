<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Aws::S3::Encryption &mdash; aws-sdk-ruby-master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Aws::S3::Encryption",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
        <a href='../../../index.html'>Home</a> &raquo; 
        <a href='../../index.html'>aws-sdk-ruby-master</a> &raquo; 
        <a href='../../_index.html#alpha_E'>Index (E)</a> &raquo; 
        <a href="../../Aws.html" title="Aws (module)">Aws</a> &raquo; 
        <a href="../S3.html" title="Aws::S3 (module)">S3</a> &raquo; 
        <span class='title'><a id='t2_doc_top' href='#'>Encryption&nbsp;&#x25B2;</a></span>
      </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Aws::S3::Encryption</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="Encryption/Errors.html" title="Aws::S3::Encryption::Errors (module)">Errors</a>,
        <a href="Encryption/KeyProvider.html" title="Aws::S3::Encryption::KeyProvider (module)">KeyProvider</a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Encryption/Client.html" title="Aws::S3::Encryption::Client (class)">Client</a>,
        <a href="Encryption/Materials.html" title="Aws::S3::Encryption::Materials (class)">Materials</a>      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/client.rb#L177'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/client.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption.rb#L3'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/decrypt_handler.rb#L5'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/decrypt_handler.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/default_cipher_provider.rb#L5'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/default_cipher_provider.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/default_key_provider.rb#L3'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/default_key_provider.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/encrypt_handler.rb#L5'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/encrypt_handler.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/errors.rb#L3'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/errors.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/io_auth_decrypter.rb#L3'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/io_auth_decrypter.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/io_decrypter.rb#L3'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/io_decrypter.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/io_encrypter.rb#L6'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/io_encrypter.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/key_provider.rb#L3'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/key_provider.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/kms_cipher_provider.rb#L5'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/kms_cipher_provider.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/materials.rb#L5'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/materials.rb</a>,<br/> <a class='repo' href='https://github.com/aws/aws-sdk-ruby/blob/master/aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/utils.rb#L5'>aws-sdk-resources/lib/aws-sdk-resources/services/s3/encryption/utils.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    <p>Provides an encryption client that encrypts and decrypts data client-side,
storing the encrypted data in Amazon S3.</p>

<p>This client uses a process called "envelope encryption". Your private
encryption keys and your data's plain-text are <strong>never</strong> sent to
Amazon S3. <strong>If you lose you encryption keys, you will not be able to
decrypt your data.</strong></p>

<h3>Envelope Encryption Overview</h3>

<p>The goal of envelope encryption is to combine the performance of
fast symmetric encryption while maintaining the secure key management
that asymmetric keys provide.</p>

<p>A one-time-use symmetric key (envelope key) is generated client-side.
This is used to encrypt the data client-side. This key is then
encrypted by your master key and stored alongside your data in Amazon
S3.</p>

<p>When accessing your encrypted data with the encryption client,
the encrypted envelope key is retrieved and decrypted client-side
with your master key. The envelope key is then used to decrypt the
data client-side.</p>

<p>One of the benefits of envelope encryption is that if your master key
is compromised, you have the option of jut re-encrypting the stored
envelope symmetric keys, instead of re-encrypting all of the
data in your account.</p>

<h3>Basic Usage</h3>

<p>The encryption client requires an <a href="Client.html" title="Aws::S3::Client (class)">Client</a>. If you do not
provide a <code>:client</code>, then a client will be constructed for you.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>openssl</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>RSA</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>1024</span><span class='rparen'>)</span>

<span class='comment'># encryption client
</span><span class='id identifier rubyid_s3'>s3</span> <span class='op'>=</span> <span class='const'><a href="../../Aws.html" title="Aws (module)">Aws</a></span><span class='op'>::</span><span class='const'><a href="../S3.html" title="Aws::S3 (module)">S3</a></span><span class='op'>::</span><span class='const'>Encryption</span><span class='op'>::</span><span class='const'><a href="Encryption/Client.html" title="Aws::S3::Encryption::Client (class)">Client</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Encryption/Client.html#new-class_method" title="Aws::S3::Encryption::Client.new (method)">new</a></span><span class='lparen'>(</span><span class='label'>encryption_key:</span> <span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>

<span class='comment'># round-trip an object, encrypted/decrypted locally
</span><span class='id identifier rubyid_s3'>s3</span><span class='period'>.</span><span class='id identifier rubyid_put_object'>put_object</span><span class='lparen'>(</span><span class='label'>bucket:</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>aws-sdk</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>key:</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>body:</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>handshake</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_s3'>s3</span><span class='period'>.</span><span class='id identifier rubyid_get_object'>get_object</span><span class='lparen'>(</span><span class='label'>bucket:</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>aws-sdk</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>key:</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
<span class='comment'>#=&gt; &#39;handshake&#39;
</span>
<span class='comment'># reading encrypted object without the encryption client
</span><span class='comment'># results in the getting the cipher text
</span><span class='const'><a href="../../Aws.html" title="Aws (module)">Aws</a></span><span class='op'>::</span><span class='const'><a href="../S3.html" title="Aws::S3 (module)">S3</a></span><span class='op'>::</span><span class='const'><a href="Client.html" title="Aws::S3::Client (class)">Client</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Client.html#new-class_method" title="Aws::S3::Client.new (method)">new</a></span><span class='period'>.</span><span class='id identifier rubyid_get_object'><a href="Client.html#get_object-instance_method" title="Aws::S3::Client#get_object (method)">get_object</a></span><span class='lparen'>(</span><span class='label'>bucket:</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>aws-sdk</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>key:</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_body'><a href="Types/GetObjectOutput.html#body-instance_method" title="Aws::S3::Types::GetObjectOutput#body (method)">body</a></span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
<span class='comment'>#=&gt; &quot;... cipher text ...&quot;</span></code></pre>

<h3>Keys</h3>

<p>For client-side encryption to work, you must provide one of the following:</p>

<ul>
<li>An encryption key</li>
<li>A <a href="Encryption/KeyProvider.html" title="Aws::S3::Encryption::KeyProvider (module)">KeyProvider</a></li>
<li>A KMS encryption key id</li>
</ul>


<h4>An Encryption Key</h4>

<p>You can pass a single encryption key. This is used as a master key
encrypting and decrypting all object keys.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AES-256-ECB</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_random_key'>random_key</span> <span class='comment'># symmetric key
</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>RSA</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>1024</span><span class='rparen'>)</span> <span class='comment'># asymmetric key pair
</span>
<span class='id identifier rubyid_s3'>s3</span> <span class='op'>=</span> <span class='const'><a href="../../Aws.html" title="Aws (module)">Aws</a></span><span class='op'>::</span><span class='const'><a href="../S3.html" title="Aws::S3 (module)">S3</a></span><span class='op'>::</span><span class='const'>Encryption</span><span class='op'>::</span><span class='const'><a href="Encryption/Client.html" title="Aws::S3::Encryption::Client (class)">Client</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Encryption/Client.html#new-class_method" title="Aws::S3::Encryption::Client.new (method)">new</a></span><span class='lparen'>(</span><span class='label'>encryption_key:</span> <span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span></code></pre>

<h4>Key Provider</h4>

<p>Alternatively, you can use a <a href="Encryption/KeyProvider.html" title="Aws::S3::Encryption::KeyProvider (module)">KeyProvider</a>. A key provider makes
it easy to work with multiple keys and simplifies key rotation.</p>

<h4>KMS Encryption Key Id</h4>

<p>If you pass the id to an AWS Key Management Service (KMS) key,
then KMS will be used to generate, encrypt and decrypt object keys.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># keep track of the kms key id
</span><span class='id identifier rubyid_kms'>kms</span> <span class='op'>=</span> <span class='const'><a href="../../Aws.html" title="Aws (module)">Aws</a></span><span class='op'>::</span><span class='const'><a href="../KMS.html" title="Aws::KMS (module)">KMS</a></span><span class='op'>::</span><span class='const'><a href="../KMS/Client.html" title="Aws::KMS::Client (class)">Client</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="../KMS/Client.html#new-class_method" title="Aws::KMS::Client.new (method)">new</a></span>
<span class='id identifier rubyid_key_id'>key_id</span> <span class='op'>=</span> <span class='id identifier rubyid_kms'>kms</span><span class='period'>.</span><span class='id identifier rubyid_create_key'>create_key</span><span class='period'>.</span><span class='id identifier rubyid_key_metadata'>key_metadata</span><span class='period'>.</span><span class='id identifier rubyid_key_id'>key_id</span>

<span class='const'><a href="../../Aws.html" title="Aws (module)">Aws</a></span><span class='op'>::</span><span class='const'><a href="../S3.html" title="Aws::S3 (module)">S3</a></span><span class='op'>::</span><span class='const'>Encryption</span><span class='op'>::</span><span class='const'><a href="Encryption/Client.html" title="Aws::S3::Encryption::Client (class)">Client</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Encryption/Client.html#new-class_method" title="Aws::S3::Encryption::Client.new (method)">new</a></span><span class='lparen'>(</span>
  <span class='label'>kms_key_id:</span> <span class='id identifier rubyid_key_id'>key_id</span><span class='comma'>,</span>
  <span class='label'>kms_client:</span> <span class='id identifier rubyid_kms'>kms</span><span class='comma'>,</span>
<span class='rparen'>)</span></code></pre>

<h3>Custom Key Providers</h3>

<p>A <a href="Encryption/KeyProvider.html" title="Aws::S3::Encryption::KeyProvider (module)">KeyProvider</a> is any object that responds to:</p>

<ul>
<li><code>#encryption_materials</code></li>
<li><code>#key_for(materials_description)</code></li>
</ul>


<p>Here is a trivial implementation of an in-memory key provider.
This is provided as a demonstration of the key provider interface,
and should not be used in production:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'><a href="Encryption/KeyProvider.html" title="Aws::S3::Encryption::KeyProvider (module)">KeyProvider</a></span>

  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_default_key_name'>default_key_name</span><span class='comma'>,</span> <span class='id identifier rubyid_keys'>keys</span><span class='rparen'>)</span>
    <span class='ivar'>@keys</span> <span class='op'>=</span> <span class='id identifier rubyid_keys'>keys</span>
    <span class='ivar'>@encryption_materials</span> <span class='op'>=</span> <span class='const'><a href="../../Aws.html" title="Aws (module)">Aws</a></span><span class='op'>::</span><span class='const'><a href="../S3.html" title="Aws::S3 (module)">S3</a></span><span class='op'>::</span><span class='const'>Encryption</span><span class='op'>::</span><span class='const'><a href="Encryption/Materials.html" title="Aws::S3::Encryption::Materials (class)">Materials</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Encryption/Materials.html#new-class_method" title="Aws::S3::Encryption::Materials.new (method)">new</a></span><span class='lparen'>(</span>
      <span class='label'>key:</span> <span class='ivar'>@keys</span><span class='lbracket'>[</span><span class='id identifier rubyid_default_key_name'>default_key_name</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>description:</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='label'>key:</span> <span class='id identifier rubyid_default_key_name'>default_key_name</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_encryption_materials'>encryption_materials</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_key_for'>key_for</span><span class='lparen'>(</span><span class='id identifier rubyid_matdesc'>matdesc</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_key_name'>key_name</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_matdesc'>matdesc</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>key</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='ivar'>@keys</span><span class='lbracket'>[</span><span class='id identifier rubyid_key_name'>key_name</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_key'>key</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>encryption key not found for: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_matdesc'>matdesc</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Given the above key provider, you can create an encryption client that
chooses the key to use based on the materials description stored with
the encrypted object. This makes it possible to use multiple keys
and simplifies key rotation.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># uses &quot;new-key&quot; for encrypting objects, uses either for decrypting
</span><span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='const'><a href="Encryption/KeyProvider.html" title="Aws::S3::Encryption::KeyProvider (module)">KeyProvider</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>new-key</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>old-key</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_decode64'>decode64</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>kM5UVbhE/4rtMZJfsadYEdm2vaKFsmV2f5+URSeUCV4=</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new-key</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_decode64'>decode64</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>w1WLio3agRWRTSJK/Ouh8NHoqRQ6fn5WbSXDTHjXMSo=</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
<span class='rbrace'>}</span><span class='rparen'>)</span><span class='comma'>,</span>

<span class='comment'># chooses the key based on the materials description stored
</span><span class='comment'># with the encrypted object
</span><span class='id identifier rubyid_s3'>s3</span> <span class='op'>=</span> <span class='const'><a href="../../Aws.html" title="Aws (module)">Aws</a></span><span class='op'>::</span><span class='const'><a href="../S3.html" title="Aws::S3 (module)">S3</a></span><span class='op'>::</span><span class='const'>Encryption</span><span class='op'>::</span><span class='const'><a href="Encryption/Client.html" title="Aws::S3::Encryption::Client (class)">Client</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Encryption/Client.html#new-class_method" title="Aws::S3::Encryption::Client.new (method)">new</a></span><span class='lparen'>(</span><span class='label'>key_provider:</span> <span class='id identifier rubyid_keys'>keys</span><span class='rparen'>)</span></code></pre>

<h3>Materials Description</h3>

<p>A materials description is JSON document string that is stored
in the metadata (or instruction file) of an encrypted object.
The DefaultKeyProvider uses the empty JSON document <code>"{}"</code>.</p>

<p>When building a key provider, you are free to store whatever
information you need to identify the master key that was used
to encrypt the object.</p>

<h3>Envelope Location</h3>

<p>By default, the encryption client store the encryption envelope
with the object, as metadata. You can choose to have the envelope
stored in a separate "instruction file". An instruction file
is an object, with the key of the encrypted object, suffixed with
<code>".instruction"</code>.</p>

<p>Specify the <code>:envelope_location</code> option as <code>:instruction_file</code> to
use an instruction file for storing the envelope.</p>

<pre class="code ruby"><code class="ruby"># default behavior
s3 = Aws::S3::Encryption::Client.new(
  key_provider: ...,
  envelope_location: :metadata,
)

# store envelope in a separate object
s3 = Aws::S3::Encryption::Client.new(
  key_provider: ...,
  envelope_location: :instruction_file,
  instruction_file_suffix: &#39;.instruction&#39; # default
)</code></pre>

<p>When using an instruction file, multiple requests are made when
putting and getting the object. <strong>This may cause issues if you are
issuing concurrent PUT and GET requests to an encrypted object.</strong></p>

  </div>
</div>
</div>
<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.8 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.5.0p-1)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>