<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::Migration &mdash; Rails-master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Migration",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
        <a href='../../index.html'>Home</a> &raquo; 
        <a href='../index.html'>Rails-master</a> &raquo; 
        <a href='../_index.html#alpha_M'>Index (M)</a> &raquo; 
        <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <span class='title'><a id='t2_doc_top' href='#'>Migration&nbsp;&#x25B2;</a></span>
      </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveRecord::Migration</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a class='nodoc' href="Migration/Compatibility.html" title="ActiveRecord::Migration::Compatibility (module)">Compatibility</a>,
        <a class='nodoc' href="Migration/JoinTable.html" title="ActiveRecord::Migration::JoinTable (module)">JoinTable</a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Migration/CheckPending.html" title="ActiveRecord::Migration::CheckPending (class)">CheckPending</a>,
        <a href="Migration/CommandRecorder.html" title="ActiveRecord::Migration::CommandRecorder (class)">CommandRecorder</a>,
        <a class='nodoc' href="Migration/Current.html" title="ActiveRecord::Migration::Current (class)">Current</a>,
        <a class='nodoc' href="Migration/ReversibleBlockHelper.html" title="ActiveRecord::Migration::ReversibleBlockHelper (class)">ReversibleBlockHelper</a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a href="Schema.html" title="ActiveRecord::Schema (class)">Schema</a>, <a class='nodoc' href="Migration/Current.html" title="ActiveRecord::Migration::Current (class)">Current</a>, <a class='nodoc' href="Migration/Compatibility/V4_2.html" title="ActiveRecord::Migration::Compatibility::V4_2 (class)">Compatibility::V4_2</a>, <a class='nodoc' href="Migration/Compatibility/V5_0.html" title="ActiveRecord::Migration::Compatibility::V5_0 (class)">Compatibility::V5_0</a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L514'>activerecord/lib/active_record/migration.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration/command_recorder.rb#L2'>activerecord/lib/active_record/migration/command_recorder.rb</a>,<br/> <a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration/compatibility.rb#L2'>activerecord/lib/active_record/migration/compatibility.rb</a>,<br/> <a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration/join_table.rb#L2'>activerecord/lib/active_record/migration/join_table.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Active+Record+Migrations">Active Record Migrations</h3>

<p>Migrations can manage the evolution of a schema used by several physical
databases. It&#39;s a solution to the common problem of adding a field to
make a new feature work in your local database, but being unsure of how to
push that change to other developers and to the production server. With
migrations, you can describe the transformations in self-contained classes
that can be checked into version control systems and executed against
another database that might be one, two, or five versions behind.</p>

<p>Example of a simple migration:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>AddSsl</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_accounts'>accounts</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_enabled'>ssl_enabled</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_boolean'>boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='id identifier rubyid_remove_column'>remove_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_accounts'>accounts</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_enabled'>ssl_enabled</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This migration will add a boolean flag to the accounts table and remove it
if you&#39;re backing out of the migration. It shows how all migrations
have two methods <a href="#up-instance_method" title="ActiveRecord::Migration#up (method)">#up</a> and <a href="#down-instance_method" title="ActiveRecord::Migration#down (method)">#down</a> that describes the transformations
required to implement or remove the migration. These methods can consist of
both the migration specific methods like <code>add_column</code> and <code>remove_column</code>,
but may also contain regular Ruby code for generating data needed for the
transformations.</p>

<p>Example of a more complex migration that also needs to initialize data:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>AddSystemSettings</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_system_settings'>system_settings</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_label'>label</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>    <span class='symbeg'>:</span><span class='id identifier rubyid_value'>value</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_type'>type</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_integer'>integer</span> <span class='symbeg'>:</span><span class='id identifier rubyid_position'>position</span>
    <span class='kw'>end</span>

    <span class='const'>SystemSetting</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span>  <span class='label'>name:</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>notice</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                          <span class='label'>label:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Use notice?</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                          <span class='label'>value:</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='id identifier rubyid_drop_table'>drop_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_system_settings'>system_settings</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This migration first adds the <code>system_settings</code> table, then creates the
very first row in it using the Active Record model that relies on the
table. It also uses the more advanced <code>create_table</code> syntax where you can
specify a complete table schema in one block call.</p>

<h4 id="label-Available+transformations">Available transformations</h4>

<h5 id="label-Creation">Creation</h5>
<ul><li>
<p><code>create_join_table(table_1, table_2, options)</code>: Creates a join
table having its name as the lexical order of the first two arguments. See
ActiveRecord::ConnectionAdapters::SchemaStatements#create_join_table for
details.</p>
</li><li>
<p><code>create_table(name, options)</code>: Creates a table called <a href="#name-instance_method" title="ActiveRecord::Migration#name (method)">#name</a> and
makes the table object available to a block that can then add columns to
it, following the same format as <code>add_column</code>. See example
above. The options hash is for fragments like “DEFAULT CHARSET=UTF-8” that
are appended to the create table definition.</p>
</li><li>
<p><code>add_column(table_name, column_name, type, options)</code>: Adds a new
column to the table called <code>table_name</code> named
<code>column_name</code> specified to be one of the following types:
<code>:string</code>, <code>:text</code>, <code>:integer</code>,
<code>:float</code>, <code>:decimal</code>, <code>:datetime</code>,
<code>:timestamp</code>, <code>:time</code>, <code>:date</code>,
<code>:binary</code>, <code>:boolean</code>. A default value can be
specified by passing an <code>options</code> hash like <code>{ default: 11
}</code>. Other options include <code>:limit</code> and <code>:null</code>
(e.g. <code>{ limit: 50, null: false }</code>) – see
ActiveRecord::ConnectionAdapters::TableDefinition#column for details.</p>
</li><li>
<p><code>add_foreign_key(from_table, to_table, options)</code>: Adds a new
foreign key. <code>from_table</code> is the table with the key column,
<code>to_table</code> contains the referenced primary key.</p>
</li><li>
<p><code>add_index(table_name, column_names, options)</code>: Adds a new index
with the name of the column. Other options include <code>:name</code>,
<code>:unique</code> (e.g. <code>{ name: &#39;users_name_index&#39;,
unique: true }</code>) and <code>:order</code> (e.g. <code>{ order: { name:
:desc } }</code>).</p>
</li><li>
<p><code>add_reference(:table_name, :reference_name)</code>: Adds a new column
<code>reference_name_id</code> by default an integer. See
ActiveRecord::ConnectionAdapters::SchemaStatements#add_reference for
details.</p>
</li><li>
<p><code>add_timestamps(table_name, options)</code>: Adds timestamps
(<code>created_at</code> and <code>updated_at</code>) columns to
<code>table_name</code>.</p>
</li></ul>

<h5 id="label-Modification">Modification</h5>
<ul><li>
<p><code>change_column(table_name, column_name, type, options)</code>: 
Changes the column to a different type using the same parameters as
add_column.</p>
</li><li>
<p><code>change_column_default(table_name, column_name,
default_or_changes)</code>: Sets a default value for
<code>column_name</code> defined by <code>default_or_changes</code> on
<code>table_name</code>. Passing a hash containing <code>:from</code> and
<code>:to</code> as <code>default_or_changes</code> will make this change
reversible in the migration.</p>
</li><li>
<p><code>change_column_null(table_name, column_name, null, default =
nil)</code>: Sets or removes a <tt>NOT NULL</tt> constraint on
<code>column_name</code>. The <code>null</code> flag indicates whether the
value can be <code>NULL</code>. See
ActiveRecord::ConnectionAdapters::SchemaStatements#change_column_null for
details.</p>
</li><li>
<p><code>change_table(name, options)</code>: Allows to make column alterations
to the table called <code>name</code>. It makes the table object available
to a block that can then add/remove columns, indexes or foreign keys to it.</p>
</li><li>
<p><code>rename_column(table_name, column_name, new_column_name)</code>:
Renames a column but keeps the type and content.</p>
</li><li>
<p><code>rename_index(table_name, old_name, new_name)</code>: Renames an
index.</p>
</li><li>
<p><code>rename_table(old_name, new_name)</code>: Renames the table called
<code>old_name</code> to <code>new_name</code>.</p>
</li></ul>

<h5 id="label-Deletion">Deletion</h5>
<ul><li>
<p><code>drop_table(name)</code>: Drops the table called <a href="#name-instance_method" title="ActiveRecord::Migration#name (method)">#name</a>.</p>
</li><li>
<p><code>drop_join_table(table_1, table_2, options)</code>: Drops the join
table specified by the given arguments.</p>
</li><li>
<p><code>remove_column(table_name, column_name, type, options)</code>: Removes
the column named <code>column_name</code> from the table called
<code>table_name</code>.</p>
</li><li>
<p><code>remove_columns(table_name, *column_names)</code>: Removes the given
columns from the table definition.</p>
</li><li>
<p><code>remove_foreign_key(from_table, options_or_to_table)</code>: Removes
the given foreign key from the table called <code>table_name</code>.</p>
</li><li>
<p><code>remove_index(table_name, column: column_names)</code>: Removes the
index specified by <code>column_names</code>.</p>
</li><li>
<p><code>remove_index(table_name, name: index_name)</code>: Removes the index
specified by <code>index_name</code>.</p>
</li><li>
<p><code>remove_reference(table_name, ref_name, options)</code>: Removes the
reference(s) on <code>table_name</code> specified by <code>ref_name</code>.</p>
</li><li>
<p><code>remove_timestamps(table_name, options)</code>: Removes the timestamp
columns (<code>created_at</code> and <code>updated_at</code>) from the
table definition.</p>
</li></ul>

<h4 id="label-Irreversible+transformations">Irreversible transformations</h4>

<p>Some transformations are destructive in a manner that cannot be reversed.
Migrations of that kind should raise an
<a href="IrreversibleMigration.html" title="ActiveRecord::IrreversibleMigration (class)">IrreversibleMigration</a> exception in their <a href="#down-instance_method" title="ActiveRecord::Migration#down (method)">#down</a> method.</p>

<h4 id="label-Running+migrations+from+within+-7BRails-7D">Running migrations from within <a href="../Rails.html" title="Rails (module)">::Rails</a></h4>

<p>The Rails package has several tools to help create and apply migrations.</p>

<p>To generate a new migration, you can use</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_generate'>generate</span> <span class='id identifier rubyid_migration'>migration</span> <span class='const'>MyNewMigration</span></code></pre>

<p>where MyNewMigration is the name of your migration. The generator will
create an empty migration file <code>timestamp_my_new_migration.rb</code>
in the <code>db/migrate/</code> directory where <code>timestamp</code> is the UTC
formatted date and time that the migration was generated.</p>

<p>There is a special syntactic shortcut to generate migrations that add
fields to a table.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_generate'>generate</span> <span class='id identifier rubyid_migration'>migration</span> <span class='id identifier rubyid_add_fieldname_to_tablename'>add_fieldname_to_tablename</span> <span class='label'>fieldname:</span><span class='id identifier rubyid_string'>string</span></code></pre>

<p>This will generate the file
<code>timestamp_add_fieldname_to_tablename.rb</code>, which will look like
this:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>AddFieldnameToTablename</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tablenames'>tablenames</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_fieldname'>fieldname</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_string'>string</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>To run migrations against the currently configured database, use
<code>rails db:migrate</code>. This will update the database by running all
of the pending migrations, creating the <code>schema_migrations</code> table (see
"About the schema_migrations table" section below) if missing. It will also
invoke the db:schema:dump task, which will update your db/schema.rb file to
match the structure of your database.</p>

<p>To roll the database back to a previous migration version, use <code>rails
db:migrate VERSION=X</code> where <code>X</code> is the version to which you wish to
downgrade. Alternatively, you can also use the STEP option if you wish to
rollback last few migrations. <code>rails db:migrate STEP=2</code> will
rollback the latest two migrations.</p>

<p>If any of the migrations throw an <a href="IrreversibleMigration.html" title="ActiveRecord::IrreversibleMigration (class)">IrreversibleMigration</a>
exception, that step will fail and you&#39;ll have some manual work to do.</p>

<h4 id="label-Database+support">Database support</h4>

<p>Migrations are currently supported in MySQL, PostgreSQL, SQLite, SQL
Server, and Oracle (all supported databases except DB2).</p>

<h4 id="label-More+examples">More examples</h4>

<p>Not all migrations change the schema. Some just fix the data:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>RemoveEmptyTags</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='const'>Tag</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_tag'>tag</span><span class='op'>|</span> <span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_pages'>pages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='comment'># not much we can do to restore deleted data
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="IrreversibleMigration.html" title="ActiveRecord::IrreversibleMigration (class)">IrreversibleMigration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t recover the deleted tags</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Others remove columns when they migrate up instead of down:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>RemoveUnnecessaryItemAttributes</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_remove_column'>remove_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_incomplete_items_count'>incomplete_items_count</span>
    <span class='id identifier rubyid_remove_column'>remove_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_completed_items_count'>completed_items_count</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_incomplete_items_count'>incomplete_items_count</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_items'>items</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_completed_items_count'>completed_items_count</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>And sometimes you need to do something in SQL not abstracted directly by
migrations:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MakeJoinUnique</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ALTER TABLE `pages_linked_pages` ADD UNIQUE `page_id_linked_page_id` (`page_id`,`linked_page_id`)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ALTER TABLE `pages_linked_pages` DROP INDEX `page_id_linked_page_id`</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h4 id="label-Using+a+model+after+changing+its+table">Using a model after changing its table</h4>

<p>Sometimes you&#39;ll want to add a column in a migration and populate it
immediately after. In that case, you&#39;ll need to make a call to
<code>Base#reset_column_information</code> in order to ensure that the model has the
latest column data from after the new column was added. Example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>AddPeopleSalary</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_people'>people</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_salary'>salary</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_integer'>integer</span>
    <span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_reset_column_information'>reset_column_information</span>
    <span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
      <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_update_attribute'>update_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid_salary'>salary</span><span class='comma'>,</span> <span class='const'>SalaryCalculator</span><span class='period'>.</span><span class='id identifier rubyid_compute'>compute</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h4 id="label-Controlling+verbosity">Controlling verbosity</h4>

<p>By default, migrations will describe the actions they are taking, writing
them to the console as they happen, along with benchmarks describing how
long each step took.</p>

<p>You can quiet them down by setting <a href="#verbose-class_method" title="ActiveRecord::Migration.verbose (method)">.verbose</a> =
false.</p>

<p>You can also insert your own messages and benchmarks by using the
<a href="#say_with_time-instance_method" title="ActiveRecord::Migration#say_with_time (method)">#say_with_time</a> method:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
  <span class='comment'>#...
</span>  <span class='id identifier rubyid_say_with_time'>say_with_time</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Updating salaries...</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
      <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_update_attribute'>update_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid_salary'>salary</span><span class='comma'>,</span> <span class='const'>SalaryCalculator</span><span class='period'>.</span><span class='id identifier rubyid_compute'>compute</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='comment'>#...
</span><span class='kw'>end</span></code></pre>

<p>The phrase "Updating salaries..." would then be printed, along with the
benchmark for the block when the block completes.</p>

<h4 id="label-Timestamped+Migrations">Timestamped Migrations</h4>

<p>By default, <a href="../Rails.html" title="Rails (module)">::Rails</a> generates migrations that look like:</p>

<pre class="code ruby"><code class="ruby">20080717013526_your_migration_name.rb</code></pre>

<p>The prefix is a generation timestamp (in UTC).</p>

<p>If you&#39;d prefer to use numeric prefixes, you can turn timestamped
migrations off by setting:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_active_record'>active_record</span><span class='period'>.</span><span class='id identifier rubyid_timestamped_migrations'>timestamped_migrations</span> <span class='op'>=</span> <span class='kw'>false</span></code></pre>

<p>In application.rb.</p>

<h4 id="label-Reversible+Migrations">Reversible Migrations</h4>

<p>Reversible migrations are migrations that know how to go <a href="#down-instance_method" title="ActiveRecord::Migration#down (method)">#down</a> for you.
You simply supply the <a href="#up-instance_method" title="ActiveRecord::Migration#up (method)">#up</a> logic, and the <code>Migration</code> system
figures out how to execute the down commands for you.</p>

<p>To define a reversible migration, define the <code>change</code> method in your
migration like this:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>TenderloveMigration</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_create_table'>create_table</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_horses'>horses</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_content'>content</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_text'>text</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_remind_at'>remind_at</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_datetime'>datetime</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This migration will create the horses table for you on the way up, and
automatically figure out how to drop the table on the way down.</p>

<p>Some commands like <code>remove_column</code> cannot be reversed.  If you care to
define how to move up and down in these cases, you should define the <a href="#up-instance_method" title="ActiveRecord::Migration#up (method)">#up</a>
and <a href="#down-instance_method" title="ActiveRecord::Migration#down (method)">#down</a> methods as before.</p>

<p>If a command cannot be reversed, an <a href="IrreversibleMigration.html" title="ActiveRecord::IrreversibleMigration (class)">IrreversibleMigration</a>
exception will be raised when the migration is moving down.</p>

<p>For a list of commands that are reversible, please see
<a href="Migration/CommandRecorder.html" title="ActiveRecord::Migration::CommandRecorder (class)">CommandRecorder</a>.</p>

<h4 id="label-Transactional+Migrations">Transactional Migrations</h4>

<p>If the database adapter supports DDL transactions, all migrations will
automatically be wrapped in a transaction. There are queries that you
can&#39;t execute inside a transaction though, and for these situations you
can turn the automatic transactions off.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ChangeEnum</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_disable_ddl_transaction!'>disable_ddl_transaction!</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ALTER TYPE model_size ADD VALUE &#39;new_value&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Remember that you can still open your own transactions, even if you are in
a <code>Migration</code> with <code>self.disable_ddl_transaction!</code>.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='MigrationFilenameRegexp-constant' class='summary_signature nodoc'>MigrationFilenameRegexp =</span>
    <span class='nodoc note title'>Internal use only</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L540-L540'># File 'activerecord/lib/active_record/migration.rb', line 540</a>    <pre class='code ruby'><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A([0-9]+)_([_a-z0-9]*)\.?([_a-z0-9]*)?\.rb\z</span><span class='regexp_end'>/</span></span></pre>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='class_Attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#verbose-class_method" title=".verbose (class method)">.<strong>verbose</strong>  </a>
      (also: #verbose)
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#delegate-class_method" title=".delegate (class method)">.<strong>delegate</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#disable_ddl_transaction-class_method" title=".disable_ddl_transaction (class method)">.<strong>disable_ddl_transaction</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-class_method" title=".[] (class method)">.<strong>[]</strong>(version)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#check_pending!-class_method" title=".check_pending! (class method)">.<strong>check_pending!</strong>(connection = Base.connection)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Raises <a href="PendingMigrationError.html" title="ActiveRecord::PendingMigrationError (class)">PendingMigrationError</a> error if any migrations are
pending.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#current_version-class_method" title=".current_version (class method)">.<strong>current_version</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#disable_ddl_transaction!-class_method" title=".disable_ddl_transaction! (class method)">.<strong>disable_ddl_transaction!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Disable the transaction wrapping this migration.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#load_schema_if_pending!-class_method" title=".load_schema_if_pending! (class method)">.<strong>load_schema_if_pending!</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#migrate-class_method" title=".migrate (class method)">.<strong>migrate</strong>(direction)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(name = self.class.name, version = nil)  &#x21d2; Migration </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#inherited-class_method" title=".inherited (class method)">.<strong>inherited</strong>(subclass)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#maintain_test_schema!-class_method" title=".maintain_test_schema! (class method)">.<strong>maintain_test_schema!</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#method_missing-class_method" title=".method_missing (class method)">.<strong>method_missing</strong>(name, *args, &amp;block)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#nearest_delegate-class_method" title=".nearest_delegate (class method)">.<strong>nearest_delegate</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#verbose-instance_method" title="#verbose (instance method)">#<strong>verbose</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#version-instance_method" title="#version (instance method)">#<strong>version</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#reverting%3F-instance_method" title="#reverting? (instance method)">#<strong>reverting?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#announce-instance_method" title="#announce (instance method)">#<strong>announce</strong>(message)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#connection-instance_method" title="#connection (instance method)">#<strong>connection</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#copy-instance_method" title="#copy (instance method)">#<strong>copy</strong>(destination, sources, options = {})  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#down-instance_method" title="#down (instance method)">#<strong>down</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exec_migration-instance_method" title="#exec_migration (instance method)">#<strong>exec_migration</strong>(conn, direction)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#method_missing-instance_method" title="#method_missing (instance method)">#<strong>method_missing</strong>(method, *arguments, &amp;block)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#migrate-instance_method" title="#migrate (instance method)">#<strong>migrate</strong>(direction)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute this migration in the named direction.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#next_migration_number-instance_method" title="#next_migration_number (instance method)">#<strong>next_migration_number</strong>(number)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Determines the version number of the next migration.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#proper_table_name-instance_method" title="#proper_table_name (instance method)">#<strong>proper_table_name</strong>(name, options = {})  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Finds the correct table name given an Active Record object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reversible-instance_method" title="#reversible (instance method)">#<strong>reversible</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Used to specify an operation that can be run in one direction or another.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#revert-instance_method" title="#revert (instance method)">#<strong>revert</strong>(*migration_classes)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reverses the migration commands for the given block and the given
migrations.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#run-instance_method" title="#run (instance method)">#<strong>run</strong>(*migration_classes)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Runs the given migration classes.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#say-instance_method" title="#say (instance method)">#<strong>say</strong>(message, subitem = false)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#say_with_time-instance_method" title="#say_with_time (instance method)">#<strong>say_with_time</strong>(message)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#suppress_messages-instance_method" title="#suppress_messages (instance method)">#<strong>suppress_messages</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#up-instance_method" title="#up (instance method)">#<strong>up</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#write-instance_method" title="#write (instance method)">#<strong>write</strong>(text = &quot;&quot;)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#execute_block-instance_method" title="#execute_block (instance method)">#<strong>execute_block</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#disable_ddl_transaction-instance_method" title="#disable_ddl_transaction (instance method)">#<strong>disable_ddl_transaction</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#table_name_options-instance_method" title="#table_name_options (instance method)">#<strong>table_name_options</strong>(config = ActiveRecord::Base)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Builds a hash for use in <a href="#proper_table_name-instance_method" title="ActiveRecord::Migration#proper_table_name (method)">#proper_table_name</a> using
the Active Record object&#39;s table_name prefix and suffix.</p></div>
    </div>
  </li>
</ul>
</div>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(name = self.class.name, version = nil)  &#x21d2; <code>Migration</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L623-L627'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


623
624
625
626
627</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 623</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='ivar'>@name</span>       <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@version</span>    <span class='op'>=</span> <span class='id identifier rubyid_version'>version</span>
  <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 id='method_missing_details' class='y_details'>Dynamic Method Handling</h2>
  <p class='notice this'>
    This class handles dynamic methods through the <tt>method_missing</tt> method
</p>
<section class='method_details first' id="method_missing-instance_method">
  <h3 class='signature  first'>
    #<strong>method_missing</strong>(method, *arguments, &amp;block)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L835-L851'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 835</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_arguments'>arguments</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_arg_list'>arg_list</span> <span class='op'>=</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_say_with_time'>say_with_time</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_arg_list'>arg_list</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_revert'>revert</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_execute'>execute</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_enable_extension'>enable_extension</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_disable_extension'>disable_extension</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_arguments'>arguments</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_proper_table_name'>proper_table_name</span><span class='lparen'>(</span><span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_table_name_options'>table_name_options</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_rename_table'>rename_table</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_add_foreign_key'>add_foreign_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span> <span class='op'>||</span>
          <span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_remove_foreign_key'>remove_foreign_key</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_second'>second</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span><span class='rparen'>)</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_arguments'>arguments</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_proper_table_name'>proper_table_name</span><span class='lparen'>(</span><span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_second'>second</span><span class='comma'>,</span> <span class='id identifier rubyid_table_name_options'>table_name_options</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>unless</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_arguments'>arguments</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="delegate-class_method">
  <h3 class='signature rw  nodoc first'>
    .<strong>delegate</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L567-L567'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


567</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 567</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delegate'>delegate</span> <span class='comment'># :nodoc:</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="disable_ddl_transaction-class_method">
  <h3 class='signature rw  nodoc'>
    .<strong>disable_ddl_transaction</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L568-L568'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


568</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 568</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_disable_ddl_transaction'>disable_ddl_transaction</span> <span class='comment'># :nodoc:</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verbose-class_method">
  <h3 class='signature rw'>
    .<strong>verbose</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#verbose</span></span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L620-L620'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


620</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 620</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_cattr_accessor'>cattr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_verbose'>verbose</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="[]-class_method">
  <h3 class='signature  first'>
    .<strong>[]</strong>(version)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L532-L534'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


532
533
534</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 532</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_version'>version</span><span class='rparen'>)</span>
  <span class='const'><a href="Migration/Compatibility.html" title="ActiveRecord::Migration::Compatibility (module)">Compatibility</a></span><span class='period'>.</span><span class='id identifier rubyid_find'><a href="Migration/Compatibility.html#find-class_method" title="ActiveRecord::Migration::Compatibility.find (method)">find</a></span><span class='lparen'>(</span><span class='id identifier rubyid_version'>version</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_pending!-class_method">
  <h3 class='signature '>
    .<strong>check_pending!</strong>(connection = Base.connection)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raises <a href="PendingMigrationError.html" title="ActiveRecord::PendingMigrationError (class)">PendingMigrationError</a> error if any migrations are
pending.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="PendingMigrationError.html" title="ActiveRecord::PendingMigrationError (class)">ActiveRecord::PendingMigrationError</a>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L575-L577'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


575
576
577</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 575</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_pending!'>check_pending!</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_connection'><a href="ConnectionHandling.html#connection-instance_method" title="ActiveRecord::ConnectionHandling#connection (method)">connection</a></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="PendingMigrationError.html" title="ActiveRecord::PendingMigrationError (class)">PendingMigrationError</a></span> <span class='kw'>if</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_needs_migration?'><a href="Migrator.html#needs_migration%3F-class_method" title="ActiveRecord::Migrator.needs_migration? (method)">needs_migration?</a></span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="current_version-class_method">
  <h3 class='signature '>
    .<strong>current_version</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L536-L538'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


536
537
538</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 536</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_version'>current_version</span>
  <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="VERSION.html" title="ActiveRecord::VERSION (module)">VERSION</a></span><span class='op'>::</span><span class='const'><a href="VERSION.html#STRING-constant" title="ActiveRecord::VERSION::STRING (constant)">STRING</a></span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="disable_ddl_transaction!-class_method">
  <h3 class='signature '>
    .<strong>disable_ddl_transaction!</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Disable the transaction wrapping this migration. You can still create your
own transactions even after calling <code>#disable_ddl_transaction!</code></p>

<p>For more details read the <a href="rdoc-ref:Migration">"Transactional
Migrations" section above</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L611-L613'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


611
612
613</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 611</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_disable_ddl_transaction!'>disable_ddl_transaction!</span>
  <span class='ivar'>@disable_ddl_transaction</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inherited-class_method">
  <h3 class='signature nodoc'>
    .<strong>inherited</strong>(subclass)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L522-L530'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


522
523
524
525
526
527
528
529
530</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 522</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_inherited'>inherited</span><span class='lparen'>(</span><span class='id identifier rubyid_subclass'>subclass</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>super</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_subclass'>subclass</span><span class='period'>.</span><span class='id identifier rubyid_superclass'>superclass</span> <span class='op'>==</span> <span class='const'>Migration</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Directly inheriting from ActiveRecord::Migration is not supported. </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please specify the Rails release the migration was written for:\n</span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  class </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_subclass'>subclass</span><span class='embexpr_end'>}</span><span class='tstring_content'> &lt; ActiveRecord::Migration[4.2]</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="load_schema_if_pending!-class_method">
  <h3 class='signature '>
    .<strong>load_schema_if_pending!</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L579-L591'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


579
580
581
582
583
584
585
586
587
588
589
590
591</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 579</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_load_schema_if_pending!'>load_schema_if_pending!</span>
  <span class='kw'>if</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_needs_migration?'><a href="Migrator.html#needs_migration%3F-class_method" title="ActiveRecord::Migrator.needs_migration? (method)">needs_migration?</a></span> <span class='op'>||</span> <span class='op'>!</span><span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_any_migrations?'><a href="Migrator.html#any_migrations%3F-class_method" title="ActiveRecord::Migrator.any_migrations? (method)">any_migrations?</a></span>
    <span class='comment'># Roundtrip to Rake to allow plugins to hook into database initialization.
</span>    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_cd'>cd</span> <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span><span class='period'>.</span><span class='id identifier rubyid_root'><a href="../Rails.html#root-class_method" title="Rails.root (method)">root</a></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_current_config'>current_config</span> <span class='op'>=</span> <span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_connection_config'><a href="ConnectionHandling.html#connection_config-instance_method" title="ActiveRecord::ConnectionHandling#connection_config (method)">connection_config</a></span>
      <span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_clear_all_connections!'><a href="ConnectionHandling.html#clear_all_connections!-instance_method" title="ActiveRecord::ConnectionHandling#clear_all_connections! (method)">clear_all_connections!</a></span>
      <span class='id identifier rubyid_system'>system</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bin/rails db:test:prepare</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='comment'># Establish a new connection, the old database may be gone (db:test:prepare uses purge)
</span>      <span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_establish_connection'><a href="ConnectionHandling.html#establish_connection-instance_method" title="ActiveRecord::ConnectionHandling#establish_connection (method)">establish_connection</a></span><span class='lparen'>(</span><span class='id identifier rubyid_current_config'>current_config</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_check_pending!'>check_pending!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="maintain_test_schema!-class_method">
  <h3 class='signature nodoc'>
    .<strong>maintain_test_schema!</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L593-L597'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


593
594
595
596
597</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 593</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_maintain_test_schema!'>maintain_test_schema!</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_maintain_test_schema'><a href="Base.html#maintain_test_schema-class_method" title="ActiveRecord::Base.maintain_test_schema (method)">maintain_test_schema</a></span>
    <span class='id identifier rubyid_suppress_messages'>suppress_messages</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_load_schema_if_pending!'>load_schema_if_pending!</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="method_missing-class_method">
  <h3 class='signature nodoc'>
    .<strong>method_missing</strong>(name, *args, &amp;block)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L599-L601'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


599
600
601</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 599</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_nearest_delegate'>nearest_delegate</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="migrate-class_method">
  <h3 class='signature '>
    .<strong>migrate</strong>(direction)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L603-L605'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


603
604
605</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 603</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_migrate'>migrate</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_migrate'>migrate</span> <span class='id identifier rubyid_direction'>direction</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="nearest_delegate-class_method">
  <h3 class='signature nodoc'>
    .<strong>nearest_delegate</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L570-L572'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


570
571
572</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 570</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_nearest_delegate'>nearest_delegate</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_delegate'>delegate</span> <span class='op'>||</span> <span class='id identifier rubyid_superclass'>superclass</span><span class='period'>.</span><span class='id identifier rubyid_nearest_delegate'>nearest_delegate</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="name-instance_method">
  <h3 class='signature rw first'>
    #<strong>name</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L621-L621'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


621</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 621</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_version'>version</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reverting?-instance_method">
  <h3 class='signature ro'>
    #<strong>reverting?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L689-L691'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


689
690
691</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 689</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reverting?'>reverting?</span>
  <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_reverting'>reverting</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_reverting'>reverting</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verbose-instance_method">
  <h3 class='signature rw'>
    #<strong>verbose</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L620-L620'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


620</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 620</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_cattr_accessor'>cattr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_verbose'>verbose</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="version-instance_method">
  <h3 class='signature rw'>
    #<strong>version</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L621-L621'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


621</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 621</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_version'>version</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="announce-instance_method">
  <h3 class='signature  first'>
    #<strong>announce</strong>(message)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L805-L809'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


805
806
807
808
809</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 805</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_announce'>announce</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_length'>length</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>75</span> <span class='op'>-</span> <span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
  <span class='id identifier rubyid_write'>write</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>== %s %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connection-instance_method">
  <h3 class='signature '>
    #<strong>connection</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L831-L833'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


831
832
833</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 831</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connection'>connection</span>
  <span class='ivar'>@connection</span> <span class='op'>||</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_connection'><a href="ConnectionHandling.html#connection-instance_method" title="ActiveRecord::ConnectionHandling#connection (method)">connection</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="copy-instance_method">
  <h3 class='signature '>
    #<strong>copy</strong>(destination, sources, options = {})  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L853-L896'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 853</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_copy'>copy</span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='comma'>,</span> <span class='id identifier rubyid_sources'>sources</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_copied'>copied</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir_p'>mkdir_p</span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='const'><a href="../File.html" title="File (class)">File</a></span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_destination_migrations'>destination_migrations</span> <span class='op'>=</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_migrations'><a href="Migrator.html#migrations-class_method" title="ActiveRecord::Migrator.migrations (method)">migrations</a></span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='id identifier rubyid_destination_migrations'>destination_migrations</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
  <span class='id identifier rubyid_sources'>sources</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='op'>|</span>
    <span class='id identifier rubyid_source_migrations'>source_migrations</span> <span class='op'>=</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_migrations'><a href="Migrator.html#migrations-class_method" title="ActiveRecord::Migrator.migrations (method)">migrations</a></span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_source_migrations'>source_migrations</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_migration'>migration</span><span class='op'>|</span>
      <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='const'><a href="../File.html" title="File (class)">File</a></span><span class='period'>.</span><span class='id identifier rubyid_binread'>binread</span><span class='lparen'>(</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_inserted_comment'>inserted_comment</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'># This migration comes from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_scope'>scope</span><span class='embexpr_end'>}</span><span class='tstring_content'> (originally </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span><span class='embexpr_end'>}</span><span class='tstring_content'>)\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A#.*\b(?:en)?coding:\s*\S+</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_source'>source</span>
        <span class='comment'># If we have a magic comment in the original migration,
</span>        <span class='comment'># insert our comment after the first newline(end of the magic comment line)
</span>        <span class='comment'># so the magic keep working.
</span>        <span class='comment'># Note that magic comments must be at the first line(except sh-bang).
</span>        <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\n</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_inserted_comment'>inserted_comment</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_inserted_comment'>inserted_comment</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source'>source</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_duplicate'>duplicate</span> <span class='op'>=</span> <span class='id identifier rubyid_destination_migrations'>destination_migrations</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_on_skip'>on_skip</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_duplicate'>duplicate</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span> <span class='op'>!=</span> <span class='id identifier rubyid_scope'>scope</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
          <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_on_skip'>on_skip</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='id identifier rubyid_migration'>migration</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='id identifier rubyid_next_migration_number'>next_migration_number</span><span class='lparen'>(</span><span class='id identifier rubyid_last'>last</span> <span class='op'>?</span> <span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_new_path'>new_path</span> <span class='op'>=</span> <span class='const'><a href="../File.html" title="File (class)">File</a></span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_underscore'>underscore</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_scope'>scope</span><span class='embexpr_end'>}</span><span class='tstring_content'>.rb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_old_path'>old_path</span><span class='comma'>,</span> <span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_filename'>filename</span> <span class='op'>=</span> <span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_new_path'>new_path</span>
      <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='id identifier rubyid_migration'>migration</span>

      <span class='const'><a href="../File.html" title="File (class)">File</a></span><span class='period'>.</span><span class='id identifier rubyid_binwrite'>binwrite</span><span class='lparen'>(</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_copied'>copied</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_migration'>migration</span>
      <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_on_copy'>on_copy</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='id identifier rubyid_migration'>migration</span><span class='comma'>,</span> <span class='id identifier rubyid_old_path'>old_path</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_on_copy'>on_copy</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_destination_migrations'>destination_migrations</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_migration'>migration</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_copied'>copied</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="disable_ddl_transaction-instance_method">
  <h3 class='signature nodoc'>
    #<strong>disable_ddl_transaction</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L616-L618'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


616
617
618</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 616</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_disable_ddl_transaction'>disable_ddl_transaction</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_disable_ddl_transaction'>disable_ddl_transaction</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="down-instance_method">
  <h3 class='signature '>
    #<strong>down</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L758-L762'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


758
759
760
761
762</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 758</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_delegate'>delegate</span> <span class='op'>=</span> <span class='kw'>self</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_down'>down</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_down'>down</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exec_migration-instance_method">
  <h3 class='signature '>
    #<strong>exec_migration</strong>(conn, direction)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L786-L799'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


786
787
788
789
790
791
792
793
794
795
796
797
798
799</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 786</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_exec_migration'>exec_migration</span><span class='lparen'>(</span><span class='id identifier rubyid_conn'>conn</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
  <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_conn'>conn</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_change'>change</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_direction'>direction</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_down'>down</span>
      <span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_change'>change</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_change'>change</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="execute_block-instance_method">
  <h3 class='signature priv'>
    #<strong>execute_block</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L928-L934'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


928
929
930
931
932
933
934</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 928</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_block'>execute_block</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_execute_block'>execute_block</span>
    <span class='kw'>super</span> <span class='comment'># use normal delegation to record the block
</span>  <span class='kw'>else</span>
    <span class='kw'>yield</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="migrate-instance_method">
  <h3 class='signature '>
    #<strong>migrate</strong>(direction)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute this migration in the named direction</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L765-L784'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 765</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_migrate'>migrate</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_direction'>direction</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_up'>up</span>   <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>migrating</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_down'>down</span> <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reverting</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_connection_pool'><a href="ConnectionHandling.html#connection_pool-instance_method" title="ActiveRecord::ConnectionHandling#connection_pool (method)">connection_pool</a></span><span class='period'>.</span><span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_conn'>conn</span><span class='op'>|</span>
    <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="../Benchmark.html" title="Benchmark (class)">Benchmark</a></span><span class='period'>.</span><span class='id identifier rubyid_measure'>measure</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_exec_migration'>exec_migration</span><span class='lparen'>(</span><span class='id identifier rubyid_conn'>conn</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_direction'>direction</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_up'>up</span>   <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>migrated (%.4fs)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='semicolon'>;</span> <span class='id identifier rubyid_write'>write</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_down'>down</span> <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reverted (%.4fs)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='semicolon'>;</span> <span class='id identifier rubyid_write'>write</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="next_migration_number-instance_method">
  <h3 class='signature '>
    #<strong>next_migration_number</strong>(number)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Determines the version number of the next migration.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L910-L916'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


910
911
912
913
914
915
916</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 910</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_next_migration_number'>next_migration_number</span><span class='lparen'>(</span><span class='id identifier rubyid_number'>number</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_timestamped_migrations'><a href="Base.html#timestamped_migrations-class_method" title="ActiveRecord::Base.timestamped_migrations (method)">timestamped_migrations</a></span>
    <span class='lbracket'>[</span><span class='const'><a href="../Time.html" title="Time (class)">Time</a></span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_utc'>utc</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%Y%m%d%H%M%S</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.14d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_number'>number</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
  <span class='kw'>else</span>
    <span class='const'><a href="SchemaMigration.html" title="ActiveRecord::SchemaMigration (class)">SchemaMigration</a></span><span class='period'>.</span><span class='id identifier rubyid_normalize_migration_number'><a href="SchemaMigration.html#normalize_migration_number-class_method" title="ActiveRecord::SchemaMigration.normalize_migration_number (method)">normalize_migration_number</a></span><span class='lparen'>(</span><span class='id identifier rubyid_number'>number</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="proper_table_name-instance_method">
  <h3 class='signature '>
    #<strong>proper_table_name</strong>(name, options = {})  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Finds the correct table name given an Active Record object. Uses the Active
Record object&#39;s own table_name, or pre/suffix from the options passed
in.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L901-L907'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


901
902
903
904
905
906
907</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 901</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_proper_table_name'>proper_table_name</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_table_name'>table_name</span>
    <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_table_name_prefix'>table_name_prefix</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_table_name_suffix'>table_name_suffix</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reversible-instance_method">
  <h3 class='signature '>
    #<strong>reversible</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Used to specify an operation that can be run in one direction or another.
Call the methods <a href="#up-instance_method" title="ActiveRecord::Migration#up (method)">#up</a> and <a href="#down-instance_method" title="ActiveRecord::Migration#down (method)">#down</a> of the yielded object to run a block only
in one given direction. The whole block will be called in the right order
within the migration.</p>

<p>In the following example, the looping on users will always be done when the
three columns &#39;first_name&#39;, &#39;last_name&#39; and
&#39;full_name&#39; exist, even when migrating down:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>SplitNameMigration</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_users'>users</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_name'>first_name</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_string'>string</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_users'>users</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_last_name'>last_name</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_string'>string</span>

    <span class='id identifier rubyid_reversible'>reversible</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dir'>dir</span><span class='op'>|</span>
      <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_reset_column_information'>reset_column_information</span>
      <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
        <span class='id identifier rubyid_dir'>dir</span><span class='period'>.</span><span class='id identifier rubyid_up'>up</span>   <span class='lbrace'>{</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span><span class='comma'>,</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span> <span class='op'>=</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_dir'>dir</span><span class='period'>.</span><span class='id identifier rubyid_down'>down</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_users'>users</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_full_name'>full_name</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_string'>string</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L729-L732'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


729
730
731
732</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 729</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reversible'>reversible</span>
  <span class='id identifier rubyid_helper'>helper</span> <span class='op'>=</span> <span class='const'><a href="Migration/ReversibleBlockHelper.html" title="ActiveRecord::Migration::ReversibleBlockHelper (class)">ReversibleBlockHelper</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveRecord::Migration.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_reverting?'>reverting?</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_execute_block'>execute_block</span> <span class='lbrace'>{</span> <span class='kw'>yield</span> <span class='id identifier rubyid_helper'>helper</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="revert-instance_method">
  <h3 class='signature '>
    #<strong>revert</strong>(*migration_classes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reverses the migration commands for the given block and the given
migrations.</p>

<p>The following migration will remove the table &#39;horses&#39; and create
the table &#39;apples&#39; on the way up, and the reverse on the way down.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>FixTLMigration</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_revert'>revert</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_create_table'>create_table</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_horses'>horses</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='symbeg'>:</span><span class='id identifier rubyid_content'>content</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_datetime'>datetime</span> <span class='symbeg'>:</span><span class='id identifier rubyid_remind_at'>remind_at</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_create_table'>create_table</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_apples'>apples</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span> <span class='symbeg'>:</span><span class='id identifier rubyid_variety'>variety</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Or equivalently, if <code>TenderloveMigration</code> is defined as in the
documentation for Migration:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>20121212123456_tenderlove_migration</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>FixupTLMigration</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_revert'>revert</span> <span class='const'>TenderloveMigration</span>

    <span class='id identifier rubyid_create_table'>create_table</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_apples'>apples</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span> <span class='symbeg'>:</span><span class='id identifier rubyid_variety'>variety</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This command can be nested.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L670-L687'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 670</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_revert'>revert</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='comma'>,</span> <span class='label'>revert:</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_revert'>revert</span>
      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='kw'>yield</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_recorder'>recorder</span> <span class='op'>=</span> <span class='const'><a href="Migration/CommandRecorder.html" title="ActiveRecord::Migration::CommandRecorder (class)">CommandRecorder</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Migration/CommandRecorder.html#new-class_method" title="ActiveRecord::Migration::CommandRecorder.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
      <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_recorder'>recorder</span>
      <span class='id identifier rubyid_suppress_messages'>suppress_messages</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='kw'>yield</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
      <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_recorder'>recorder</span><span class='period'>.</span><span class='id identifier rubyid_delegate'>delegate</span>
      <span class='id identifier rubyid_recorder'>recorder</span><span class='period'>.</span><span class='id identifier rubyid_commands'>commands</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='op'>|</span>
        <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run-instance_method">
  <h3 class='signature '>
    #<strong>run</strong>(*migration_classes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Runs the given migration classes. Last argument can specify options:</p>
<ul><li>
<p>:direction (default is :up)</p>
</li><li>
<p>:revert (default is false)</p>
</li></ul>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L738-L750'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


738
739
740
741
742
743
744
745
746
747
748
749
750</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 738</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='period'>.</span><span class='id identifier rubyid_extract_options!'>extract_options!</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_direction'>direction</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='symbeg'>:</span><span class='id identifier rubyid_up'>up</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_down'>down</span> <span class='op'>?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_up'>up</span> <span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_down'>down</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_revert'>revert</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_reverting?'>reverting?</span>
    <span class='comment'># If in revert and going :up, say, we want to execute :down without reverting, so
</span>    <span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='comma'>,</span> <span class='label'>direction:</span> <span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='label'>revert:</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_migration_class'>migration_class</span><span class='op'>|</span>
      <span class='id identifier rubyid_migration_class'>migration_class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_exec_migration'>exec_migration</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="say-instance_method">
  <h3 class='signature '>
    #<strong>say</strong>(message, subitem = false)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L811-L813'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


811
812
813</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 811</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_say'>say</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_subitem'>subitem</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_write'>write</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_subitem'>subitem</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>   -&gt;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="say_with_time-instance_method">
  <h3 class='signature '>
    #<strong>say_with_time</strong>(message)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L815-L822'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


815
816
817
818
819
820
821
822</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 815</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_say_with_time'>say_with_time</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_say'>say</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="../Benchmark.html" title="Benchmark (class)">Benchmark</a></span><span class='period'>.</span><span class='id identifier rubyid_measure'>measure</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>yield</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_say'>say</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.4fs</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_subitem'>subitem</span>
  <span class='id identifier rubyid_say'>say</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span><span class='embexpr_end'>}</span><span class='tstring_content'> rows</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_subitem'>subitem</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><a href="../Integer.html" title="Integer (class)">Integer</a></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="suppress_messages-instance_method">
  <h3 class='signature '>
    #<strong>suppress_messages</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L824-L829'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


824
825
826
827
828
829</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 824</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_suppress_messages'>suppress_messages</span>
  <span class='id identifier rubyid_save'>save</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_verbose'>verbose</span> <span class='op'>=</span> <span class='id identifier rubyid_verbose'>verbose</span><span class='comma'>,</span> <span class='kw'>false</span>
  <span class='kw'>yield</span>
<span class='kw'>ensure</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_verbose'>verbose</span> <span class='op'>=</span> <span class='id identifier rubyid_save'>save</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="table_name_options-instance_method">
  <h3 class='signature nodoc'>
    #<strong>table_name_options</strong>(config = ActiveRecord::Base)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Builds a hash for use in <a href="#proper_table_name-instance_method" title="ActiveRecord::Migration#proper_table_name (method)">#proper_table_name</a> using
the Active Record object&#39;s table_name prefix and suffix</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L920-L925'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


920
921
922
923
924
925</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 920</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_table_name_options'>table_name_options</span><span class='lparen'>(</span><span class='id identifier rubyid_config'>config</span> <span class='op'>=</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='lbrace'>{</span>
    <span class='label'>table_name_prefix:</span> <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_table_name_prefix'>table_name_prefix</span><span class='comma'>,</span>
    <span class='label'>table_name_suffix:</span> <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_table_name_suffix'>table_name_suffix</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="up-instance_method">
  <h3 class='signature '>
    #<strong>up</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L752-L756'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


752
753
754
755
756</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 752</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_delegate'>delegate</span> <span class='op'>=</span> <span class='kw'>self</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_up'>up</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_up'>up</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write-instance_method">
  <h3 class='signature '>
    #<strong>write</strong>(text = &quot;&quot;)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L801-L803'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


801
802
803</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 801</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_text'>text</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_verbose'>verbose</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.8 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.5.0p-1)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>