<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Transactions &mdash; Rails-master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Transactions",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
        <a href='../../index.html'>Home</a> &raquo; 
        <a href='../index.html'>Rails-master</a> &raquo; 
        <a href='../_index.html#alpha_T'>Index (T)</a> &raquo; 
        <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <span class='title'><a id='t2_doc_top' href='#'>Transactions&nbsp;&#x25B2;</a></span>
      </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::Transactions</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="Transactions/ClassMethods.html" title="ActiveRecord::Transactions::ClassMethods (module)">ClassMethods</a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Base.html" title="ActiveRecord::Base (class)">Base</a>,
          <a class='nodoc' href="InternalMetadata.html" title="ActiveRecord::InternalMetadata (class)">InternalMetadata</a>,
          <a class='nodoc' href="SchemaMigration.html" title="ActiveRecord::SchemaMigration (class)">SchemaMigration</a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">::ActiveSupport::Concern</a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L3'>activerecord/lib/active_record/transactions.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>See <a href="Transactions/ClassMethods.html" title="ActiveRecord::Transactions::ClassMethods (module)">ClassMethods</a> for documentation.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='ACTIONS-constant' class='summary_signature nodoc'>ACTIONS =</span>
    <span class='nodoc note title'>Internal use only</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L6-L6'># File 'activerecord/lib/active_record/transactions.rb', line 6</a>    <pre class='code ruby'><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update'>update</span><span class='rbracket'>]</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">::ActiveSupport::Concern</a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>,
        <a class='i_m ' href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a>,
        <a class='i_m ' href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>
        

<h2 class='h2_sum' id='instance_Attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#has_transactional_callbacks%3F-instance_method" title="#has_transactional_callbacks? (instance method)">#<strong>has_transactional_callbacks?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#add_to_transaction-instance_method" title="#add_to_transaction (instance method)">#<strong>add_to_transaction</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Add the record to the current transaction so that the <code>#after_rollback</code> and
<code>#after_commit</code> callbacks can be called.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#rollback_active_record_state!-instance_method" title="#rollback_active_record_state! (instance method)">#<strong>rollback_active_record_state!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reset id and @new_record if the transaction rolls back.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#transaction-instance_method" title="#transaction (instance method)">#<strong>transaction</strong>(options = {}, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>See <a href="Transactions/ClassMethods.html" title="ActiveRecord::Transactions::ClassMethods (module)">ClassMethods</a> for detailed documentation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with_transaction_returning_status-instance_method" title="#with_transaction_returning_status (instance method)">#<strong>with_transaction_returning_status</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Executes <code>method</code> within a transaction and captures its return value as a
status flag.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#clear_transaction_record_state-instance_method" title="#clear_transaction_record_state (instance method)">#<strong>clear_transaction_record_state</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Clear the new record state and id of a record.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#force_clear_transaction_record_state-instance_method" title="#force_clear_transaction_record_state (instance method)">#<strong>force_clear_transaction_record_state</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Force to clear the transaction record state.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#remember_transaction_record_state-instance_method" title="#remember_transaction_record_state (instance method)">#<strong>remember_transaction_record_state</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Save the new record state and id of a record so it can be restored later if
a transaction fails.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#restore_transaction_record_state-instance_method" title="#restore_transaction_record_state (instance method)">#<strong>restore_transaction_record_state</strong>(force = false)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Restore the new record state and id of a record that was previously saved
by a call to save_record_state.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#set_transaction_state-instance_method" title="#set_transaction_state (instance method)">#<strong>set_transaction_state</strong>(state)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#sync_with_transaction_state-instance_method" title="#sync_with_transaction_state (instance method)">#<strong>sync_with_transaction_state</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates the attributes on this particular Active Record object so that if
it&#39;s associated with a transaction, then the state of the Active Record
object will be updated to reflect the current state of the transaction.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#transaction_include_any_action%3F-instance_method" title="#transaction_include_any_action? (instance method)">#<strong>transaction_include_any_action?</strong>(actions)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Determine if a transaction included an action for :create, :update, or
:destroy.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#transaction_record_state-instance_method" title="#transaction_record_state (instance method)">#<strong>transaction_record_state</strong>(state)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Determine if a record was created or destroyed in a transaction.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#update_attributes_from_transaction_state-instance_method" title="#update_attributes_from_transaction_state (instance method)">#<strong>update_attributes_from_transaction_state</strong>(transaction_state)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#before_committed!-instance_method" title="#before_committed! (instance method)">#<strong>before_committed!</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#committed!-instance_method" title="#committed! (instance method)">#<strong>committed!</strong>(should_run_callbacks: true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Call the <code>#after_commit</code> callbacks.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#rolledback!-instance_method" title="#rolledback! (instance method)">#<strong>rolledback!</strong>(force_restore_state: false, should_run_callbacks: true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Call the <code>#after_rollback</code> callbacks.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#save-instance_method" title="#save (instance method)">#<strong>save</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#save!-instance_method" title="#save! (instance method)">#<strong>save!</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#touch-instance_method" title="#touch (instance method)">#<strong>touch</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>
<h2 class='y_details'>DSL Calls</h2>
<section class='method_details first' id="included-dslcall">
<h3 class='signature'><strong>included</strong></h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L8-L15'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


8
9
10
11
12
13
14
15</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 8</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_define_callbacks'>define_callbacks</span> <span class='symbeg'>:</span><span class='id identifier rubyid_commit'>commit</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rollback'>rollback</span><span class='comma'>,</span>
                   <span class='symbeg'>:</span><span class='id identifier rubyid_before_commit'>before_commit</span><span class='comma'>,</span>
                   <span class='symbeg'>:</span><span class='id identifier rubyid_before_commit_without_transaction_enrollment'>before_commit_without_transaction_enrollment</span><span class='comma'>,</span>
                   <span class='symbeg'>:</span><span class='id identifier rubyid_commit_without_transaction_enrollment'>commit_without_transaction_enrollment</span><span class='comma'>,</span>
                   <span class='symbeg'>:</span><span class='id identifier rubyid_rollback_without_transaction_enrollment'>rollback_without_transaction_enrollment</span><span class='comma'>,</span>
                   <span class='label'>scope:</span> <span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="has_transactional_callbacks?-instance_method">
  <h3 class='signature ro priv first'>
    #<strong>has_transactional_callbacks?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L465-L467'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


465
466
467</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 465</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_has_transactional_callbacks?'>has_transactional_callbacks?</span>
  <span class='op'>!</span><span class='id identifier rubyid__rollback_callbacks'>_rollback_callbacks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid__commit_callbacks'>_commit_callbacks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid__before_commit_callbacks'>_before_commit_callbacks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="add_to_transaction-instance_method">
  <h3 class='signature  first'>
    #<strong>add_to_transaction</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Add the record to the current transaction so that the <code>#after_rollback</code> and
<code>#after_commit</code> callbacks can be called.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L363-L371'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


363
364
365
366
367
368
369
370
371</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 363</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add_to_transaction'>add_to_transaction</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_has_transactional_callbacks?'>has_transactional_callbacks?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_add_transaction_record'>add_transaction_record</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_sync_with_transaction_state'>sync_with_transaction_state</span>
    <span class='id identifier rubyid_set_transaction_state'>set_transaction_state</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_transaction_state'>transaction_state</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_remember_transaction_record_state'>remember_transaction_record_state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="before_committed!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>before_committed!</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L331-L334'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


331
332
333
334</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 331</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_before_committed!'>before_committed!</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid__run_before_commit_without_transaction_enrollment_callbacks'>_run_before_commit_without_transaction_enrollment_callbacks</span>
  <span class='id identifier rubyid__run_before_commit_callbacks'>_run_before_commit_callbacks</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clear_transaction_record_state-instance_method">
  <h3 class='signature priv'>
    #<strong>clear_transaction_record_state</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Clear the new record state and id of a record.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L413-L416'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


413
414
415
416</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 413</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
  <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='id identifier rubyid_force_clear_transaction_record_state'>force_clear_transaction_record_state</span> <span class='kw'>if</span> <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='int'>1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="committed!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>committed!</strong>(should_run_callbacks: true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Call the <code>#after_commit</code> callbacks.</p>

<p>Ensure that it is not called if the object was never persisted (failed
create), but call it after the commit of a destroyed object.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L340-L347'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


340
341
342
343
344
345
346
347</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 340</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_committed!'>committed!</span><span class='lparen'>(</span><span class='label'>should_run_callbacks:</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_should_run_callbacks'>should_run_callbacks</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_destroyed?'>destroyed?</span> <span class='op'>||</span> <span class='id identifier rubyid_persisted?'>persisted?</span>
    <span class='id identifier rubyid__run_commit_without_transaction_enrollment_callbacks'>_run_commit_without_transaction_enrollment_callbacks</span>
    <span class='id identifier rubyid__run_commit_callbacks'>_run_commit_callbacks</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_force_clear_transaction_record_state'>force_clear_transaction_record_state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy-instance_method">
  <h3 class='signature nodoc'>
    #<strong>destroy</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L302-L304'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


302
303
304</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 302</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="force_clear_transaction_record_state-instance_method">
  <h3 class='signature priv'>
    #<strong>force_clear_transaction_record_state</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Force to clear the transaction record state.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L419-L421'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


419
420
421</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 419</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_force_clear_transaction_record_state'>force_clear_transaction_record_state</span>
  <span class='ivar'>@_start_transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="remember_transaction_record_state-instance_method">
  <h3 class='signature priv'>
    #<strong>remember_transaction_record_state</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Save the new record state and id of a record so it can be restored later if
a transaction fails.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L402-L410'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


402
403
404
405
406
407
408
409
410</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 402</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_remember_transaction_record_state'>remember_transaction_record_state</span>
  <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>
  <span class='ivar'>@_start_transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_reverse_merge!'>reverse_merge!</span><span class='lparen'>(</span>
    <span class='label'>new_record:</span> <span class='ivar'>@new_record</span><span class='comma'>,</span>
    <span class='label'>destroyed:</span> <span class='ivar'>@destroyed</span><span class='comma'>,</span>
    <span class='label'>frozen?:</span> <span class='id identifier rubyid_frozen?'>frozen?</span><span class='comma'>,</span>
  <span class='rparen'>)</span>
  <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="restore_transaction_record_state-instance_method">
  <h3 class='signature priv'>
    #<strong>restore_transaction_record_state</strong>(force = false)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Restore the new record state and id of a record that was previously saved
by a call to save_record_state.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L424-L439'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 424</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_restore_transaction_record_state'>restore_transaction_record_state</span><span class='lparen'>(</span><span class='id identifier rubyid_force'>force</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='ivar'>@_start_transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_transaction_level'>transaction_level</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_transaction_level'>transaction_level</span> <span class='op'>&lt;</span> <span class='int'>1</span> <span class='op'>||</span> <span class='id identifier rubyid_force'>force</span>
      <span class='id identifier rubyid_restore_state'>restore_state</span> <span class='op'>=</span> <span class='ivar'>@_start_transaction_state</span>
      <span class='id identifier rubyid_thaw'>thaw</span>
      <span class='ivar'>@new_record</span> <span class='op'>=</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_new_record'>new_record</span><span class='rbracket'>]</span>
      <span class='ivar'>@destroyed</span>  <span class='op'>=</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_destroyed'>destroyed</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_primary_key'>primary_key</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_pk'>pk</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_read_attribute'>read_attribute</span><span class='lparen'>(</span><span class='id identifier rubyid_pk'>pk</span><span class='rparen'>)</span> <span class='op'>!=</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_write_attribute'>write_attribute</span><span class='lparen'>(</span><span class='id identifier rubyid_pk'>pk</span><span class='comma'>,</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_freeze'>freeze</span> <span class='kw'>if</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_frozen?'>frozen?</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="rollback_active_record_state!-instance_method">
  <h3 class='signature '>
    #<strong>rollback_active_record_state!</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reset id and @new_record if the transaction rolls back.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L321-L329'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


321
322
323
324
325
326
327
328
329</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 321</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_rollback_active_record_state!'>rollback_active_record_state!</span>
  <span class='id identifier rubyid_remember_transaction_record_state'>remember_transaction_record_state</span>
  <span class='kw'>yield</span>
<span class='kw'>rescue</span> <span class='const'><a href="../Exception.html" title="Exception (class)">Exception</a></span>
  <span class='id identifier rubyid_restore_transaction_record_state'>restore_transaction_record_state</span>
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="rolledback!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>rolledback!</strong>(force_restore_state: false, should_run_callbacks: true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Call the <code>#after_rollback</code> callbacks. The <code>force_restore_state</code> argument
indicates if the record state should be rolled back to the beginning or
just to the last savepoint.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L351-L359'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


351
352
353
354
355
356
357
358
359</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 351</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_rolledback!'>rolledback!</span><span class='lparen'>(</span><span class='label'>force_restore_state:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>should_run_callbacks:</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_should_run_callbacks'>should_run_callbacks</span>
    <span class='id identifier rubyid__run_rollback_callbacks'>_run_rollback_callbacks</span>
    <span class='id identifier rubyid__run_rollback_without_transaction_enrollment_callbacks'>_run_rollback_without_transaction_enrollment_callbacks</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_restore_transaction_record_state'>restore_transaction_record_state</span><span class='lparen'>(</span><span class='id identifier rubyid_force_restore_state'>force_restore_state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save-instance_method">
  <h3 class='signature nodoc'>
    #<strong>save</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L306-L310'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


306
307
308
309
310</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 306</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save'>save</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid_rollback_active_record_state!'>rollback_active_record_state!</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>save!</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L312-L314'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


312
313
314</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 312</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save!'>save!</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_transaction_state-instance_method">
  <h3 class='signature priv'>
    #<strong>set_transaction_state</strong>(state)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L461-L463'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


461
462
463</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 461</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_transaction_state'>set_transaction_state</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='ivar'>@transaction_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sync_with_transaction_state-instance_method">
  <h3 class='signature priv'>
    #<strong>sync_with_transaction_state</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates the attributes on this particular Active Record object so that if
it&#39;s associated with a transaction, then the state of the Active Record
object will be updated to reflect the current state of the transaction.</p>

<p>The <tt>@transaction_state</tt> variable stores the states of the associated
transaction. This relies on the fact that a transaction can only be in one
rollback or commit (otherwise a list of states would be required). Each
Active Record object inside of a transaction carries that transaction&#39;s
TransactionState.</p>

<p>This method checks to see if the <a href="../ActiveRecord.html" title="ActiveRecord (module)">::ActiveRecord</a> object&#39;s state reflects
the TransactionState, and rolls back or commits the Active Record object as
appropriate.</p>

<p>Since Active Record objects can be inside multiple transactions, this
method recursively goes through the parent of the TransactionState and
checks if the Active Record object reflects the state of the object.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L486-L488'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


486
487
488</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 486</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sync_with_transaction_state'>sync_with_transaction_state</span>
  <span class='id identifier rubyid_update_attributes_from_transaction_state'>update_attributes_from_transaction_state</span><span class='lparen'>(</span><span class='ivar'>@transaction_state</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="touch-instance_method">
  <h3 class='signature nodoc'>
    #<strong>touch</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L316-L318'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


316
317
318</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 316</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="transaction-instance_method">
  <h3 class='signature '>
    #<strong>transaction</strong>(options = {}, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>See <a href="Transactions/ClassMethods.html" title="ActiveRecord::Transactions::ClassMethods (module)">Transactions::ClassMethods</a> for detailed documentation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L298-L300'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


298
299
300</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 298</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="transaction_include_any_action?-instance_method">
  <h3 class='signature priv'>
    #<strong>transaction_include_any_action?</strong>(actions)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Determine if a transaction included an action for :create, :update, or
:destroy. Used in filtering callbacks.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L447-L459'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


447
448
449
450
451
452
453
454
455
456
457
458
459</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 447</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction_include_any_action?'>transaction_include_any_action?</span><span class='lparen'>(</span><span class='id identifier rubyid_actions'>actions</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_actions'>actions</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_action'>action</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_action'>action</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span>
      <span class='id identifier rubyid_transaction_record_state'>transaction_record_state</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_new_record'>new_record</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>
      <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@_trigger_destroy_callback</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@_trigger_destroy_callback</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update'>update</span>
      <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_transaction_record_state'>transaction_record_state</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_new_record'>new_record</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_destroyed?'>destroyed?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span>
        <span class='lparen'>(</span><span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@_trigger_update_callback</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@_trigger_update_callback</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="transaction_record_state-instance_method">
  <h3 class='signature priv'>
    #<strong>transaction_record_state</strong>(state)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Determine if a record was created or destroyed in a transaction. State
should be one of :new_record or :destroyed.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L442-L444'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


442
443
444</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 442</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction_record_state'>transaction_record_state</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span>
  <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_attributes_from_transaction_state-instance_method">
  <h3 class='signature priv'>
    #<strong>update_attributes_from_transaction_state</strong>(transaction_state)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L490-L495'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


490
491
492
493
494
495</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 490</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_attributes_from_transaction_state'>update_attributes_from_transaction_state</span><span class='lparen'>(</span><span class='id identifier rubyid_transaction_state'>transaction_state</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_transaction_state'>transaction_state</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_transaction_state'>transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_finalized?'>finalized?</span>
    <span class='id identifier rubyid_restore_transaction_record_state'>restore_transaction_record_state</span> <span class='kw'>if</span> <span class='id identifier rubyid_transaction_state'>transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_rolledback?'>rolledback?</span>
    <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_transaction_returning_status-instance_method">
  <h3 class='signature '>
    #<strong>with_transaction_returning_status</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Executes <code>method</code> within a transaction and captures its return value as a
status flag. If the status is true the transaction is committed, otherwise
a ROLLBACK is issued. In any case the status flag is returned.</p>

<p>This method is available within the context of an <a href="Base.html" title="ActiveRecord::Base (class)">Base</a>
instance.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L379-L397'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 379</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span>
  <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_add_to_transaction'>add_to_transaction</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='kw'>yield</span>
    <span class='kw'>rescue</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Rollback.html" title="ActiveRecord::Rollback (class)">Rollback</a></span>
      <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
      <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Rollback.html" title="ActiveRecord::Rollback (class)">Rollback</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_status'>status</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_status'>status</span>
<span class='kw'>ensure</span>
  <span class='kw'>if</span> <span class='ivar'>@transaction_state</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_committed?'>committed?</span>
    <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.8 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.5.0p-1)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>