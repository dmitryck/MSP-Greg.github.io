<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionController::RequestForgeryProtection &mdash; Rails-5-1-stable</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActionController::RequestForgeryProtection",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
        <a href='../../index.html'>Home</a> &raquo; 
        <a href='../index.html'>Rails-5-1-stable</a> &raquo; 
        <a href='../_index.html#alpha_R'>Index (R)</a> &raquo; 
        <a href="../ActionController.html" title="ActionController (module)">ActionController</a> &raquo; 
        <span class='title'><a id='t2_doc_top' href='#'>RequestForgeryProtection&nbsp;&#x25B2;</a></span>
      </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActionController::RequestForgeryProtection</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="RequestForgeryProtection/ClassMethods.html" title="ActionController::RequestForgeryProtection::ClassMethods (module)">ClassMethods</a>,
        <a href="RequestForgeryProtection/ProtectionMethods.html" title="ActionController::RequestForgeryProtection::ProtectionMethods (module)">ProtectionMethods</a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Base.html" title="ActionController::Base (class)">Base</a>,
          <a href="../ActionView/TestCase/TestController.html" title="ActionView::TestCase::TestController (class)">::ActionView::TestCase::TestController</a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../AbstractController/Callbacks/ClassMethods.html" title="AbstractController::Callbacks::ClassMethods (module)">::AbstractController::Callbacks::ClassMethods</a>,
          <a href="../ActiveSupport/DescendantsTracker.html" title="ActiveSupport::DescendantsTracker (module)">::ActiveSupport::DescendantsTracker</a>,
          <a href="../ActiveSupport/Callbacks/ClassMethods.html" title="ActiveSupport::Callbacks::ClassMethods (module)">::ActiveSupport::Callbacks::ClassMethods</a>,
          <a href="../AbstractController/Helpers/ClassMethods.html" title="AbstractController::Helpers::ClassMethods (module)">::AbstractController::Helpers::ClassMethods</a>,
          <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">::ActiveSupport::Concern</a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="../AbstractController/Callbacks.html" title="AbstractController::Callbacks (module)">::AbstractController::Callbacks</a>,
          <a href="../ActiveSupport/Callbacks.html" title="ActiveSupport::Callbacks (module)">::ActiveSupport::Callbacks</a>,
          <a href="../AbstractController/Helpers.html" title="AbstractController::Helpers (module)">::AbstractController::Helpers</a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L56'>actionpack/lib/action_controller/metal/request_forgery_protection.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Controller actions are protected from Cross-Site Request Forgery (CSRF)
attacks by including a token in the rendered HTML for your application.
This token is stored as a random string in the session, to which an
attacker does not have access. When a request reaches your application,
Rails verifies the received token with the token in the session. All
requests are checked except GET requests as these should be idempotent.
Keep in mind that all session-oriented requests should be CSRF protected,
including JavaScript and HTML requests.</p>

<p>Since HTML and JavaScript requests are typically made from the browser, we
need to ensure to verify request authenticity for the web browser. We can
use session-oriented authentication for these types of requests, by using
the `protect_from_forgery` method in our controllers.</p>

<p>GET requests are not protected since they don&#39;t have side effects like
writing to the database and don&#39;t leak sensitive information.
JavaScript requests are an exception: a third-party site can use a
&lt;script&gt; tag to reference a JavaScript URL on your site. When your
JavaScript response loads on their site, it executes. With carefully
crafted JavaScript on their end, sensitive data in your JavaScript response
may be extracted. To prevent this, only XmlHttpRequest (known as XHR or
Ajax) requests are allowed to make GET requests for JavaScript responses.</p>

<p>It&#39;s important to remember that XML or JSON requests are also affected
and if you&#39;re building an <a href="API.html" title="ActionController::API (class)">API</a> you should change
forgery protection method in <code>ApplicationController</code> (by default:
<code>:exception</code>):</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span> <span class='label'>unless:</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json?'>json?</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></code></pre>

<p>CSRF protection is turned on with the <code>protect_from_forgery</code> method. By
default <code>protect_from_forgery</code> protects your session with
<code>:null_session</code> method, which provides an empty session during
request.</p>

<p>We may want to disable CSRF protection for APIs since they are typically
designed to be state-less. That is, the request <a href="API.html" title="ActionController::API (class)">API</a>
client will handle the session for you instead of <a href="../Rails.html" title="Rails (module)">::Rails</a>.</p>

<p>The token parameter is named <code>authenticity_token</code> by default. The name and
value of this token must be added to every layout that renders forms by
including <code>csrf_meta_tags</code> in the HTML <code>head</code>.</p>

<p>Learn more about CSRF attacks and securing your application in the <a
href="http://guides.rubyonrails.org/security.html">Ruby on <a href="../Rails.html" title="Rails (module)">::Rails</a> Security
Guide</a>.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='AUTHENTICITY_TOKEN_LENGTH-constant' class='summary_signature'>AUTHENTICITY_TOKEN_LENGTH =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L261-L261'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 261</a>    <pre class='code ruby'><span class='int'>32</span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="../ActiveSupport/Callbacks.html" title="ActiveSupport::Callbacks (module)">::ActiveSupport::Callbacks</a> - Included</h3>
  <p  class='inherited'>
    <a href="../ActiveSupport/Callbacks.html#CALLBACK_FILTER_TYPES-constant" title="ActiveSupport::Callbacks::CALLBACK_FILTER_TYPES (constant)">CALLBACK_FILTER_TYPES</a>
  </p>
</div>

<h2 class='h2_sum'><a href="../AbstractController/Helpers.html" title="AbstractController::Helpers (module)">::AbstractController::Helpers</a> - Attributes &amp; Methods</h2>
<div>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helper_methods-class_method" title="._helper_methods (class method)">.<strong>_helper_methods</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helper_methods-instance_method" title="#_helper_methods (instance method)">#<strong>_helper_methods</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helper_methods%3F-class_method" title="._helper_methods? (class method)">.<strong>_helper_methods?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helper_methods%3F-instance_method" title="#_helper_methods? (instance method)">#<strong>_helper_methods?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helpers-class_method" title="._helpers (class method)">.<strong>_helpers</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helpers-instance_method" title="#_helpers (instance method)">#<strong>_helpers</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helpers%3F-class_method" title="._helpers? (class method)">.<strong>_helpers?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helpers%3F-instance_method" title="#_helpers? (instance method)">#<strong>_helpers?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="../AbstractController/Callbacks/ClassMethods.html" title="AbstractController::Callbacks::ClassMethods (module)">::AbstractController::Callbacks::ClassMethods</a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#_insert_callbacks-instance_method" title="AbstractController::Callbacks::ClassMethods#_insert_callbacks (method)">_insert_callbacks</a></td>
      <td><div class='inline'><p>Take callback names and an optional callback proc, normalize them, then
call the block with each callback.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#_normalize_callback_options-instance_method" title="AbstractController::Callbacks::ClassMethods#_normalize_callback_options (method)">_normalize_callback_options</a></td>
      <td><div class='inline'><p>If <code>:only</code> or <code>:except</code> are used, convert the options
into the <code>:if</code> and <code>:unless</code> options of
<a href="../ActiveSupport/Callbacks.html" title="ActiveSupport::Callbacks (module)">::ActiveSupport::Callbacks</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#after_action-instance_method" title="AbstractController::Callbacks::ClassMethods#after_action (method)">after_action</a></td>
      <td><div class='inline'><p>Append a callback after actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#append_after_action-instance_method" title="AbstractController::Callbacks::ClassMethods#append_after_action (method)">append_after_action</a></td>
      <td><div class='inline'><p>Append a callback after actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#append_around_action-instance_method" title="AbstractController::Callbacks::ClassMethods#append_around_action (method)">append_around_action</a></td>
      <td><div class='inline'><p>Append a callback around actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#append_before_action-instance_method" title="AbstractController::Callbacks::ClassMethods#append_before_action (method)">append_before_action</a></td>
      <td><div class='inline'><p>Append a callback before actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#around_action-instance_method" title="AbstractController::Callbacks::ClassMethods#around_action (method)">around_action</a></td>
      <td><div class='inline'><p>Append a callback around actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#before_action-instance_method" title="AbstractController::Callbacks::ClassMethods#before_action (method)">before_action</a></td>
      <td><div class='inline'><p>Append a callback before actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#prepend_after_action-instance_method" title="AbstractController::Callbacks::ClassMethods#prepend_after_action (method)">prepend_after_action</a></td>
      <td><div class='inline'><p>Prepend a callback after actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#prepend_around_action-instance_method" title="AbstractController::Callbacks::ClassMethods#prepend_around_action (method)">prepend_around_action</a></td>
      <td><div class='inline'><p>Prepend a callback around actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#prepend_before_action-instance_method" title="AbstractController::Callbacks::ClassMethods#prepend_before_action (method)">prepend_before_action</a></td>
      <td><div class='inline'><p>Prepend a callback before actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#skip_after_action-instance_method" title="AbstractController::Callbacks::ClassMethods#skip_after_action (method)">skip_after_action</a></td>
      <td><div class='inline'><p>Skip a callback after actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#skip_around_action-instance_method" title="AbstractController::Callbacks::ClassMethods#skip_around_action (method)">skip_around_action</a></td>
      <td><div class='inline'><p>Skip a callback around actions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks/ClassMethods.html#skip_before_action-instance_method" title="AbstractController::Callbacks::ClassMethods#skip_before_action (method)">skip_before_action</a></td>
      <td><div class='inline'><p>Skip a callback before actions.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../ActiveSupport/DescendantsTracker.html" title="ActiveSupport::DescendantsTracker (module)">::ActiveSupport::DescendantsTracker</a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../ActiveSupport/DescendantsTracker.html#descendants-instance_method" title="ActiveSupport::DescendantsTracker#descendants (method)">descendants</a>,
        <a class='i_m ' href="../ActiveSupport/DescendantsTracker.html#direct_descendants-instance_method" title="ActiveSupport::DescendantsTracker#direct_descendants (method)">direct_descendants</a>,
        <a class='i_m ' href="../ActiveSupport/DescendantsTracker.html#inherited-instance_method" title="ActiveSupport::DescendantsTracker#inherited (method)">inherited</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../ActiveSupport/Callbacks/ClassMethods.html" title="ActiveSupport::Callbacks::ClassMethods (module)">::ActiveSupport::Callbacks::ClassMethods</a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Callbacks/ClassMethods.html#define_callbacks-instance_method" title="ActiveSupport::Callbacks::ClassMethods#define_callbacks (method)">define_callbacks</a></td>
      <td><div class='inline'><p>Define sets of events in the object life cycle that support callbacks.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Callbacks/ClassMethods.html#reset_callbacks-instance_method" title="ActiveSupport::Callbacks::ClassMethods#reset_callbacks (method)">reset_callbacks</a></td>
      <td><div class='inline'><p>Remove all set callbacks for the given event.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Callbacks/ClassMethods.html#set_callback-instance_method" title="ActiveSupport::Callbacks::ClassMethods#set_callback (method)">set_callback</a></td>
      <td><div class='inline'><p>Install a callback for the given event.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Callbacks/ClassMethods.html#skip_callback-instance_method" title="ActiveSupport::Callbacks::ClassMethods#skip_callback (method)">skip_callback</a></td>
      <td><div class='inline'><p>Skip a previously set callback.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../AbstractController/Helpers/ClassMethods.html" title="AbstractController::Helpers::ClassMethods (module)">::AbstractController::Helpers::ClassMethods</a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Helpers/ClassMethods.html#clear_helpers-instance_method" title="AbstractController::Helpers::ClassMethods#clear_helpers (method)">clear_helpers</a></td>
      <td><div class='inline'><p>Clears up all existing helpers in this class, only keeping the helper with
the same name as this class.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Helpers/ClassMethods.html#helper-instance_method" title="AbstractController::Helpers::ClassMethods#helper (method)">helper</a></td>
      <td><div class='inline'><p>The <code>helper</code> class method can take a series of helper module
names, a block, or both.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Helpers/ClassMethods.html#helper_method-instance_method" title="AbstractController::Helpers::ClassMethods#helper_method (method)">helper_method</a></td>
      <td><div class='inline'><p>Declare a controller method as a helper.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Helpers/ClassMethods.html#inherited-instance_method" title="AbstractController::Helpers::ClassMethods#inherited (method)">inherited</a></td>
      <td><div class='inline'><p>When a class is inherited, wrap its helper module in a new module.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Helpers/ClassMethods.html#modules_for_helpers-instance_method" title="AbstractController::Helpers::ClassMethods#modules_for_helpers (method)">modules_for_helpers</a></td>
      <td><div class='inline'><p>Returns a list of modules, normalized from the acceptable kinds of helpers
with the following behavior:</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">::ActiveSupport::Concern</a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>,
        <a class='i_m ' href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a>,
        <a class='i_m ' href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>
        

<h2 class='h2_sum' id='instance_Attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#any_authenticity_token_valid%3F-instance_method" title="#any_authenticity_token_valid? (instance method)">#<strong>any_authenticity_token_valid?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if any of the authenticity tokens from the request are valid.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#marked_for_same_origin_verification%3F-instance_method" title="#marked_for_same_origin_verification? (instance method)">#<strong>marked_for_same_origin_verification?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>If the `verify_authenticity_token` before_action ran, verify that
JavaScript responses are only served to same-origin GET requests.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#non_xhr_javascript_response%3F-instance_method" title="#non_xhr_javascript_response? (instance method)">#<strong>non_xhr_javascript_response?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Check for cross-origin JavaScript responses.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#protect_against_forgery%3F-instance_method" title="#protect_against_forgery? (instance method)">#<strong>protect_against_forgery?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if the controller allows forgery protection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#valid_request_origin%3F-instance_method" title="#valid_request_origin? (instance method)">#<strong>valid_request_origin?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if the request originated from the same origin by looking at the
Origin header.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#verified_request%3F-instance_method" title="#verified_request? (instance method)">#<strong>verified_request?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true or false if a request is verified.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="../AbstractController/Callbacks.html" title="AbstractController::Callbacks (module)">::AbstractController::Callbacks</a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="../AbstractController/Callbacks.html#__callbacks-instance_method" title="AbstractController::Callbacks#__callbacks (method)">#__callbacks</a>,
        <a class='i_m ro' href="../AbstractController/Callbacks.html#__callbacks%3F-instance_method" title="AbstractController::Callbacks#__callbacks? (method)">#__callbacks?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>
        

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature priv'>
      <a href="#compare_with_real_token-instance_method" title="#compare_with_real_token (instance method)">#<strong>compare_with_real_token</strong>(token, session)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#form_authenticity_param-instance_method" title="#form_authenticity_param (instance method)">#<strong>form_authenticity_param</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>The form&#39;s authenticity parameter.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#handle_unverified_request-instance_method" title="#handle_unverified_request (instance method)">#<strong>handle_unverified_request</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#mark_for_same_origin_verification!-instance_method" title="#mark_for_same_origin_verification! (instance method)">#<strong>mark_for_same_origin_verification!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>GET requests are checked for cross-origin JavaScript after rendering.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#masked_authenticity_token-instance_method" title="#masked_authenticity_token (instance method)">#<strong>masked_authenticity_token</strong>(session, form_options: {})  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a masked version of the authenticity token that varies on each
request.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#normalize_action_path-instance_method" title="#normalize_action_path (instance method)">#<strong>normalize_action_path</strong>(action_path)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#per_form_csrf_token-instance_method" title="#per_form_csrf_token (instance method)">#<strong>per_form_csrf_token</strong>(session, action_path, method)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#real_csrf_token-instance_method" title="#real_csrf_token (instance method)">#<strong>real_csrf_token</strong>(session)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#request_authenticity_tokens-instance_method" title="#request_authenticity_tokens (instance method)">#<strong>request_authenticity_tokens</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Possible authenticity tokens sent in the request.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#unmask_token-instance_method" title="#unmask_token (instance method)">#<strong>unmask_token</strong>(masked_token)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#valid_authenticity_token%3F-instance_method" title="#valid_authenticity_token? (instance method)">#<strong>valid_authenticity_token?</strong>(session, encoded_masked_token)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks the client&#39;s masked token to see if it matches the session
token.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#valid_per_form_csrf_token%3F-instance_method" title="#valid_per_form_csrf_token? (instance method)">#<strong>valid_per_form_csrf_token?</strong>(token, session)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#verify_authenticity_token-instance_method" title="#verify_authenticity_token (instance method)">#<strong>verify_authenticity_token</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>The actual before_action that is used to verify the CSRF token.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#verify_same_origin_request-instance_method" title="#verify_same_origin_request (instance method)">#<strong>verify_same_origin_request</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>If `verify_authenticity_token` was run (indicating that we have forgery
protection enabled for this request) then also verify that we aren&#39;t
serving an unauthorized cross-origin response.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#xor_byte_strings-instance_method" title="#xor_byte_strings (instance method)">#<strong>xor_byte_strings</strong>(s1, s2)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="../AbstractController/Callbacks.html" title="AbstractController::Callbacks (module)">::AbstractController::Callbacks</a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../AbstractController/Callbacks.html#process_action-instance_method" title="AbstractController::Callbacks#process_action (method)">#process_action</a></td>
      <td><div class='inline'><p>Override AbstractController::Base&#39;s process_action to run the
process_action callbacks around the normal behavior.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../ActiveSupport/Callbacks.html" title="ActiveSupport::Callbacks (module)">::ActiveSupport::Callbacks</a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Callbacks.html#run_callbacks-instance_method" title="ActiveSupport::Callbacks#run_callbacks (method)">#run_callbacks</a></td>
      <td><div class='inline'><p>Runs the callbacks for the given event.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>
<h2 class='y_details'>DSL Calls</h2>
<section class='method_details first' id="included-dslcall">
<h3 class='signature'><strong>included</strong></h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L62-L90'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 62</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
  <span class='comment'># Sets the token parameter name for RequestForgery. Calling protect_from_forgery
</span>  <span class='comment'># sets it to &lt;tt&gt;:authenticity_token&lt;/tt&gt; by default.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_request_forgery_protection_token'>request_forgery_protection_token</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_request_forgery_protection_token'>request_forgery_protection_token</span> <span class='op'>||=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_authenticity_token'>authenticity_token</span>

  <span class='comment'># Holds the class which implements the request forgery protection.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_forgery_protection_strategy'>forgery_protection_strategy</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_forgery_protection_strategy'>forgery_protection_strategy</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='comment'># Controls whether request forgery protection is turned on or not. Turned off by default only in test mode.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_allow_forgery_protection'>allow_forgery_protection</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_allow_forgery_protection'>allow_forgery_protection</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_allow_forgery_protection'>allow_forgery_protection</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'># Controls whether a CSRF failure logs a warning. On by default.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'># Controls whether the Origin header is checked in addition to the CSRF token.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_forgery_protection_origin_check'>forgery_protection_origin_check</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_forgery_protection_origin_check'>forgery_protection_origin_check</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='comment'># Controls whether form-action/method specific CSRF tokens are used.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='id identifier rubyid_helper_method'>helper_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_form_authenticity_token'>form_authenticity_token</span>
  <span class='id identifier rubyid_helper_method'>helper_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_protect_against_forgery?'>protect_against_forgery?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="_helper_methods-class_method">
  <h3 class='signature rw first'>
    .<strong>_helper_methods</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/abstract_controller/helpers.rb#L11-L11'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


11</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 11</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helper_methods'>_helper_methods</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_helper_methods?-class_method">
  <h3 class='signature rw'>
    .<strong>_helper_methods?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/abstract_controller/helpers.rb#L11-L11'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


11</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 11</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helper_methods'>_helper_methods</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_helpers-class_method">
  <h3 class='signature rw'>
    .<strong>_helpers</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/abstract_controller/helpers.rb#L8-L8'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


8</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 8</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helpers'>_helpers</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_helpers?-class_method">
  <h3 class='signature rw'>
    .<strong>_helpers?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/abstract_controller/helpers.rb#L8-L8'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


8</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 8</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helpers'>_helpers</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="_helper_methods-instance_method">
  <h3 class='signature rw first'>
    #<strong>_helper_methods</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/abstract_controller/helpers.rb#L11-L11'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


11</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 11</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helper_methods'>_helper_methods</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_helper_methods?-instance_method">
  <h3 class='signature rw'>
    #<strong>_helper_methods?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/abstract_controller/helpers.rb#L11-L11'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


11</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 11</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helper_methods'>_helper_methods</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_helpers-instance_method">
  <h3 class='signature rw'>
    #<strong>_helpers</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/abstract_controller/helpers.rb#L8-L8'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


8</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 8</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helpers'>_helpers</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_helpers?-instance_method">
  <h3 class='signature rw'>
    #<strong>_helpers?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/abstract_controller/helpers.rb#L8-L8'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


8</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 8</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helpers'>_helpers</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="any_authenticity_token_valid?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>any_authenticity_token_valid?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if any of the authenticity tokens from the request are valid.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L274-L278'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


274
275
276
277
278</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 274</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_any_authenticity_token_valid?'>any_authenticity_token_valid?</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_request_authenticity_tokens'>request_authenticity_tokens</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_token'>token</span><span class='op'>|</span>
    <span class='id identifier rubyid_valid_authenticity_token?'>valid_authenticity_token?</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="marked_for_same_origin_verification?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>marked_for_same_origin_verification?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If the `verify_authenticity_token` before_action ran, verify that
JavaScript responses are only served to same-origin GET requests.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L252-L254'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


252
253
254</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 252</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_marked_for_same_origin_verification?'>marked_for_same_origin_verification?</span> <span class='comment'># :doc:
</span>  <span class='ivar'>@marked_for_same_origin_verification</span> <span class='op'>||=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="non_xhr_javascript_response?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>non_xhr_javascript_response?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Check for cross-origin JavaScript responses.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L257-L259'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


257
258
259</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 257</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_non_xhr_javascript_response?'>non_xhr_javascript_response?</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_content_type'>content_type</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>%r(</span><span class='tstring_content'>\Atext/javascript</span><span class='regexp_end'>)</span></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_xhr?'>xhr?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="protect_against_forgery?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>protect_against_forgery?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if the controller allows forgery protection.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L394-L396'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


394
395
396</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 394</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_protect_against_forgery?'>protect_against_forgery?</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_allow_forgery_protection'>allow_forgery_protection</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_request_origin?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>valid_request_origin?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if the request originated from the same origin by looking at the
Origin header.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L400-L407'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


400
401
402
403
404
405
406
407</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 400</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_request_origin?'>valid_request_origin?</span> <span class='comment'># :doc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_forgery_protection_origin_check'>forgery_protection_origin_check</span>
    <span class='comment'># We accept blank origin headers because some user agents don&#39;t send it.
</span>    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_origin'>origin</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_origin'>origin</span> <span class='op'>==</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_base_url'>base_url</span>
  <span class='kw'>else</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verified_request?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>verified_request?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true or false if a request is verified. Checks:</p>
<ul><li>
<p>Is it a GET or HEAD request? GETs should be safe and idempotent</p>
</li><li>
<p>Does the form_authenticity_token match the given token value from the
params?</p>
</li><li>
<p>Does the X-CSRF-Token header match the form_authenticity_token?</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L268-L271'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


268
269
270
271</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 268</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verified_request?'>verified_request?</span> <span class='comment'># :doc:
</span>  <span class='op'>!</span><span class='id identifier rubyid_protect_against_forgery?'>protect_against_forgery?</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_get?'>get?</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_head?'>head?</span> <span class='op'>||</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_valid_request_origin?'>valid_request_origin?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_any_authenticity_token_valid?'>any_authenticity_token_valid?</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="compare_with_real_token-instance_method">
  <h3 class='signature priv first'>
    #<strong>compare_with_real_token</strong>(token, session)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L351-L353'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


351
352
353</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 351</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compare_with_real_token'>compare_with_real_token</span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span> <span class='comment'># :doc:
</span>  <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/SecurityUtils.html" title="ActiveSupport::SecurityUtils (module)">SecurityUtils</a></span><span class='period'>.</span><span class='id identifier rubyid_secure_compare'><a href="../ActiveSupport/SecurityUtils.html#secure_compare-class_method" title="ActiveSupport::SecurityUtils.secure_compare (method)">secure_compare</a></span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_real_csrf_token'>real_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="form_authenticity_param-instance_method">
  <h3 class='signature priv'>
    #<strong>form_authenticity_param</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The form&#39;s authenticity parameter. Override to provide your own.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L389-L391'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


389
390
391</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 389</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_form_authenticity_param'>form_authenticity_param</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='id identifier rubyid_request_forgery_protection_token'>request_forgery_protection_token</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_unverified_request-instance_method">
  <h3 class='signature priv'>
    #<strong>handle_unverified_request</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L222-L224'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


222
223
224</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 222</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_unverified_request'>handle_unverified_request</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_forgery_protection_strategy'>forgery_protection_strategy</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_handle_unverified_request'>handle_unverified_request</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="mark_for_same_origin_verification!-instance_method">
  <h3 class='signature priv'>
    #<strong>mark_for_same_origin_verification!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>GET requests are checked for cross-origin JavaScript after rendering.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L246-L248'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


246
247
248</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 246</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_mark_for_same_origin_verification!'>mark_for_same_origin_verification!</span> <span class='comment'># :doc:
</span>  <span class='ivar'>@marked_for_same_origin_verification</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_get?'>get?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="masked_authenticity_token-instance_method">
  <h3 class='signature priv'>
    #<strong>masked_authenticity_token</strong>(session, form_options: {})   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a masked version of the authenticity token that varies on each
request. The masking is used to mitigate SSL attacks like BREACH.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L293-L307'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


293
294
295
296
297
298
299
300
301
302
303
304
305
306
307</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 293</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_masked_authenticity_token'>masked_authenticity_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='label'>form_options:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='id identifier rubyid_form_options'>form_options</span><span class='period'>.</span><span class='id identifier rubyid_values_at'>values_at</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raw_token'>raw_token</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_method'>method</span>
    <span class='id identifier rubyid_action_path'>action_path</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_action_path'>normalize_action_path</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_per_form_csrf_token'>per_form_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_action_path'>action_path</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_real_csrf_token'>real_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_one_time_pad'>one_time_pad</span> <span class='op'>=</span> <span class='const'><a href="../SecureRandom.html" title="SecureRandom (module)">SecureRandom</a></span><span class='period'>.</span><span class='id identifier rubyid_random_bytes'>random_bytes</span><span class='lparen'>(</span><span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_xor_byte_strings'>xor_byte_strings</span><span class='lparen'>(</span><span class='id identifier rubyid_one_time_pad'>one_time_pad</span><span class='comma'>,</span> <span class='id identifier rubyid_raw_token'>raw_token</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_masked_token'>masked_token</span> <span class='op'>=</span> <span class='id identifier rubyid_one_time_pad'>one_time_pad</span> <span class='op'>+</span> <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span>
  <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_strict_encode64'>strict_encode64</span><span class='lparen'>(</span><span class='id identifier rubyid_masked_token'>masked_token</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="normalize_action_path-instance_method">
  <h3 class='signature priv'>
    #<strong>normalize_action_path</strong>(action_path)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L409-L412'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


409
410
411
412</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 409</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_normalize_action_path'>normalize_action_path</span><span class='lparen'>(</span><span class='id identifier rubyid_action_path'>action_path</span><span class='rparen'>)</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'><a href="../URI.html" title="URI (module)">URI</a></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_action_path'>action_path</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="per_form_csrf_token-instance_method">
  <h3 class='signature priv'>
    #<strong>per_form_csrf_token</strong>(session, action_path, method)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L374-L380'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


374
375
376
377
378
379
380</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 374</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_per_form_csrf_token'>per_form_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_action_path'>action_path</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span> <span class='comment'># :doc:
</span>  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>HMAC</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span><span class='lparen'>(</span>
    <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA256</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span>
    <span class='id identifier rubyid_real_csrf_token'>real_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_action_path'>action_path</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="real_csrf_token-instance_method">
  <h3 class='signature priv'>
    #<strong>real_csrf_token</strong>(session)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L369-L372'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


369
370
371
372</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 369</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_real_csrf_token'>real_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid__csrf_token'>_csrf_token</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><a href="../SecureRandom.html" title="SecureRandom (module)">SecureRandom</a></span><span class='period'>.</span><span class='id identifier rubyid_base64'>base64</span><span class='lparen'>(</span><span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span><span class='rparen'>)</span>
  <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_strict_decode64'>strict_decode64</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid__csrf_token'>_csrf_token</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="request_authenticity_tokens-instance_method">
  <h3 class='signature priv'>
    #<strong>request_authenticity_tokens</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Possible authenticity tokens sent in the request.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L281-L283'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


281
282
283</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 281</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_request_authenticity_tokens'>request_authenticity_tokens</span> <span class='comment'># :doc:
</span>  <span class='lbracket'>[</span><span class='id identifier rubyid_form_authenticity_param'>form_authenticity_param</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_x_csrf_token'>x_csrf_token</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unmask_token-instance_method">
  <h3 class='signature priv'>
    #<strong>unmask_token</strong>(masked_token)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L343-L349'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


343
344
345
346
347
348
349</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 343</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unmask_token'>unmask_token</span><span class='lparen'>(</span><span class='id identifier rubyid_masked_token'>masked_token</span><span class='rparen'>)</span> <span class='comment'># :doc:
</span>  <span class='comment'># Split the token into the one-time pad and the encrypted
</span>  <span class='comment'># value and decrypt it.
</span>  <span class='id identifier rubyid_one_time_pad'>one_time_pad</span> <span class='op'>=</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>...</span><span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='lbracket'>[</span><span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_xor_byte_strings'>xor_byte_strings</span><span class='lparen'>(</span><span class='id identifier rubyid_one_time_pad'>one_time_pad</span><span class='comma'>,</span> <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_authenticity_token?-instance_method">
  <h3 class='signature priv'>
    #<strong>valid_authenticity_token?</strong>(session, encoded_masked_token)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks the client&#39;s masked token to see if it matches the session
token. Essentially the inverse of <a href="#masked_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#masked_authenticity_token (method)">#masked_authenticity_token</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L312-L341'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 312</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_authenticity_token?'>valid_authenticity_token?</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='rparen'>)</span> <span class='comment'># :doc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><a href="../String.html" title="String (class)">String</a></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_masked_token'>masked_token</span> <span class='op'>=</span> <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_strict_decode64'>strict_decode64</span><span class='lparen'>(</span><span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='comment'># encoded_masked_token is invalid Base64
</span>    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># See if it&#39;s actually a masked token or not. In order to
</span>  <span class='comment'># deploy this code, we should be able to handle any unmasked
</span>  <span class='comment'># tokens that we&#39;ve issued without error.
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span>
    <span class='comment'># This is actually an unmasked token. This is expected if
</span>    <span class='comment'># you have just upgraded to masked tokens, but should stop
</span>    <span class='comment'># happening shortly after installing this gem.
</span>    <span class='id identifier rubyid_compare_with_real_token'>compare_with_real_token</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span>

  <span class='kw'>elsif</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span> <span class='op'>*</span> <span class='int'>2</span>
    <span class='id identifier rubyid_csrf_token'>csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_unmask_token'>unmask_token</span><span class='lparen'>(</span><span class='id identifier rubyid_masked_token'>masked_token</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_compare_with_real_token'>compare_with_real_token</span><span class='lparen'>(</span><span class='id identifier rubyid_csrf_token'>csrf_token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span> <span class='op'>||</span>
      <span class='id identifier rubyid_valid_per_form_csrf_token?'>valid_per_form_csrf_token?</span><span class='lparen'>(</span><span class='id identifier rubyid_csrf_token'>csrf_token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>false</span> <span class='comment'># Token is malformed.
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_per_form_csrf_token?-instance_method">
  <h3 class='signature priv'>
    #<strong>valid_per_form_csrf_token?</strong>(token, session)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L355-L367'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


355
356
357
358
359
360
361
362
363
364
365
366
367</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 355</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_per_form_csrf_token?'>valid_per_form_csrf_token?</span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span> <span class='comment'># :doc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span>
    <span class='id identifier rubyid_correct_token'>correct_token</span> <span class='op'>=</span> <span class='id identifier rubyid_per_form_csrf_token'>per_form_csrf_token</span><span class='lparen'>(</span>
      <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
      <span class='id identifier rubyid_normalize_action_path'>normalize_action_path</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_fullpath'>fullpath</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_request_method'>request_method</span>
    <span class='rparen'>)</span>

    <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/SecurityUtils.html" title="ActiveSupport::SecurityUtils (module)">SecurityUtils</a></span><span class='period'>.</span><span class='id identifier rubyid_secure_compare'><a href="../ActiveSupport/SecurityUtils.html#secure_compare-class_method" title="ActiveSupport::SecurityUtils.secure_compare (method)">secure_compare</a></span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_correct_token'>correct_token</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_authenticity_token-instance_method">
  <h3 class='signature priv'>
    #<strong>verify_authenticity_token</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The actual before_action that is used to verify the CSRF token. Don&#39;t
override this directly. Provide your own forgery protection strategy
instead. If you override, you&#39;ll disable same-origin `&lt;script&gt;`
verification.</p>

<p>Lean on the protect_from_forgery declaration to mark which actions are due
for same-origin request verification. If protect_from_forgery is enabled on
an action, this before_action flags its after_action to verify that
JavaScript responses are for XHR requests, ensuring they follow the
browser&#39;s same-origin policy.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L211-L220'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


211
212
213
214
215
216
217
218
219
220</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 211</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_authenticity_token'>verify_authenticity_token</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_mark_for_same_origin_verification!'>mark_for_same_origin_verification!</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_verified_request?'>verified_request?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t verify CSRF token authenticity.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_handle_unverified_request'>handle_unverified_request</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_same_origin_request-instance_method">
  <h3 class='signature priv'>
    #<strong>verify_same_origin_request</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If `verify_authenticity_token` was run (indicating that we have forgery
protection enabled for this request) then also verify that we aren&#39;t
serving an unauthorized cross-origin response.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L236-L243'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


236
237
238
239
240
241
242
243</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 236</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_same_origin_request'>verify_same_origin_request</span> <span class='comment'># :doc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_marked_for_same_origin_verification?'>marked_for_same_origin_verification?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_non_xhr_javascript_response?'>non_xhr_javascript_response?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='const'>CROSS_ORIGIN_JAVASCRIPT_WARNING</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="InvalidCrossOriginRequest.html" title="ActionController::InvalidCrossOriginRequest (class)">InvalidCrossOriginRequest</a></span><span class='comma'>,</span> <span class='const'>CROSS_ORIGIN_JAVASCRIPT_WARNING</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="xor_byte_strings-instance_method">
  <h3 class='signature priv'>
    #<strong>xor_byte_strings</strong>(s1, s2)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/5-1-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L382-L386'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


382
383
384
385
386</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 382</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_xor_byte_strings'>xor_byte_strings</span><span class='lparen'>(</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span><span class='rparen'>)</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_s2_bytes'>s2_bytes</span> <span class='op'>=</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_bytes'>bytes</span>
  <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_each_byte'>each_byte</span><span class='period'>.</span><span class='id identifier rubyid_with_index'>with_index</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c1'>c1</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_s2_bytes'>s2_bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>^=</span> <span class='id identifier rubyid_c1'>c1</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_s2_bytes'>s2_bytes</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.8 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.5.0p-1)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>