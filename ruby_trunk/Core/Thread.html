<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Thread &mdash; Core Ruby-2.5.0 dev</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Thread",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
        <a href='../../index.html'>Home</a> &raquo; 
        <a href='../index.html'>Ruby-2.5.0</a> &raquo; 
        <a href='index.html'>Core</a> &raquo; 
        <a href='_index.html#alpha_T'>Index (T)</a> &raquo; 
        <span class='title'><a id='t2_doc_top' href='#'>Thread&nbsp;&#x25B2;</a></span>
      </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Thread</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Thread/Backtrace.html" title="Thread::Backtrace (class)">Backtrace</a>,
        <a href="Thread/Mutex.html" title="Thread::Mutex (class)">Mutex</a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a href="Process/Waiter.html" title="Process::Waiter (class)">Process::Waiter</a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/trunk/vm.c#L2917'>vm.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/trunk/prelude.rb#L1'>prelude.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L765'>thread.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/trunk/vm_trace.c#L547'>vm_trace.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Threads are the Ruby implementation for a concurrent programming model.</p>

<p>Programs that require multiple threads of execution are a perfect candidate
for Ruby&#39;s <code>Thread</code> class.</p>

<p>For example, we can create a new thread separate from the main thread&#39;s
execution using <a href="#new-class_method" title="Thread.new (method)">.new</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Whats the big deal</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span></code></pre>

<p>Then we are able to pause the execution of the main thread and allow our
new thread to finish, using <a href="#join-instance_method" title="Thread#join (method)">#join</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='comment'>#=&gt; &quot;Whats the big deal&quot;</span></code></pre>

<p>If we don&#39;t call <code>thr.join</code> before the main thread
terminates, then all other threads including <code>thr</code> will be killed.</p>

<p>Alternatively, you can use an array for handling multiple threads at once,
like in the following example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_threads'>threads</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_threads'>threads</span> <span class='op'>&lt;&lt;</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Whats the big deal</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_threads'>threads</span> <span class='op'>&lt;&lt;</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='int'>3</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Threads are fun!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='rbrace'>}</span></code></pre>

<p>After creating a few threads we wait for them all to finish consecutively.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_threads'>threads</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_thr'>thr</span><span class='op'>|</span> <span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='rbrace'>}</span></code></pre>

<h3 id="label-Thread+initialization"><code>Thread</code> initialization</h3>

<p>In order to create new threads, Ruby provides <a href="#new-class_method" title="Thread.new (method)">.new</a>, <a href="#start-class_method" title="Thread.start (method)">.start</a>, and
<a href="#fork-class_method" title="Thread.fork (method)">.fork</a>. A block must be provided with each of these methods, otherwise a
<a href="ThreadError.html" title="ThreadError (class)">::ThreadError</a> will be raised.</p>

<p>When subclassing the <code>Thread</code> class, the <a href="#initialize-instance_method" title="Thread#initialize (method)">#initialize</a> method of
your subclass will be ignored by <a href="#start-class_method" title="Thread.start (method)">.start</a> and <a href="#fork-class_method" title="Thread.fork (method)">.fork</a>. Otherwise, be sure
to call super in your <a href="#initialize-instance_method" title="Thread#initialize (method)">#initialize</a> method.</p>

<h3 id="label-Thread+termination"><code>Thread</code> termination</h3>

<p>For terminating threads, Ruby provides a variety of ways to do this.</p>

<p>The class method <a href="#kill-class_method" title="Thread.kill (method)">.kill</a>, is meant to exit a given thread:</p>

<pre class="code ruby"><code class="ruby">thr = Thread.new { ... }
Thread.kill(thr) # sends exit() to thr</code></pre>

<p>Alternatively, you can use the instance method <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>, or any of its
aliases <a href="#kill-instance_method" title="Thread#kill (method)">#kill</a> or <a href="#terminate-instance_method" title="Thread#terminate (method)">#terminate</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_exit'>exit</span></code></pre>

<h3 id="label-Thread+status"><code>Thread</code> status</h3>

<p>Ruby provides a few instance methods for querying the state of a given
thread. To get a string with the current thread&#39;s state use <a href="#status-instance_method" title="Thread#status (method)">#status</a></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_sleep'>sleep</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span> <span class='comment'># =&gt; &quot;sleep&quot;
</span><span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_exit'>exit</span>
<span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span> <span class='comment'># =&gt; false</span></code></pre>

<p>You can also use <a href="#alive%3F-instance_method" title="Thread#alive? (method)">#alive?</a> to tell if the thread is running or sleeping,
and <a href="#stop%3F-instance_method" title="Thread#stop? (method)">#stop?</a> if the thread is dead or sleeping.</p>

<h3 id="label-Thread+variables+and+scope"><code>Thread</code> variables and scope</h3>

<p>Since threads are created with blocks, the same rules apply to other Ruby
blocks for variable scope. Any local variables created within this block
are accessible to only this thread.</p>

<h4 id="label-Fiber-local+vs.+Thread-local">Fiber-local vs. Thread-local</h4>

<p>Each fiber has its own bucket for <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> storage. When you set a new
fiber-local it is only accessible within this <a href="Fiber.html" title="Fiber (class)">::Fiber</a>. To illustrate:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Fiber.html#new-class_method" title="Fiber.new (method)">new</a></span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='rbracket'>]</span> <span class='comment'># =&gt; nil
</span>  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_resume'>resume</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span></code></pre>

<p>This example uses <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> for getting and <a href="#[]=-instance_method" title="Thread#[]= (method)">#[]=</a> for setting fiber-locals,
you can also use <a href="#keys-instance_method" title="Thread#keys (method)">#keys</a> to list the fiber-locals for a given thread and
<a href="#key%3F-instance_method" title="Thread#key? (method)">#key?</a> to check if a fiber-local exists.</p>

<p>When it comes to thread-locals, they are accessible within the entire scope
of the thread. Given the following example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span><span class='lbrace'>{</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_get'><a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">thread_variable_get</a></span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='rparen'>)</span> <span class='comment'># =&gt; 1
</span>  <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Fiber.html#new-class_method" title="Fiber.new (method)">new</a></span><span class='lbrace'>{</span>
    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_get'><a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">thread_variable_get</a></span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='rparen'>)</span> <span class='comment'># =&gt; 2
</span>  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_resume'>resume</span>
  <span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_get'><a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">thread_variable_get</a></span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='rparen'>)</span>   <span class='comment'># =&gt; 2
</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span></code></pre>

<p>You can see that the thread-local <code>:foo</code> carried over into the
fiber and was changed to <code>2</code> by the end of the thread.</p>

<p>This example makes use of <a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">#thread_variable_set</a> to create new
thread-locals, and <a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> to reference them.</p>

<p>There is also <a href="#thread_variables-instance_method" title="Thread#thread_variables (method)">#thread_variables</a> to list all thread-locals, and
<a href="#thread_variable%3F-instance_method" title="Thread#thread_variable? (method)">#thread_variable?</a> to check if a given thread-local exists.</p>

<h3 id="label-7BException-7D+handling"><a href="Exception.html" title="Exception (class)">::Exception</a> handling</h3>

<p>Any thread can raise an exception using the <a href="#raise-instance_method" title="Thread#raise (method)">#raise</a> instance method, which
operates similarly to <a href="Kernel.html#raise-class_method" title="Kernel.raise (method)">Kernel.raise</a>.</p>

<p>However, it&#39;s important to note that an exception that occurs in any
thread except the main thread depends on <a href="#abort_on_exception-instance_method" title="Thread#abort_on_exception (method)">#abort_on_exception</a>. This option
is <code>false</code> by default, meaning that any unhandled exception will cause the
thread to terminate silently when waited on by either <a href="#join-instance_method" title="Thread#join (method)">#join</a> or <a href="#value-instance_method" title="Thread#value (method)">#value</a>.
You can change this default by either <a href="#abort_on_exception=-instance_method" title="Thread#abort_on_exception= (method)">#abort_on_exception=</a> <code>true</code> or
setting $DEBUG to <code>true</code>.</p>

<p>With the addition of the class method <a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">.handle_interrupt</a>, you can now
handle exceptions asynchronously with threads.</p>

<h3 id="label-Scheduling">Scheduling</h3>

<p>Ruby provides a few ways to support scheduling threads in your program.</p>

<p>The first way is by using the class method <a href="#stop-class_method" title="Thread.stop (method)">.stop</a>, to put the current
running thread to sleep and schedule the execution of another thread.</p>

<p>Once a thread is asleep, you can use the instance method <a href="#wakeup-instance_method" title="Thread#wakeup (method)">#wakeup</a> to mark
your thread as eligible for scheduling.</p>

<p>You can also try <a href="#pass-class_method" title="Thread.pass (method)">.pass</a>, which attempts to pass execution to another
thread but is dependent on the OS whether a running thread will switch or
not. The same goes for <a href="#priority-instance_method" title="Thread#priority (method)">#priority</a>, which lets you hint to the thread
scheduler which threads you want to take precedence when passing execution.
This method is also dependent on the OS and may be ignored on some
platforms.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='MUTEX_FOR_THREAD_EXCLUSIVE-constant' class='summary_signature priv nodoc'>MUTEX_FOR_THREAD_EXCLUSIVE =</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/trunk/prelude.rb#L2-L2'># File 'prelude.rb', line 2</a>    <pre class='code ruby'><span class='const'>Thread</span><span class='op'>::</span><span class='const'><a href="Thread/Mutex.html" title="Thread::Mutex (class)">Mutex</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Thread/Mutex.html#new-class_method" title="Thread::Mutex.new (method)">new</a></span></pre>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='class_Attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#abort_on_exception-class_method" title="abort_on_exception (class method)">.<strong>abort_on_exception</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of the global "abort on exception&#39;&#39; condition.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#abort_on_exception=-class_method" title="abort_on_exception= (class method)">.<strong>abort_on_exception=</strong>(boolean)  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>When set to <code>true</code>, if any thread is aborted by an exception, the raised
exception will be re-raised in the main thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#DEBUG-class_method" title="DEBUG (class method)"><strong>DEBUG</strong>  &#x21d2; Numeric </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the thread debug level.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#DEBUG=-class_method" title="DEBUG= (class method)"><strong>DEBUG=</strong>(num)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the thread debug level.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#report_on_exception-class_method" title="report_on_exception (class method)">.<strong>report_on_exception</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of the global "report on exception&#39;&#39; condition.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#report_on_exception=-class_method" title="report_on_exception= (class method)">.<strong>report_on_exception=</strong>(boolean)  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>When set to <code>true</code>, all threads will report the exception if an exception
is raised.</p></div>
    </div>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#current-class_method" title="current (class method)">.<strong>current</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the currently executing thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exclusive-class_method" title="exclusive (class method)">.<strong>exclusive</strong>  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Wraps the block in a single, VM-global <a href="Thread/Mutex.html#synchronize-instance_method" title="Thread::Mutex#synchronize (method)">Mutex#synchronize</a>, returning the
value of the block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exit-class_method" title="exit (class method)">.<strong>exit</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Terminates the currently running thread and schedules another thread to be
run.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fork-class_method" title="fork (class method)">.<strong>fork</strong>([args]) {|args| ... } &#x21d2; Thread </a>
      (also: .start)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically the same as <a href="#new-class_method" title="Thread.new (method)">.new</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#handle_interrupt-class_method" title="handle_interrupt (class method)">.<strong>handle_interrupt</strong>(hash)  &#x21d2; result of the block </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Changes asynchronous interrupt timing.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#kill-class_method" title="kill (class method)">.<strong>kill</strong>(thread)  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Causes the given <code>thread</code> to exit, see also <a href="#exit-class_method" title="Thread.exit (method)">.exit</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#list-class_method" title="list (class method)">.<strong>list</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an array of <code>Thread</code> objects for all threads that are
either runnable or stopped.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#main-class_method" title="main (class method)">.<strong>main</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the main thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>  &#x21d2; Thread </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new thread executing the given block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#pass-class_method" title="pass (class method)">.<strong>pass</strong>  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Give the thread scheduler a hint to pass execution to another thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#pending_interrupt%3F-class_method" title="pending_interrupt? (class method)">.<strong>pending_interrupt?</strong>(error = nil)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether or not the asynchronous queue is empty.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#start-class_method" title="start (class method)">.<strong>start</strong>([args]) {|args| ... } &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#fork-class_method" title="Thread.fork (method)">.fork</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stop-class_method" title="stop (class method)">.<strong>stop</strong>  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Stops execution of the current thread, putting it into a "sleep&#39;&#39;
state, and schedules execution of another thread.</p></div>
    </div>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#abort_on_exception-instance_method" title="#abort_on_exception (instance method)">#<strong>abort_on_exception</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of the thread-local "abort on exception&#39;&#39;
condition for this <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#abort_on_exception=-instance_method" title="#abort_on_exception= (instance method)">#<strong>abort_on_exception=</strong>(boolean)  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>When set to <code>true</code>, if this <code>thr</code> is aborted by an exception, the raised
exception will be re-raised in the main thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  &#x21d2; String </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>show the name of the thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#name=-instance_method" title="#name= (instance method)">#<strong>name=</strong>(name)  &#x21d2; String </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>set given name to the ruby thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#priority-instance_method" title="#priority (instance method)">#<strong>priority</strong>  &#x21d2; Integer </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the priority of <em>thr</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#priority=-instance_method" title="#priority= (instance method)">#<strong>priority=</strong>(integer)  &#x21d2; Thread </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the priority of <em>thr</em> to <em>integer</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#report_on_exception-instance_method" title="#report_on_exception (instance method)">#<strong>report_on_exception</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of the thread-local "report on exception&#39;&#39;
condition for this <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#report_on_exception=-instance_method" title="#report_on_exception= (instance method)">#<strong>report_on_exception=</strong>(boolean)  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>When set to <code>true</code>, all threads (including the main program) will report
the exception if an exception is raised in this <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#alive%3F-instance_method" title="#alive? (instance method)">#<strong>alive?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if <code>thr</code> is running or sleeping.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#stop%3F-instance_method" title="#stop? (instance method)">#<strong>stop?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if <code>thr</code> is dead or sleeping.</p></div>
    </div>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(sym)  &#x21d2; Object<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Attribute Reference---Returns the value of a fiber-local variable (current
thread&#39;s root fiber if not explicitly inside a <a href="Fiber.html" title="Fiber (class)">::Fiber</a>), using either a
symbol or a string name.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]=-instance_method" title="#[]= (instance method)">#<strong>[]=</strong>(sym, obj)  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Attribute Assignment---Sets or creates the value of a fiber-local variable,
using either a symbol or a string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#add_trace_func-instance_method" title="#add_trace_func (instance method)">#<strong>add_trace_func</strong>(proc)  &#x21d2; Proc </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Adds <em>proc</em> as a handler for tracing.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#backtrace-instance_method" title="#backtrace (instance method)">#<strong>backtrace</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the current backtrace of the target thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#backtrace_locations-instance_method" title="#backtrace_locations (instance method)">#<strong>backtrace_locations</strong>(*args)  &#x21d2; Array<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the execution stack for the target thread---an array containing
backtrace location objects.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exit-instance_method" title="#exit (instance method)">#<strong>exit</strong>  &#x21d2; Thread<sup>?</sup> </a>
      (also: #kill, #terminate)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Terminates <code>thr</code> and schedules another thread to be run.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fetch-instance_method" title="#fetch (instance method)">#<strong>fetch</strong>(*args)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#group-instance_method" title="#group (instance method)">#<strong>group</strong>  &#x21d2; thgrp<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the <a href="ThreadGroup.html" title="ThreadGroup (class)">::ThreadGroup</a> which contains the given thread, or returns <code>nil</code>
if <code>thr</code> is not a member of any group.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Dump the name, id, and status of <em>thr</em> to a string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#join-instance_method" title="#join (instance method)">#<strong>join</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The calling thread will suspend execution and run this <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#key%3F-instance_method" title="#key? (instance method)">#<strong>key?</strong>(sym)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if the given string (or symbol) exists as a fiber-local
variable.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#keys-instance_method" title="#keys (instance method)">#<strong>keys</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an array of the names of the fiber-local variables (as Symbols).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#kill-instance_method" title="#kill (instance method)">#<strong>kill</strong>  &#x21d2; Thread<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#pending_interrupt%3F-instance_method" title="#pending_interrupt? (instance method)">#<strong>pending_interrupt?</strong>(error = nil)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether or not the asynchronous queue is empty for the target
thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#raise-instance_method" title="#raise (instance method)">#<strong>raise</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Raises an exception from the given thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#run-instance_method" title="#run (instance method)">#<strong>run</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Wakes up <code>thr</code>, making it eligible for scheduling.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#safe_level-instance_method" title="#safe_level (instance method)">#<strong>safe_level</strong>  &#x21d2; Integer </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the safe level in effect for <em>thr</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#set_trace_func-instance_method" title="#set_trace_func (instance method)">#<strong>set_trace_func</strong>(proc)  &#x21d2; Proc </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Establishes <em>proc</em> on <em>thr</em> as the handler for tracing, or
disables tracing if the parameter is <code>nil</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#status-instance_method" title="#status (instance method)">#<strong>status</strong>  &#x21d2; String, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#terminate-instance_method" title="#terminate (instance method)">#<strong>terminate</strong>  &#x21d2; Thread<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#thread_variable%3F-instance_method" title="#thread_variable? (instance method)">#<strong>thread_variable?</strong>(key)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if the given string (or symbol) exists as a thread-local
variable.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#thread_variable_get-instance_method" title="#thread_variable_get (instance method)">#<strong>thread_variable_get</strong>(key)  &#x21d2; Object<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the value of a thread local variable that has been set.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#thread_variable_set-instance_method" title="#thread_variable_set (instance method)">#<strong>thread_variable_set</strong>(key, value)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets a thread local with <code>key</code> to <a href="#value-instance_method" title="Thread#value (method)">#value</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#thread_variables-instance_method" title="#thread_variables (instance method)">#<strong>thread_variables</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an array of the names of the thread-local variables (as Symbols).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#value-instance_method" title="#value (instance method)">#<strong>value</strong>  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Waits for <code>thr</code> to complete, using <a href="#join-instance_method" title="Thread#join (method)">#join</a>, and returns its value or raises
the exception which terminated the thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#wakeup-instance_method" title="#wakeup (instance method)">#<strong>wakeup</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Marks a given thread as eligible for scheduling, however it may still
remain blocked on I/O.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(args)  </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    <div class='inline-block'>
      <span class='overload'>.<strong>new</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>.<strong>new</strong>(*args, &amp;proc)  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>.<strong>new</strong>(*args) {|args| ... } &#x21d2; <code>Thread</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a new thread executing the given block.</p>

<p>Any <code>args</code> given to <code>.new</code> will be passed to the block:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span>
<span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span><span class='id identifier rubyid_b'>b</span><span class='comma'>,</span><span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='comma'>,</span><span class='id identifier rubyid_e'>e</span><span class='comma'>,</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_arr'>arr</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_f'>f</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
<span class='id identifier rubyid_arr'>arr</span> <span class='comment'>#=&gt; [1, 2, 3]</span></code></pre>

<p>A ThreadError exception is raised if <code>.new</code> is called without a block.</p>

<p>If you&#39;re going to subclass <code>Thread</code>, be sure to call super
in your <a href="#initialize-instance_method" title="Thread#initialize (method)">#initialize</a> method, otherwise a <a href="ThreadError.html" title="ThreadError (class)">::ThreadError</a> will be raised.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L765-L781'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 765</span></pre>
<pre class='code cpp'>

static VALUE
thread_s_new(int argc, VALUE *argv, VALUE klass)
{
    rb_thread_t *th;
    VALUE thread = rb_thread_alloc(klass);

    if (GET_VM()-&gt;main_thread-&gt;status == THREAD_KILLED)
	rb_raise(rb_eThreadError, &quot;can&#39;t alloc thread&quot;);

    rb_obj_call_init(thread, argc, argv);
    GetThreadPtr(thread, th);
    if (!threadptr_initialized(th)) {
	rb_raise(rb_eThreadError, &quot;uninitialized thread - check `%&quot;PRIsVALUE&quot;#initialize&#39;&quot;,
		 klass);
    }
    return thread;
}
</pre>
  </div>
</div>
</section>

  <section class='method_details' id="initialize-instance_method">
  <h3 class='signature nodoc'>
    #<strong>initialize</strong>(args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L800-L818'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 800</span></pre>
<pre class='code cpp'>

static VALUE
thread_initialize(VALUE thread, VALUE args)
{
    rb_thread_t *th;
    if (!rb_block_given_p()) {
	rb_raise(rb_eThreadError, &quot;must be called with a block&quot;);
    }
    GetThreadPtr(thread, th);
    if (th-&gt;first_args) {
	VALUE proc = th-&gt;first_proc, loc;
        if (!proc || !RTEST(loc = rb_proc_location(proc))) {
            rb_raise(rb_eThreadError, &quot;already initialized thread&quot;);
        }
        rb_raise(rb_eThreadError,
		 &quot;already initialized thread - %&quot;PRIsVALUE&quot;:%&quot;PRIsVALUE,
                 RARRAY_AREF(loc, 0), RARRAY_AREF(loc, 1));
    }
    return thread_create_core(thread, args, 0);
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="abort_on_exception-class_method">
  <h3 class='signature rw first'>
    .<strong>abort_on_exception</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of the global "abort on exception&#39;&#39; condition.</p>

<p>The default is <code>false</code>.</p>

<p>When set to <code>true</code>, if any thread is aborted by an exception, the raised
exception will be re-raised in the main thread.</p>

<p>Can also be specified by the global $DEBUG flag or command line option
<code>-d</code>.</p>

<p>See also <a href="#abort_on_exception=-class_method" title="Thread.abort_on_exception= (method)">.abort_on_exception=</a>.</p>

<p>There is also an instance level method to set this for a specific thread,
see <a href="#abort_on_exception-instance_method" title="Thread#abort_on_exception (method)">#abort_on_exception</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2556-L2560'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2556
2557
2558
2559
2560</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2556</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_abort_exc(void)
{
    return GET_THREAD()-&gt;vm-&gt;thread_abort_on_exception ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="abort_on_exception=-class_method">
  <h3 class='signature rw'>
    .<strong>abort_on_exception=</strong>(boolean)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When set to <code>true</code>, if any thread is aborted by an exception, the raised
exception will be re-raised in the main thread. Returns the new state.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_abort_on_exception'><a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">abort_on_exception</a></span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_t1'>t1</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In new thread</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Exception from thread</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not reached</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby">In new thread
prog.rb:4: Exception from thread (RuntimeError)
 from prog.rb:2:in `initialize&#39;
 from prog.rb:2:in `new&#39;
 from prog.rb:2</code></pre>

<p>See also <a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">.abort_on_exception</a>.</p>

<p>There is also an instance level method to set this for a specific thread,
see <a href="#abort_on_exception=-instance_method" title="Thread#abort_on_exception= (method)">#abort_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2593-L2598'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2593
2594
2595
2596
2597
2598</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2593</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_abort_exc_set(VALUE self, VALUE val)
{
    GET_THREAD()-&gt;vm-&gt;thread_abort_on_exception = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="DEBUG-class_method">
  <h3 class='signature rw'>
    <strong>DEBUG</strong>  &#x21d2; <a href="Numeric.html" title="Numeric (class)">Numeric</a>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the thread debug level.  Available only if compiled with
THREAD_DEBUG=-1.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L239-L243'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


239
240
241
242
243</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 239</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_debug(void)
{
    return INT2NUM(rb_thread_debug_enabled);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="DEBUG=-class_method">
  <h3 class='signature rw'>
    <strong>DEBUG=</strong>(num)   <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the thread debug level.  Available only if compiled with
THREAD_DEBUG=-1.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L253-L258'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


253
254
255
256
257
258</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 253</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_debug_set(VALUE self, VALUE val)
{
    rb_thread_debug_enabled = RTEST(val) ? NUM2INT(val) : 0;
    return val;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="report_on_exception-class_method">
  <h3 class='signature rw'>
    .<strong>report_on_exception</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of the global "report on exception&#39;&#39; condition.</p>

<p>The default is <code>false</code>.</p>

<p>When set to <code>true</code>, all threads will report the exception if an exception
is raised in any thread.</p>

<p>See also <a href="#report_on_exception=-class_method" title="Thread.report_on_exception= (method)">.report_on_exception=</a>.</p>

<p>There is also an instance level method to set this for a specific thread,
see <a href="#report_on_exception-instance_method" title="Thread#report_on_exception (method)">#report_on_exception</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2666-L2670'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2666
2667
2668
2669
2670</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2666</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_report_exc(void)
{
    return GET_THREAD()-&gt;vm-&gt;thread_report_on_exception ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="report_on_exception=-class_method">
  <h3 class='signature rw'>
    .<strong>report_on_exception=</strong>(boolean)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When set to <code>true</code>, all threads will report the exception if an exception
is raised.  Returns the new state.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_report_on_exception'><a href="#report_on_exception-class_method" title="Thread.report_on_exception (method)">report_on_exception</a></span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_t1'>t1</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In new thread</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Exception from thread</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In the main thread</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby">In new thread
prog.rb:4: Exception from thread (RuntimeError)
 from prog.rb:2:in `initialize&#39;
 from prog.rb:2:in `new&#39;
 from prog.rb:2
In the main thread</code></pre>

<p>See also <a href="#report_on_exception-class_method" title="Thread.report_on_exception (method)">.report_on_exception</a>.</p>

<p>There is also an instance level method to set this for a specific thread,
see <a href="#report_on_exception=-instance_method" title="Thread#report_on_exception= (method)">#report_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2703-L2708'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2703
2704
2705
2706
2707
2708</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2703</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_report_exc_set(VALUE self, VALUE val)
{
    GET_THREAD()-&gt;vm-&gt;thread_report_on_exception = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="current-class_method">
  <h3 class='signature  first'>
    .<strong>current</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the currently executing thread.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span>   <span class='comment'>#=&gt; #&lt;Thread:0x401bdf4c run&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2510-L2514'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2510
2511
2512
2513
2514</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2510</span></pre>
<pre class='code cpp'>

static VALUE
thread_s_current(VALUE klass)
{
    return rb_thread_current();
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exclusive-class_method">
  <h3 class='signature '>
    .<strong>exclusive</strong>  &#x21d2; <a href="Object.html" title="Object (class)">Object</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wraps the block in a single, VM-global <a href="Thread/Mutex.html#synchronize-instance_method" title="Thread::Mutex#synchronize (method)">Mutex#synchronize</a>, returning the
value of the block. A thread executing inside the exclusive section will
only block other threads which also use the <code>exclusive</code>
mechanism.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/prelude.rb#L11-L16'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


11
12
13
14
15
16</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'prelude.rb', line 11</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_exclusive'>exclusive</span>
  <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Thread.exclusive is deprecated, use Thread::Mutex</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_caller'>caller</span>
  <span class='const'><a href="#MUTEX_FOR_THREAD_EXCLUSIVE-constant" title="Thread::MUTEX_FOR_THREAD_EXCLUSIVE (constant)">MUTEX_FOR_THREAD_EXCLUSIVE</a></span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span><span class='lbrace'>{</span>
    <span class='kw'>yield</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exit-class_method">
  <h3 class='signature '>
    .<strong>exit</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Terminates the currently running thread and schedules another thread to be
run.</p>

<p>If this thread is already marked to be killed, <code>.exit</code> returns the
<code>Thread</code>.</p>

<p>If this is the main thread, or the last  thread, exit the process.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2348-L2353'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2348
2349
2350
2351
2352
2353</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2348</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_exit(void)
{
    rb_thread_t *th = GET_THREAD();
    return rb_thread_kill(th-&gt;self);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fork-class_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>.<strong>start</strong>([args]) {|args| ... } &#x21d2; <code>Thread</code> </span>
      <span class='overload'>.<strong>fork</strong>([args]) {|args| ... } &#x21d2; <code>Thread</code> </span>
    </div>
    <span class='aliases'>Also known as: <span class='names'>.start</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically the same as <a href="#new-class_method" title="Thread.new (method)">.new</a>. However, if class <code>Thread</code> is
subclassed, then calling <a href="#start-class_method" title="Thread.start (method)">.start</a> in that subclass will not invoke the
subclass&#39;s <a href="#initialize-instance_method" title="Thread#initialize (method)">#initialize</a> method.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L793-L797'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


793
794
795
796
797</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 793</span></pre>
<pre class='code cpp'>

static VALUE
thread_start(VALUE klass, VALUE args)
{
    return thread_create_core(rb_thread_alloc(klass), args, 0);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_interrupt-class_method">
  <h3 class='signature '>
    .<strong>handle_interrupt</strong>(hash)  &#x21d2; <code>result</code> <code>of</code> <code>the</code> <code>block</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Changes asynchronous interrupt timing.</p>

<p><em>interrupt</em> means asynchronous event and corresponding procedure by
<a href="#raise-instance_method" title="Thread#raise (method)">#raise</a>, <a href="#kill-instance_method" title="Thread#kill (method)">#kill</a>, signal trap (not supported yet) and main
thread termination (if main thread terminates, then all other thread will
be killed).</p>

<p>The given <code>hash</code> has pairs like <code>ExceptionClass =&gt;
:TimingSymbol</code>. Where the ExceptionClass is the interrupt handled by
the given block. The TimingSymbol can be one of the following symbols:</p>
<dl class="rdoc-list label-list"><dt><code>:immediate</code>
<dd>
<p>Invoke interrupts immediately.</p>
</dd><dt><code>:on_blocking</code>
<dd>
<p>Invoke interrupts while <em>BlockingOperation</em>.</p>
</dd><dt><code>:never</code>
<dd>
<p>Never invoke all interrupts.</p>
</dd></dl>

<p><em>BlockingOperation</em> means that the operation will block the calling
thread, such as read and write.  On CRuby implementation,
<em>BlockingOperation</em> is any operation executed without GVL.</p>

<p>Masked asynchronous interrupts are delayed until they are enabled. This
method is similar to sigprocmask(3).</p>

<h3 id="label-NOTE">NOTE</h3>

<p>Asynchronous interrupts are difficult to use.</p>

<p>If you need to communicate between threads, please consider to use another
way such as <a href="Queue.html" title="Queue (class)">::Queue</a>.</p>

<p>Or use them with deep understanding about this method.</p>

<h3 id="label-Usage">Usage</h3>

<p>In this example, we can guard from <a href="#raise-instance_method" title="Thread#raise (method)">#raise</a> exceptions.</p>

<p>Using the <code>:never</code> TimingSymbol the <a href="RuntimeError.html" title="RuntimeError (class)">::RuntimeError</a> exception
will always be ignored in the first block of the main thread. In the second
<code>.handle_interrupt</code> block we can purposefully handle <a href="RuntimeError.html" title="RuntimeError (class)">::RuntimeError</a>
exceptions.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_th'>th</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span><span class='lparen'>(</span><span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='kw'>begin</span>
      <span class='comment'># You can write resource allocation code safely.
</span>      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span><span class='lparen'>(</span><span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_immediate'>immediate</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
        <span class='comment'># ...
</span>      <span class='rbrace'>}</span>
    <span class='kw'>ensure</span>
      <span class='comment'># You can write resource deallocation code safely.
</span>    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
<span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_pass'><a href="#pass-class_method" title="Thread.pass (method)">pass</a></span>
<span class='comment'># ...
</span><span class='id identifier rubyid_th'>th</span><span class='period'>.</span><span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stop</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>While we are ignoring the <a href="RuntimeError.html" title="RuntimeError (class)">::RuntimeError</a> exception, it&#39;s safe to write
our resource allocation code. Then, the ensure block is where we can safely
deallocate your resources.</p>

<h4 id="label-Guarding+from+-7BTimeout-3A-3AError-7D">Guarding from <code>Timeout::Error</code></h4>

<p>In the next example, we will guard from the <code>Timeout::Error</code> exception.
This will help prevent from leaking resources when <code>Timeout::Error</code>
exceptions occur during normal ensure clause. For this example we use the
help of the standard library Timeout, from lib/timeout.rb</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>timeout</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span><span class='lparen'>(</span><span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_timeout'>timeout</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span><span class='lbrace'>{</span>
    <span class='comment'># Timeout::Error doesn&#39;t occur here
</span>    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span><span class='lparen'>(</span><span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_blocking'>on_blocking</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='comment'># possible to be killed by Timeout::Error
</span>      <span class='comment'># while blocking operation
</span>    <span class='rbrace'>}</span>
    <span class='comment'># Timeout::Error doesn&#39;t occur here
</span>  <span class='rbrace'>}</span>
<span class='rbrace'>}</span></code></pre>

<p>In the first part of the <code>timeout</code> block, we can rely on <code>Timeout::Error</code>
being ignored. Then in the <code>Timeout::Error =&gt; :on_blocking</code>
block, any operation that will block the calling thread is susceptible to a
<code>Timeout::Error</code> exception being raised.</p>

<h4 id="label-Stack+control+settings">Stack control settings</h4>

<p>It&#39;s possible to stack multiple levels of <code>.handle_interrupt</code> blocks in
order to control more than one ExceptionClass and TimingSymbol at a time.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span><span class='lparen'>(</span><span class='const'>FooError</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span><span class='lparen'>(</span><span class='const'>BarError</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
     <span class='comment'># FooError and BarError are prohibited.
</span>  <span class='rbrace'>}</span>
<span class='rbrace'>}</span></code></pre>

<h4 id="label-Inheritance+with+ExceptionClass">Inheritance with ExceptionClass</h4>

<p>All exceptions inherited from the ExceptionClass parameter will be
considered.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span><span class='lparen'>(</span><span class='const'><a href="Exception.html" title="Exception (class)">Exception</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
  <span class='comment'># all exceptions inherited from Exception are prohibited.
</span><span class='rbrace'>}</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L1850-L1894'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1850
1851
1852
1853
1854
1855
1856
1857
1858
1859
1860
1861
1862
1863
1864
1865
1866
1867
1868
1869
1870
1871
1872
1873
1874
1875
1876
1877
1878
1879
1880
1881
1882
1883
1884
1885
1886
1887
1888
1889
1890
1891
1892
1893
1894</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 1850</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_handle_interrupt(VALUE self, VALUE mask_arg)
{
    VALUE mask;
    rb_thread_t *th = GET_THREAD();
    volatile VALUE r = Qnil;
    int state;

    if (!rb_block_given_p()) {
	rb_raise(rb_eArgError, &quot;block is needed.&quot;);
    }

    mask = 0;
    mask_arg = rb_convert_type(mask_arg, T_HASH, &quot;Hash&quot;, &quot;to_hash&quot;);
    rb_hash_foreach(mask_arg, handle_interrupt_arg_check_i, (VALUE)&amp;mask);
    if (!mask) {
	return rb_yield(Qnil);
    }
    OBJ_FREEZE_RAW(mask);
    rb_ary_push(th-&gt;pending_interrupt_mask_stack, mask);
    if (!rb_threadptr_pending_interrupt_empty_p(th)) {
	th-&gt;pending_interrupt_queue_checked = 0;
	RUBY_VM_SET_INTERRUPT(th);
    }

    TH_PUSH_TAG(th);
    if ((state = EXEC_TAG()) == 0) {
	r = rb_yield(Qnil);
    }
    TH_POP_TAG();

    rb_ary_pop(th-&gt;pending_interrupt_mask_stack);
    if (!rb_threadptr_pending_interrupt_empty_p(th)) {
	th-&gt;pending_interrupt_queue_checked = 0;
	RUBY_VM_SET_INTERRUPT(th);
    }

    RUBY_VM_CHECK_INTS(th);

    if (state) {
	TH_JUMP_TAG(th, state);
    }

    return r;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="kill-class_method">
  <h3 class='signature '>
    .<strong>kill</strong>(thread)  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Causes the given <code>thread</code> to exit, see also <a href="#exit-class_method" title="Thread.exit (method)">.exit</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_loop'>loop</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span>       <span class='comment'>#=&gt; 0
</span><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; #&lt;Thread:0x401b3d30 dead&gt;
</span><span class='id identifier rubyid_count'>count</span>            <span class='comment'>#=&gt; 93947
</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_alive?'>alive?</span>         <span class='comment'>#=&gt; false</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2329-L2333'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2329
2330
2331
2332
2333</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2329</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_kill(VALUE obj, VALUE th)
{
    return rb_thread_kill(th);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="list-class_method">
  <h3 class='signature '>
    .<strong>list</strong>  &#x21d2; <a href="Array.html" title="Array (class)">Array</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an array of <code>Thread</code> objects for all threads that are
either runnable or stopped.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>200</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='int'>1000000</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='op'>*</span><span class='id identifier rubyid_i'>i</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
<span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span> <span class='rbrace'>}</span>
<span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_each'><a href="Array.html#each-instance_method" title="Array#each (method)">each</a></span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_t'>t</span><span class='rbrace'>}</span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;Thread:0x401b3e84 sleep&gt;
</span><span class='comment'>#&lt;Thread:0x401b3f38 run&gt;
</span><span class='comment'>#&lt;Thread:0x401b3fb0 sleep&gt;
</span><span class='comment'>#&lt;Thread:0x401bdf4c run&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2475-L2493'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2475
2476
2477
2478
2479
2480
2481
2482
2483
2484
2485
2486
2487
2488
2489
2490
2491
2492
2493</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2475</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_list(void)
{
    VALUE ary = rb_ary_new();
    rb_vm_t *vm = GET_THREAD()-&gt;vm;
    rb_thread_t *th = 0;

    list_for_each(&amp;vm-&gt;living_threads, th, vmlt_node) {
	switch (th-&gt;status) {
	  case THREAD_RUNNABLE:
	  case THREAD_STOPPED:
	  case THREAD_STOPPED_FOREVER:
	    rb_ary_push(ary, th-&gt;self);
	  default:
	    break;
	}
    }
    return ary;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="main-class_method">
  <h3 class='signature '>
    .<strong>main</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the main thread.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2529-L2533'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2529
2530
2531
2532
2533</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2529</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_main(VALUE klass)
{
    return rb_thread_main();
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pass-class_method">
  <h3 class='signature '>
    .<strong>pass</strong>  &#x21d2; <code>nil</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Give the thread scheduler a hint to pass execution to another thread. A
running thread may or may not switch, it depends on OS and processor.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L1556-L1561'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1556
1557
1558
1559
1560
1561</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 1556</span></pre>
<pre class='code cpp'>

static VALUE
thread_s_pass(VALUE klass)
{
    rb_thread_schedule();
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pending_interrupt?-class_method">
  <h3 class='signature '>
    .<strong>pending_interrupt?</strong>(error = nil)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether or not the asynchronous queue is empty.</p>

<p>Since <a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">.handle_interrupt</a> can be used to defer asynchronous events,
this method can be used to determine if there are any deferred events.</p>

<p>If you find this method returns true, then you may finish
<code>:never</code> blocks.</p>

<p>For example, the following method processes deferred asynchronous events
immediately.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_kick_interrupt_immediately'>kick_interrupt_immediately</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'><a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">handle_interrupt</a></span><span class='lparen'>(</span><span class='const'><a href="Object.html" title="Object (class)">Object</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_immediate'>immediate</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_pass'><a href="#pass-class_method" title="Thread.pass (method)">pass</a></span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></code></pre>

<p>If <code>error</code> is given, then check only for <code>error</code> type deferred events.</p>

<h3 id="label-Usage">Usage</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_th'>th</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span><span class='lbrace'>{</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'><a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">handle_interrupt</a></span><span class='lparen'>(</span><span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_blocking'>on_blocking</span><span class='rparen'>)</span><span class='lbrace'>{</span>
    <span class='kw'>while</span> <span class='kw'>true</span>
      <span class='comment'>#...
</span>      <span class='comment'># reach safe point to invoke interrupt
</span>      <span class='kw'>if</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_pending_interrupt?'>pending_interrupt?</span>
        <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'><a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">handle_interrupt</a></span><span class='lparen'>(</span><span class='const'><a href="Object.html" title="Object (class)">Object</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_immediate'>immediate</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='kw'>end</span>
      <span class='comment'>#...
</span>    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span>
<span class='comment'>#...
</span><span class='id identifier rubyid_th'>th</span><span class='period'>.</span><span class='id identifier rubyid_raise'>raise</span> <span class='comment'># stop thread</span></code></pre>

<p>This example can also be written as the following, which you should use to
avoid asynchronous interrupts.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_th'>th</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span><span class='lbrace'>{</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_handle_interrupt'><a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">handle_interrupt</a></span><span class='lparen'>(</span><span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_blocking'>on_blocking</span><span class='rparen'>)</span><span class='lbrace'>{</span>
    <span class='kw'>while</span> <span class='kw'>true</span>
      <span class='comment'>#...
</span>      <span class='comment'># reach safe point to invoke interrupt
</span>      <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_flag'>flag</span> <span class='op'>==</span> <span class='kw'>false</span>
      <span class='comment'>#...
</span>    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span>
<span class='comment'>#...
</span><span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='comment'># stop thread</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L1994-L1998'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1994
1995
1996
1997
1998</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 1994</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_pending_interrupt_p(int argc, VALUE *argv, VALUE self)
{
    return rb_thread_pending_interrupt_p(argc, argv, GET_THREAD()-&gt;self);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="start-class_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>.<strong>start</strong>([args]) {|args| ... } &#x21d2; <code>Thread</code> </span>
      <span class='overload'>.<strong>fork</strong>([args]) {|args| ... } &#x21d2; <code>Thread</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#fork-class_method" title="Thread.fork (method)">.fork</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>
</section>

<section class='method_details' id="stop-class_method">
  <h3 class='signature '>
    .<strong>stop</strong>  &#x21d2; <code>nil</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Stops execution of the current thread, putting it into a "sleep&#39;&#39;
state, and schedules execution of another thread.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_stop'>stop</span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.1</span> <span class='kw'>while</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sleep</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span>
<span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
<span class='comment'>#=&gt; &quot;abc&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2442-L2451'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2442
2443
2444
2445
2446
2447
2448
2449
2450
2451</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2442</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_stop(void)
{
    if (rb_thread_alone()) {
	rb_raise(rb_eThreadError,
		 &quot;stopping only thread\n\tnote: use sleep to stop forever&quot;);
    }
    rb_thread_sleep_deadly();
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="abort_on_exception-instance_method">
  <h3 class='signature rw first'>
    #<strong>abort_on_exception</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of the thread-local "abort on exception&#39;&#39;
condition for this <code>thr</code>.</p>

<p>The default is <code>false</code>.</p>

<p>See also <a href="#abort_on_exception=-instance_method" title="Thread#abort_on_exception= (method)">#abort_on_exception=</a>.</p>

<p>There is also a class level method to set this for all threads, see
<a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">.abort_on_exception</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2616-L2622'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2616
2617
2618
2619
2620
2621
2622</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2616</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_abort_exc(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);
    return th-&gt;abort_on_exception ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="abort_on_exception=-instance_method">
  <h3 class='signature rw'>
    #<strong>abort_on_exception=</strong>(boolean)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When set to <code>true</code>, if this <code>thr</code> is aborted by an exception, the raised
exception will be re-raised in the main thread.</p>

<p>See also <a href="#abort_on_exception-instance_method" title="Thread#abort_on_exception (method)">#abort_on_exception</a>.</p>

<p>There is also a class level method to set this for all threads, see
<a href="#abort_on_exception=-class_method" title="Thread.abort_on_exception= (method)">.abort_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2638-L2646'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2638
2639
2640
2641
2642
2643
2644
2645
2646</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2638</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_abort_exc_set(VALUE thread, VALUE val)
{
    rb_thread_t *th;

    GetThreadPtr(thread, th);
    th-&gt;abort_on_exception = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="alive?-instance_method">
  <h3 class='signature ro'>
    #<strong>alive?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if <code>thr</code> is running or sleeping.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>                <span class='comment'>#=&gt; #&lt;Thread:0x401b3fb0 dead&gt;
</span><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_alive?'>alive?</span>   <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_alive?'>alive?</span>              <span class='comment'>#=&gt; false</span></code></pre>

<p>See also <a href="#stop%3F-instance_method" title="Thread#stop? (method)">#stop?</a> and <a href="#status-instance_method" title="Thread#status (method)">#status</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2872-L2881'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2872
2873
2874
2875
2876
2877
2878
2879
2880
2881</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2872</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_alive_p(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);

    if (rb_threadptr_dead(th))
	return Qfalse;
    return Qtrue;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="name-instance_method">
  <h3 class='signature rw'>
    #<strong>name</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>show the name of the thread.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2938-L2944'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2938
2939
2940
2941
2942
2943
2944</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2938</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_getname(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);
    return th-&gt;name;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="name=-instance_method">
  <h3 class='signature rw'>
    #<strong>name=</strong>(name)  &#x21d2; <a href="String.html" title="String (class)">String</a>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>set given name to the ruby thread. On some platform, it may set the name to
pthread and/or kernel.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2954-L2982'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2954
2955
2956
2957
2958
2959
2960
2961
2962
2963
2964
2965
2966
2967
2968
2969
2970
2971
2972
2973
2974
2975
2976
2977
2978
2979
2980
2981
2982</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2954</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_setname(VALUE thread, VALUE name)
{
#ifdef SET_ANOTHER_THREAD_NAME
    const char *s = &quot;&quot;;
#endif
    rb_thread_t *th;
    GetThreadPtr(thread, th);
    if (!NIL_P(name)) {
	rb_encoding *enc;
	StringValueCStr(name);
	enc = rb_enc_get(name);
	if (!rb_enc_asciicompat(enc)) {
	    rb_raise(rb_eArgError, &quot;ASCII incompatible encoding (%s)&quot;,
		     rb_enc_name(enc));
	}
	name = rb_str_new_frozen(name);
#ifdef SET_ANOTHER_THREAD_NAME
	s = RSTRING_PTR(name);
#endif
    }
    th-&gt;name = name;
#if defined(SET_ANOTHER_THREAD_NAME)
    if (threadptr_initialized(th)) {
	SET_ANOTHER_THREAD_NAME(th-&gt;thread_id, s);
    }
#endif
    return name;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="priority-instance_method">
  <h3 class='signature rw'>
    #<strong>priority</strong>  &#x21d2; <a href="Integer.html" title="Integer (class)">Integer</a>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the priority of <em>thr</em>. Default is inherited from the current
thread which creating the new thread, or zero for the initial main thread;
higher-priority thread will run more frequently than lower-priority threads
(but lower-priority threads can also run).</p>

<p>This is just hint for Ruby thread scheduler.  It may be ignored on some
platform.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_priority'>priority</span>   <span class='comment'>#=&gt; 0</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3419-L3425'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3419
3420
3421
3422
3423
3424
3425</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3419</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_priority(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);
    return INT2NUM(th-&gt;priority);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="priority=-instance_method">
  <h3 class='signature rw'>
    #<strong>priority=</strong>(integer)  &#x21d2; <code>Thread</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the priority of <em>thr</em> to <em>integer</em>. Higher-priority
threads will run more frequently than lower-priority threads (but
lower-priority threads can also run).</p>

<p>This is just hint for Ruby thread scheduler.  It may be ignored on some
platform.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_count1'>count1</span> <span class='op'>=</span> <span class='id identifier rubyid_count2'>count2</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_loop'>loop</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_count1'>count1</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
<span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_priority'>priority</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>

<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_loop'>loop</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_count2'>count2</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
<span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_priority'>priority</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>2</span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>1</span>   <span class='comment'>#=&gt; 1
</span><span class='id identifier rubyid_count1'>count1</span>    <span class='comment'>#=&gt; 622504
</span><span class='id identifier rubyid_count2'>count2</span>    <span class='comment'>#=&gt; 5832</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3454-L3476'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3454
3455
3456
3457
3458
3459
3460
3461
3462
3463
3464
3465
3466
3467
3468
3469
3470
3471
3472
3473
3474
3475
3476</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3454</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_priority_set(VALUE thread, VALUE prio)
{
    rb_thread_t *th;
    int priority;
    GetThreadPtr(thread, th);


#if USE_NATIVE_THREAD_PRIORITY
    th-&gt;priority = NUM2INT(prio);
    native_thread_apply_priority(th);
#else
    priority = NUM2INT(prio);
    if (priority &gt; RUBY_THREAD_PRIORITY_MAX) {
	priority = RUBY_THREAD_PRIORITY_MAX;
    }
    else if (priority &lt; RUBY_THREAD_PRIORITY_MIN) {
	priority = RUBY_THREAD_PRIORITY_MIN;
    }
    th-&gt;priority = priority;
#endif
    return INT2NUM(th-&gt;priority);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="report_on_exception-instance_method">
  <h3 class='signature rw'>
    #<strong>report_on_exception</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of the thread-local "report on exception&#39;&#39;
condition for this <code>thr</code>.</p>

<p>The default is <code>false</code>.</p>

<p>See also <a href="#report_on_exception=-instance_method" title="Thread#report_on_exception= (method)">#report_on_exception=</a>.</p>

<p>There is also a class level method to set this for all threads, see
<a href="#report_on_exception-class_method" title="Thread.report_on_exception (method)">.report_on_exception</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2726-L2732'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2726
2727
2728
2729
2730
2731
2732</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2726</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_report_exc(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);
    return th-&gt;report_on_exception ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="report_on_exception=-instance_method">
  <h3 class='signature rw'>
    #<strong>report_on_exception=</strong>(boolean)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When set to <code>true</code>, all threads (including the main program) will report
the exception if an exception is raised in this <code>thr</code>.</p>

<p>See also <a href="#report_on_exception-instance_method" title="Thread#report_on_exception (method)">#report_on_exception</a>.</p>

<p>There is also a class level method to set this for all threads, see
<a href="#report_on_exception=-class_method" title="Thread.report_on_exception= (method)">.report_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2748-L2756'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2748
2749
2750
2751
2752
2753
2754
2755
2756</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2748</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_report_exc_set(VALUE thread, VALUE val)
{
    rb_thread_t *th;

    GetThreadPtr(thread, th);
    th-&gt;report_on_exception = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stop?-instance_method">
  <h3 class='signature ro'>
    #<strong>stop?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if <code>thr</code> is dead or sleeping.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>
<span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_stop?'>stop?</span>   <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_stop?'>stop?</span>   <span class='comment'>#=&gt; false</span></code></pre>

<p>See also <a href="#alive%3F-instance_method" title="Thread#alive? (method)">#alive?</a> and <a href="#status-instance_method" title="Thread#status (method)">#status</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2897-L2908'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2897
2898
2899
2900
2901
2902
2903
2904
2905
2906
2907
2908</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2897</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_stop_p(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);

    if (rb_threadptr_dead(th))
	return Qtrue;
    if (th-&gt;status == THREAD_STOPPED || th-&gt;status == THREAD_STOPPED_FOREVER)
	return Qtrue;
    return Qfalse;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="[]-instance_method">
  <h3 class='signature  first'>
    #<strong>[]</strong>(sym)  &#x21d2; <a href="Object.html" title="Object (class)">Object</a><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attribute Reference---Returns the value of a fiber-local variable (current
thread&#39;s root fiber if not explicitly inside a <a href="Fiber.html" title="Fiber (class)">::Fiber</a>), using either a
symbol or a string name. If the specified variable does not exist, returns
<code>nil</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='lbracket'>[</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>B</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_th'>th</span><span class='op'>|</span>
  <span class='id identifier rubyid_th'>th</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_th'>th</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_th'>th</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;Thread:0x00000002a54220 dead&gt;: A
</span><span class='comment'>#&lt;Thread:0x00000002a541a8 dead&gt;: B
</span><span class='comment'>#&lt;Thread:0x00000002a54130 dead&gt;: C</span></code></pre>

<p><code>[]</code> and <a href="#[]=-instance_method" title="Thread#[]= (method)">#[]=</a> are not thread-local but fiber-local. This
confusion did not exist in Ruby 1.8 because fibers are only available since
Ruby 1.9. Ruby 1.9 chooses that the methods behaves fiber-local to save
following idiom for dynamic scope.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_meth'>meth</span><span class='lparen'>(</span><span class='id identifier rubyid_newvalue'>newvalue</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_oldvalue'>oldvalue</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_newvalue'>newvalue</span>
    <span class='kw'>yield</span>
  <span class='kw'>ensure</span>
    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_oldvalue'>oldvalue</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The idiom may not work as dynamic scope if the methods are thread-local and
a given block switches fiber.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Fiber.html#new-class_method" title="Fiber.new (method)">new</a></span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_meth'>meth</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span><span class='period'>.</span><span class='id identifier rubyid_yield'><a href="Fiber.html#yield-class_method" title="Fiber.yield (method)">yield</a></span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span>
<span class='id identifier rubyid_meth'>meth</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_resume'>resume</span>
<span class='rbrace'>}</span>
<span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_resume'>resume</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
<span class='comment'>#=&gt; nil if fiber-local
</span><span class='comment'>#=&gt; 2 if thread-local (The value 2 is leaked to outside of meth method.)</span></code></pre>

<p>For thread-local variables, please see <a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> and
<a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">#thread_variable_set</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3108-L3114'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3108
3109
3110
3111
3112
3113
3114</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3108</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_aref(VALUE thread, VALUE key)
{
    ID id = rb_check_id(&amp;key);
    if (!id) return Qnil;
    return rb_thread_local_aref(thread, id);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]=-instance_method">
  <h3 class='signature '>
    #<strong>[]=</strong>(sym, obj)  &#x21d2; <a href="Object.html" title="Object (class)">Object</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attribute Assignment---Sets or creates the value of a fiber-local variable,
using either a symbol or a string.</p>

<p>See also <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a>.</p>

<p>For thread-local variables, please see <a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">#thread_variable_set</a> and
<a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3196-L3200'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3196
3197
3198
3199
3200</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3196</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_aset(VALUE self, VALUE id, VALUE val)
{
    return rb_thread_local_aset(self, rb_to_id(id), val);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="add_trace_func-instance_method">
  <h3 class='signature '>
    #<strong>add_trace_func</strong>(proc)  &#x21d2; <a href="Proc.html" title="Proc (class)">Proc</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Adds <em>proc</em> as a handler for tracing.</p>

<p>See <a href="#set_trace_func-instance_method" title="Thread#set_trace_func (method)">#set_trace_func</a> and <a href="Kernel.html#set_trace_func-class_method" title="Kernel.set_trace_func (method)">Kernel.set_trace_func</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/vm_trace.c#L526-L534'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


526
527
528
529
530
531
532
533
534</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'vm_trace.c', line 526</span></pre>
<pre class='code cpp'>

static VALUE
thread_add_trace_func_m(VALUE obj, VALUE trace)
{
    rb_thread_t *th;

    GetThreadPtr(obj, th);
    thread_add_trace_func(th, trace);
    return trace;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="backtrace-instance_method">
  <h3 class='signature '>
    #<strong>backtrace</strong>  &#x21d2; <a href="Array.html" title="Array (class)">Array</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the current backtrace of the target thread.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L4770-L4774'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


4770
4771
4772
4773
4774</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 4770</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_backtrace_m(int argc, VALUE *argv, VALUE thval)
{
    return rb_vm_thread_backtrace(argc, argv, thval);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="backtrace_locations-instance_method">
  <h3 class='signature '>
    #<strong>backtrace_locations</strong>(*args)  &#x21d2; <a href="Array.html" title="Array (class)">Array</a><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the execution stack for the target thread---an array containing
backtrace location objects.</p>

<p>See <a href="Thread/Backtrace/Location.html" title="Thread::Backtrace::Location (class)">::Thread::Backtrace::Location</a> for more information.</p>

<p>This method behaves similarly to <a href="Kernel.html#caller_locations-class_method" title="Kernel.caller_locations (method)">Kernel.caller_locations</a> except it
applies to a specific thread.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L4787-L4791'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


4787
4788
4789
4790
4791</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 4787</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_backtrace_locations_m(int argc, VALUE *argv, VALUE thval)
{
    return rb_vm_thread_backtrace_locations(argc, argv, thval);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exit-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>exit</strong>  &#x21d2; <code>Thread</code><sup>?</sup> </span>
      <span class='overload'>#<strong>kill</strong>  &#x21d2; <code>Thread</code><sup>?</sup> </span>
      <span class='overload'>#<strong>terminate</strong>  &#x21d2; <code>Thread</code><sup>?</sup> </span>
    </div>
    <span class='aliases'>Also known as: <span class='names'>#kill, #terminate</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Terminates <code>thr</code> and schedules another thread to be run.</p>

<p>If this thread is already marked to be killed, <code>#exit</code> returns the
<code>Thread</code>.</p>

<p>If this is the main thread, or the last thread, exits the process.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2274-L2300'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2274
2275
2276
2277
2278
2279
2280
2281
2282
2283
2284
2285
2286
2287
2288
2289
2290
2291
2292
2293
2294
2295
2296
2297
2298
2299
2300</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2274</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_kill(VALUE thread)
{
    rb_thread_t *th;

    GetThreadPtr(thread, th);

    if (th-&gt;to_kill || th-&gt;status == THREAD_KILLED) {
	return thread;
    }
    if (th == th-&gt;vm-&gt;main_thread) {
	rb_exit(EXIT_SUCCESS);
    }

    thread_debug(&quot;rb_thread_kill: %p (%&quot;PRI_THREAD_ID&quot;)\n&quot;, (void *)th, thread_id_str(th));

    if (th == GET_THREAD()) {
	/* kill myself immediately */
	rb_threadptr_to_kill(th);
    }
    else {
	threadptr_check_pending_interrupt_queue(th);
	rb_threadptr_pending_interrupt_enque(th, eKillSignal);
	rb_threadptr_interrupt(th);
    }
    return thread;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fetch-instance_method">
  <h3 class='signature '>
    #<strong>fetch</strong>(*args)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3116-L3147'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3116
3117
3118
3119
3120
3121
3122
3123
3124
3125
3126
3127
3128
3129
3130
3131
3132
3133
3134
3135
3136
3137
3138
3139
3140
3141
3142
3143
3144
3145
3146
3147</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3116</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_fetch(int argc, VALUE *argv, VALUE self)
{
    VALUE key, val;
    ID id;
    rb_thread_t *th;
    int block_given;

    rb_check_arity(argc, 1, 2);
    key = argv[0];

    block_given = rb_block_given_p();
    if (block_given &amp;&amp; argc == 2) {
	rb_warn(&quot;block supersedes default value argument&quot;);
    }

    id = rb_check_id(&amp;key);
    GetThreadPtr(self, th);

    if (id == recursive_key) {
	return th-&gt;local_storage_recursive_hash;
    }
    if (id &amp;&amp; th-&gt;local_storage &amp;&amp; st_lookup(th-&gt;local_storage, id, &amp;val)) {
	return val;
    }
    if (block_given)
	return rb_yield(key);
    else if (argc == 1)
	rb_raise(rb_eKeyError, &quot;key not found: %&quot;PRIsVALUE, key);
    else
	return argv[1];
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="group-instance_method">
  <h3 class='signature '>
    #<strong>group</strong>  &#x21d2; <code>thgrp</code><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the <a href="ThreadGroup.html" title="ThreadGroup (class)">::ThreadGroup</a> which contains the given thread, or returns <code>nil</code>
if <code>thr</code> is not a member of any group.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_main'><a href="#main-class_method" title="Thread.main (method)">main</a></span><span class='period'>.</span><span class='id identifier rubyid_group'>group</span>   <span class='comment'>#=&gt; #&lt;ThreadGroup:0x4029d914&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2769-L2781'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2769
2770
2771
2772
2773
2774
2775
2776
2777
2778
2779
2780
2781</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2769</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_group(VALUE thread)
{
    rb_thread_t *th;
    VALUE group;
    GetThreadPtr(thread, th);
    group = th-&gt;thgroup;

    if (!group) {
	group = Qnil;
    }
    return group;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Dump the name, id, and status of <em>thr</em> to a string.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2991-L3017'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2991
2992
2993
2994
2995
2996
2997
2998
2999
3000
3001
3002
3003
3004
3005
3006
3007
3008
3009
3010
3011
3012
3013
3014
3015
3016
3017</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2991</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_inspect(VALUE thread)
{
    VALUE cname = rb_class_path(rb_obj_class(thread));
    rb_thread_t *th;
    const char *status;
    VALUE str;

    GetThreadPtr(thread, th);
    status = thread_status_name(th, TRUE);
    str = rb_sprintf(&quot;#&lt;%&quot;PRIsVALUE&quot;:%p&quot;, cname, (void *)thread);
    if (!NIL_P(th-&gt;name)) {
	rb_str_catf(str, &quot;@%&quot;PRIsVALUE, th-&gt;name);
    }
    if (!th-&gt;first_func &amp;&amp; th-&gt;first_proc) {
	VALUE loc = rb_proc_location(th-&gt;first_proc);
	if (!NIL_P(loc)) {
	    const VALUE *ptr = RARRAY_CONST_PTR(loc);
	    rb_str_catf(str, &quot;@%&quot;PRIsVALUE&quot;:%&quot;PRIsVALUE, ptr[0], ptr[1]);
	    rb_gc_force_recycle(loc);
	}
    }
    rb_str_catf(str, &quot; %s&gt;&quot;, status);
    OBJ_INFECT(str, thread);

    return str;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="join-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>join</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>#<strong>join</strong>(limit)  &#x21d2; <code>Thread</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The calling thread will suspend execution and run this <code>thr</code>.</p>

<p>Does not return until <code>thr</code> exits or until the given <code>limit</code> seconds have
passed.</p>

<p>If the time limit expires, <code>nil</code> will be returned, otherwise <code>thr</code> is
returned.</p>

<p>Any threads not joined will be killed when the main program exits.</p>

<p>If <code>thr</code> had previously raised an exception and the <a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">.abort_on_exception</a>
or $DEBUG flags are not set, (so the exception has not yet been processed),
it will be processed at this time.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_pass'><a href="#pass-class_method" title="Thread.pass (method)">pass</a></span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>y</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>z</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='comment'># Let thread x finish, thread a will be killed on exit.
</span><span class='comment'>#=&gt; &quot;axyz&quot;</span></code></pre>

<p>The following example illustrates the <code>limit</code> parameter.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='int'>4</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.1</span><span class='semicolon'>;</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tick... </span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='rbrace'>}</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Waiting</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>until</span> <span class='id identifier rubyid_y'>y</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='float'>0.15</span><span class='rparen'>)</span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby">tick...
Waiting
tick...
Waiting
tick...
tick...</code></pre>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L978-L993'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 978</span></pre>
<pre class='code cpp'>

static VALUE
thread_join_m(int argc, VALUE *argv, VALUE self)
{
    rb_thread_t *target_th;
    double delay = DELAY_INFTY;
    VALUE limit;

    GetThreadPtr(self, target_th);

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;limit);
    if (!NIL_P(limit)) {
	delay = rb_num2dbl(limit);
    }

    return thread_join(target_th, delay);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="key?-instance_method">
  <h3 class='signature '>
    #<strong>key?</strong>(sym)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if the given string (or symbol) exists as a fiber-local
variable.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_me'>me</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>
<span class='id identifier rubyid_me'>me</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_oliver'>oliver</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_me'>me</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_oliver'>oliver</span><span class='rparen'>)</span>    <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_me'>me</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_stanley'>stanley</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; false</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3274-L3289'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3274
3275
3276
3277
3278
3279
3280
3281
3282
3283
3284
3285
3286
3287
3288
3289</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3274</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_key_p(VALUE self, VALUE key)
{
    rb_thread_t *th;
    ID id = rb_check_id(&amp;key);

    GetThreadPtr(self, th);

    if (!id || !th-&gt;local_storage) {
	return Qfalse;
    }
    if (st_lookup(th-&gt;local_storage, id, 0)) {
	return Qtrue;
    }
    return Qfalse;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="keys-instance_method">
  <h3 class='signature '>
    #<strong>keys</strong>  &#x21d2; <a href="Array.html" title="Array (class)">Array</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an array of the names of the fiber-local variables (as Symbols).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_cat'>cat</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>meow</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dog</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>woof</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>   <span class='comment'>#=&gt; #&lt;Thread:0x401b3f10 dead&gt;
</span><span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>   <span class='comment'>#=&gt; [:dog, :cat]</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3318-L3329'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3318
3319
3320
3321
3322
3323
3324
3325
3326
3327
3328
3329</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3318</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_keys(VALUE self)
{
    rb_thread_t *th;
    VALUE ary = rb_ary_new();
    GetThreadPtr(self, th);

    if (th-&gt;local_storage) {
	st_foreach(th-&gt;local_storage, thread_keys_i, ary);
    }
    return ary;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="kill-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>exit</strong>  &#x21d2; <code>Thread</code><sup>?</sup> </span>
      <span class='overload'>#<strong>kill</strong>  &#x21d2; <code>Thread</code><sup>?</sup> </span>
      <span class='overload'>#<strong>terminate</strong>  &#x21d2; <code>Thread</code><sup>?</sup> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>
</section>

<section class='method_details' id="pending_interrupt?-instance_method">
  <h3 class='signature '>
    #<strong>pending_interrupt?</strong>(error = nil)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether or not the asynchronous queue is empty for the target
thread.</p>

<p>If <code>error</code> is given, then check only for <code>error</code> type deferred events.</p>

<p>See <a href="#pending_interrupt%3F-class_method" title="Thread.pending_interrupt? (method)">.pending_interrupt?</a> for more information.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L1906-L1935'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916
1917
1918
1919
1920
1921
1922
1923
1924
1925
1926
1927
1928
1929
1930
1931
1932
1933
1934
1935</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 1906</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_pending_interrupt_p(int argc, VALUE *argv, VALUE target_thread)
{
    rb_thread_t *target_th;

    GetThreadPtr(target_thread, target_th);

    if (!target_th-&gt;pending_interrupt_queue) {
	return Qfalse;
    }
    if (rb_threadptr_pending_interrupt_empty_p(target_th)) {
	return Qfalse;
    }
    else {
	if (argc == 1) {
	    VALUE err;
	    rb_scan_args(argc, argv, &quot;01&quot;, &amp;err);
	    if (!rb_obj_is_kind_of(err, rb_cModule)) {
		rb_raise(rb_eTypeError, &quot;class or module required for rescue clause&quot;);
	    }
	    if (rb_threadptr_pending_interrupt_include_p(target_th, err)) {
		return Qtrue;
	    }
	    else {
		return Qfalse;
	    }
	}
	return Qtrue;
    }
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>raise</strong>  </span>
      <span class='overload'>#<strong>raise</strong>(string)  </span>
      <span class='overload'>#<strong>raise</strong>(exception[, string [, array]])  </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raises an exception from the given thread. The caller does not have to be
<code>thr</code>. See <a href="Kernel.html#raise-class_method" title="Kernel.raise (method)">Kernel.raise</a> for more information.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_abort_on_exception'><a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">abort_on_exception</a></span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>200</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Gotcha</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby">prog.rb:3: Gotcha (RuntimeError)
 from prog.rb:2:in `initialize&#39;
 from prog.rb:2:in `new&#39;
 from prog.rb:2</code></pre>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2244-L2258'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2244
2245
2246
2247
2248
2249
2250
2251
2252
2253
2254
2255
2256
2257
2258</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2244</span></pre>
<pre class='code cpp'>

static VALUE
thread_raise_m(int argc, VALUE *argv, VALUE self)
{
    rb_thread_t *target_th;
    rb_thread_t *th = GET_THREAD();
    GetThreadPtr(self, target_th);
    threadptr_check_pending_interrupt_queue(target_th);
    rb_threadptr_raise(target_th, argc, argv);

    /* To perform Thread.current.raise as Kernel.raise */
    if (th == target_th) {
	RUBY_VM_CHECK_INTS(th);
    }
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run-instance_method">
  <h3 class='signature '>
    #<strong>run</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wakes up <code>thr</code>, making it eligible for scheduling.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span><span class='semicolon'>;</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.1</span> <span class='kw'>while</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sleep</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Got here</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span>
<span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span>
<span class='const'>Got</span> <span class='id identifier rubyid_here'>here</span>
<span class='id identifier rubyid_c'>c</span></code></pre>

<p>See also the instance method <a href="#wakeup-instance_method" title="Thread#wakeup (method)">#wakeup</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2418-L2424'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2418
2419
2420
2421
2422
2423
2424</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2418</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_run(VALUE thread)
{
    rb_thread_wakeup(thread);
    rb_thread_schedule();
    return thread;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="safe_level-instance_method">
  <h3 class='signature '>
    #<strong>safe_level</strong>  &#x21d2; <a href="Integer.html" title="Integer (class)">Integer</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the safe level in effect for <em>thr</em>. Setting thread-local
safe levels can help when implementing sandboxes which run insecure code.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='gvar'>$SAFE</span> <span class='op'>=</span> <span class='int'>1</span><span class='semicolon'>;</span> <span class='id identifier rubyid_sleep'>sleep</span> <span class='rbrace'>}</span>
<span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_safe_level'>safe_level</span>   <span class='comment'>#=&gt; 0
</span><span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_safe_level'>safe_level</span>              <span class='comment'>#=&gt; 1</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2922-L2929'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2922
2923
2924
2925
2926
2927
2928
2929</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2922</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_safe_level(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);

    return INT2NUM(th-&gt;safe_level);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_trace_func-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>set_trace_func</strong>(proc)  &#x21d2; <a href="Proc.html" title="Proc (class)">Proc</a> </span>
      <span class='overload'>#<strong>set_trace_func</strong>(nil)  &#x21d2; <code>nil</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Establishes <em>proc</em> on <em>thr</em> as the handler for tracing, or
disables tracing if the parameter is <code>nil</code>.</p>

<p>See <a href="Kernel.html#set_trace_func-class_method" title="Kernel.set_trace_func (method)">Kernel.set_trace_func</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/vm_trace.c#L547-L561'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


547
548
549
550
551
552
553
554
555
556
557
558
559
560
561</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'vm_trace.c', line 547</span></pre>
<pre class='code cpp'>

static VALUE
thread_set_trace_func_m(VALUE obj, VALUE trace)
{
    rb_thread_t *th;

    GetThreadPtr(obj, th);
    rb_threadptr_remove_event_hook(th, call_trace_func, Qundef);

    if (NIL_P(trace)) {
	return Qnil;
    }

    thread_add_trace_func(th, trace);
    return trace;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="status-instance_method">
  <h3 class='signature '>
    #<strong>status</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a>, ...   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of <code>thr</code>.</p>
<dl class="rdoc-list label-list"><dt><code>&quot;sleep&quot;</code>
<dd>
<p>Returned if this thread is sleeping or waiting on I/O</p>
</dd><dt><code>&quot;run&quot;</code>
<dd>
<p>When this thread is executing</p>
</dd><dt><code>&quot;aborting&quot;</code>
<dd>
<p>If this thread is aborting</p>
</dd><dt><code>false</code>
<dd>
<p>When this thread is terminated normally</p>
</dd><dt><code>nil</code>
<dd>
<p>If terminated with an exception.</p>
</dd></dl>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>die now</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_exit'><a href="#exit-class_method" title="Thread.exit (method)">exit</a></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_sleep'>sleep</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span>                  <span class='comment'>#=&gt; #&lt;Thread:0x401b3678 aborting&gt;
</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span>                <span class='comment'>#=&gt; nil
</span><span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span>                <span class='comment'>#=&gt; &quot;sleep&quot;
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span>                <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span>                <span class='comment'>#=&gt; &quot;aborting&quot;
</span><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span>   <span class='comment'>#=&gt; &quot;run&quot;</span></code></pre>

<p>See also the instance methods <a href="#alive%3F-instance_method" title="Thread#alive? (method)">#alive?</a> and <a href="#stop%3F-instance_method" title="Thread#stop? (method)">#stop?</a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2841-L2855'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2841
2842
2843
2844
2845
2846
2847
2848
2849
2850
2851
2852
2853
2854
2855</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2841</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_status(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);

    if (rb_threadptr_dead(th)) {
	if (!NIL_P(th-&gt;errinfo) &amp;&amp; !FIXNUM_P(th-&gt;errinfo)
	    /* TODO */ ) {
	    return Qnil;
	}
	return Qfalse;
    }
    return rb_str_new2(thread_status_name(th, FALSE));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="terminate-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>exit</strong>  &#x21d2; <code>Thread</code><sup>?</sup> </span>
      <span class='overload'>#<strong>kill</strong>  &#x21d2; <code>Thread</code><sup>?</sup> </span>
      <span class='overload'>#<strong>terminate</strong>  &#x21d2; <code>Thread</code><sup>?</sup> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L4849-L4849'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


4849</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 4849</span></pre>
<pre class='code cpp'>

rb_define_method(rb_cThread, &quot;terminate&quot;, rb_thread_kill, 0);
</pre>
  </div>
</div>
</section>

<section class='method_details' id="thread_variable?-instance_method">
  <h3 class='signature '>
    #<strong>thread_variable?</strong>(key)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if the given string (or symbol) exists as a thread-local
variable.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_me'>me</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>
<span class='id identifier rubyid_me'>me</span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_set'>thread_variable_set</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_oliver'>oliver</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_me'>me</span><span class='period'>.</span><span class='id identifier rubyid_thread_variable?'>thread_variable?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_oliver'>oliver</span><span class='rparen'>)</span>    <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_me'>me</span><span class='period'>.</span><span class='id identifier rubyid_thread_variable?'>thread_variable?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_stanley'>stanley</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; false</span></code></pre>

<p>Note that these are not fiber local variables.  Please see <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> and
<a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> for more details.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3384-L3402'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3384
3385
3386
3387
3388
3389
3390
3391
3392
3393
3394
3395
3396
3397
3398
3399
3400
3401
3402</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3384</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_variable_p(VALUE thread, VALUE key)
{
    VALUE locals;
    ID id = rb_check_id(&amp;key);

    if (!id) return Qfalse;

    locals = rb_ivar_get(thread, id_locals);

    if (!RHASH(locals)-&gt;ntbl)
        return Qfalse;

    if (st_lookup(RHASH(locals)-&gt;ntbl, ID2SYM(id), 0)) {
	return Qtrue;
    }

    return Qfalse;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="thread_variable_get-instance_method">
  <h3 class='signature '>
    #<strong>thread_variable_get</strong>(key)  &#x21d2; <a href="Object.html" title="Object (class)">Object</a><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the value of a thread local variable that has been set.  Note that
these are different than fiber local values.  For fiber local values,
please see <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> and <a href="#[]=-instance_method" title="Thread#[]= (method)">#[]=</a>.</p>

<p><code>Thread</code> local values are carried along with threads, and do not
respect fibers.  For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># set a thread local
</span>  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>                    <span class='comment'># set a fiber local
</span>
  <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Fiber.html#new-class_method" title="Fiber.new (method)">new</a></span> <span class='lbrace'>{</span>
    <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span><span class='period'>.</span><span class='id identifier rubyid_yield'><a href="Fiber.html#yield-class_method" title="Fiber.yield (method)">yield</a></span> <span class='lbracket'>[</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_get'>thread_variable_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='comment'># get the thread local
</span>      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>                     <span class='comment'># get the fiber local
</span>    <span class='rbracket'>]</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_resume'>resume</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span> <span class='comment'># =&gt; [&#39;bar&#39;, nil]</span></code></pre>

<p>The value "bar" is returned for the thread local, where nil is returned for
the fiber local.  The fiber is executed in the same thread, so the thread
local values are available.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3230-L3237'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3230
3231
3232
3233
3234
3235
3236
3237</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3230</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_variable_get(VALUE thread, VALUE key)
{
    VALUE locals;

    locals = rb_ivar_get(thread, id_locals);
    return rb_hash_aref(locals, rb_to_symbol(key));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="thread_variable_set-instance_method">
  <h3 class='signature '>
    #<strong>thread_variable_set</strong>(key, value)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets a thread local with <code>key</code> to <a href="#value-instance_method" title="Thread#value (method)">#value</a>.  Note that these are local to
threads, and not to fibers.  Please see <a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> and
<a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> for more information.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3248-L3259'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3248
3249
3250
3251
3252
3253
3254
3255
3256
3257
3258
3259</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3248</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_variable_set(VALUE thread, VALUE id, VALUE val)
{
    VALUE locals;

    if (OBJ_FROZEN(thread)) {
	rb_error_frozen(&quot;thread locals&quot;);
    }

    locals = rb_ivar_get(thread, id_locals);
    return rb_hash_aset(locals, rb_to_symbol(id), val);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="thread_variables-instance_method">
  <h3 class='signature '>
    #<strong>thread_variables</strong>  &#x21d2; <a href="Array.html" title="Array (class)">Array</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an array of the names of the thread-local variables (as Symbols).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_cat'>cat</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>meow</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span><span class='period'>.</span><span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dog</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>woof</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>               <span class='comment'>#=&gt; #&lt;Thread:0x401b3f10 dead&gt;
</span><span class='id identifier rubyid_thr'>thr</span><span class='period'>.</span><span class='id identifier rubyid_thread_variables'>thread_variables</span>   <span class='comment'>#=&gt; [:dog, :cat]</span></code></pre>

<p>Note that these are not fiber local variables.  Please see <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> and
<a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> for more details.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L3355-L3366'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


3355
3356
3357
3358
3359
3360
3361
3362
3363
3364
3365
3366</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3355</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_variables(VALUE thread)
{
    VALUE locals;
    VALUE ary;

    locals = rb_ivar_get(thread, id_locals);
    ary = rb_ary_new();
    rb_hash_foreach(locals, keys_i, ary);

    return ary;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="value-instance_method">
  <h3 class='signature '>
    #<strong>value</strong>  &#x21d2; <a href="Object.html" title="Object (class)">Object</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Waits for <code>thr</code> to complete, using <a href="#join-instance_method" title="Thread#join (method)">#join</a>, and returns its value or raises
the exception which terminated the thread.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='int'>2</span> <span class='op'>+</span> <span class='int'>2</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>   <span class='comment'>#=&gt; 4
</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>something went wrong</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>   <span class='comment'>#=&gt; RuntimeError: something went wrong</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L1009-L1016'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1009
1010
1011
1012
1013
1014
1015
1016</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 1009</span></pre>
<pre class='code cpp'>

static VALUE
thread_value(VALUE self)
{
    rb_thread_t *th;
    GetThreadPtr(self, th);
    thread_join(th, DELAY_INFTY);
    return th-&gt;value;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="wakeup-instance_method">
  <h3 class='signature '>
    #<strong>wakeup</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Marks a given thread as eligible for scheduling, however it may still
remain blocked on I/O.</p>

<p><strong>Note:</strong> This does not invoke the scheduler, see <a href="#run-instance_method" title="Thread#run (method)">#run</a> for
more information.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='lbrace'>{</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span><span class='semicolon'>;</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hey!</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.1</span> <span class='kw'>while</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sleep</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_wakeup'>wakeup</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
<span class='comment'>#=&gt; &quot;hey!&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/thread.c#L2372-L2379'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


2372
2373
2374
2375
2376
2377
2378
2379</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2372</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_wakeup(VALUE thread)
{
    if (!RTEST(rb_thread_wakeup_alive(thread))) {
	rb_raise(rb_eThreadError, &quot;killed thread&quot;);
    }
    return thread;
}
</pre>
  </div>
</div>
</section>


<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.8 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.5.0p-1)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>