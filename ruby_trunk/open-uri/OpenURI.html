<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: OpenURI &mdash; open-uri  Ruby-2.5.0 dev</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "OpenURI",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
        <a href='../../index.html'>Home</a> &raquo; 
        <a href='../index.html'>Ruby-2.5.0</a> &raquo; 
        <a href='index.html'>open-uri</a> &raquo; 
        <a href='_index.html#alpha_O'>Index (O)</a> &raquo; 
        <span class='title'><a id='t2_doc_top' href='#'>OpenURI&nbsp;&#x25B2;</a></span>
      </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: OpenURI</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="OpenURI/Meta.html" title="OpenURI::Meta (module)">Meta</a>,
        <a href="OpenURI/OpenRead.html" title="OpenURI::OpenRead (module)">OpenRead</a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a class='nodoc' href="OpenURI/Buffer.html" title="OpenURI::Buffer (class)">Buffer</a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="OpenURI/HTTPError.html" title="OpenURI::HTTPError (class)">HTTPError</a>,
        <a href="OpenURI/HTTPRedirect.html" title="OpenURI::HTTPRedirect (class)">HTTPRedirect</a>      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/trunk/lib/open-uri.rb#L98'>lib/open-uri.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>OpenURI</code> is an easy-to-use wrapper for <code>Net::HTTP</code>,
<code>Net::HTTPS</code> and <code>Net::FTP</code>.</p>

<h3 id="label-Example">Example</h3>

<p>It is possible to open an http, https or ftp URL as though it were a file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_each_line'>each_line</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_line'>line</span><span class='rbrace'>}</span>
<span class='rbrace'>}</span></code></pre>

<p>The opened file has several getter methods for its meta-information, as
follows, since it is extended by <a href="OpenURI/Meta.html" title="OpenURI::Meta (module)">Meta</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/en</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_each_line'>each_line</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_line'>line</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span>         <span class='comment'># &lt;URI::HTTP:0x40e6ef2 URL:http://www.ruby-lang.org/en/&gt;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_content_type'>content_type</span>     <span class='comment'># &quot;text/html&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_charset'>charset</span>          <span class='comment'># &quot;iso-8859-1&quot;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_content_encoding'>content_encoding</span> <span class='comment'># []
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_last_modified'>last_modified</span>    <span class='comment'># Thu Dec 05 02:45:02 UTC 2002
</span><span class='rbrace'>}</span></code></pre>

<p>Additional header fields can be specified by an optional hash argument.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/en/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User-Agent</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby/</span><span class='embexpr_beg'>#{</span><span class='const'>RUBY_VERSION</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>From</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo@bar.invalid</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Referer</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='comment'># ...
</span><span class='rbrace'>}</span></code></pre>

<p>The environment variables such as http_proxy, https_proxy and ftp_proxy are
in effect by default. Here we disable proxy:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/en/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='comment'># ...
</span><span class='rbrace'>}</span></code></pre>

<p>See <code>OpenURI::OpenRead.open</code> and <a href="Kernel.html#open-class_method" title="Kernel.open (method)">Kernel.open</a> for more on available
options.</p>

<p><a href="URI.html" title="URI (module)">::URI</a> objects can be opened in a similar way.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://www.ruby-lang.org/en/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='comment'># ...
</span><span class='rbrace'>}</span></code></pre>

<p><a href="URI.html" title="URI (module)">::URI</a> objects can be read directly. The returned string is also extended by
<a href="OpenURI/Meta.html" title="OpenURI::Meta (module)">Meta</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span></code></pre>
<dl class="rdoc-list note-list"><dt>Author
<dd>
<p>Tanaka Akira &lt;akr@m17n.org&gt;</p>
</dd></dl>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='Options-constant' class='summary_signature'>Options =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/trunk/lib/open-uri.rb#L99-L111'># File 'lib/open-uri.rb', line 99</a>    <pre class='code ruby'><span class='lbrace'>{</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_proxy_http_basic_authentication'>proxy_http_basic_authentication</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_progress_proc'>progress_proc</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_content_length_proc'>content_length_proc</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_http_basic_authentication'>http_basic_authentication</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_read_timeout'>read_timeout</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_open_timeout'>open_timeout</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert'>ssl_ca_cert</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_mode'>ssl_verify_mode</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ftp_active_mode'>ftp_active_mode</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_redirect'>redirect</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
<span class='rbrace'>}</span></pre>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_options-class_method" title=".check_options (class method)">.<strong>check_options</strong>(options)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#open_http-class_method" title=".open_http (class method)">.<strong>open_http</strong>(buf, target, proxy, options)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#open_loop-class_method" title=".open_loop (class method)">.<strong>open_loop</strong>(uri, options)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#open_uri-class_method" title=".open_uri (class method)">.<strong>open_uri</strong>(name, *rest)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#redirectable%3F-class_method" title=".redirectable? (class method)">.<strong>redirectable?</strong>(uri1, uri2)  &#x21d2; Boolean </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#scan_open_optional_arguments-class_method" title=".scan_open_optional_arguments (class method)">.<strong>scan_open_optional_arguments</strong>(*rest)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="check_options-class_method">
  <h3 class='signature nodoc first'>
    .<strong>check_options</strong>(options)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/lib/open-uri.rb#L113-L120'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


113
114
115
116
117
118
119
120</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open-uri.rb', line 113</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='const'>OpenURI</span><span class='period'>.</span><span class='id identifier rubyid_check_options'>check_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='const'>Symbol</span> <span class='op'>===</span> <span class='id identifier rubyid_k'>k</span>
    <span class='kw'>unless</span> <span class='const'><a href="#Options-constant" title="OpenURI::Options (constant)">Options</a></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_k'>k</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unrecognized option: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="open_http-class_method">
  <h3 class='signature nodoc'>
    .<strong>open_http</strong>(buf, target, proxy, options)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/lib/open-uri.rb#L255-L365'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open-uri.rb', line 255</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='const'>OpenURI</span><span class='period'>.</span><span class='id identifier rubyid_open_http'>open_http</span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy'>proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_proxy'>proxy</span>
    <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy'>proxy</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Non-HTTP proxy URI: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>!=</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='op'>::</span><span class='const'><a href="URI/HTTP.html" title="URI::HTTP (class)">HTTP</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_userinfo'>userinfo</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>userinfo not supported.  [RFC3986]</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_header'>header</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_header'>header</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span> <span class='kw'>if</span> <span class='const'>String</span> <span class='op'>===</span> <span class='id identifier rubyid_k'>k</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>net/http</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTP</span>
  <span class='kw'>if</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='op'>::</span><span class='const'><a href="URI/HTTP.html" title="URI::HTTP (class)">HTTP</a></span> <span class='op'>===</span> <span class='id identifier rubyid_target'>target</span>
    <span class='comment'># HTTP or HTTPS
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_proxy'>proxy</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span>
        <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_userinfo'>userinfo</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>:</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_userinfo'>userinfo</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span>
        <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTP</span><span class='op'>::</span><span class='const'>Proxy</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTP</span><span class='op'>::</span><span class='const'>Proxy</span><span class='lparen'>(</span><span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_target_host'>target_host</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span>
    <span class='id identifier rubyid_target_port'>target_port</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span>
    <span class='id identifier rubyid_request_uri'>request_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_request_uri'>request_uri</span>
  <span class='kw'>else</span>
    <span class='comment'># FTP over HTTP proxy
</span>    <span class='id identifier rubyid_target_host'>target_host</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span>
    <span class='id identifier rubyid_target_port'>target_port</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_uri'>proxy_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span>
    <span class='id identifier rubyid_request_uri'>request_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span>
      <span class='id identifier rubyid_header'>header</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Proxy-Authorization</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span>
                      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Basic </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>m0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_http'>http</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>?</span> <span class='id identifier rubyid_klass'>klass</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_target_host'>target_host</span><span class='comma'>,</span> <span class='id identifier rubyid_target_port'>target_port</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_klass'>klass</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_target_host'>target_host</span><span class='comma'>,</span> <span class='id identifier rubyid_target_port'>target_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>==</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='op'>::</span><span class='const'>HTTPS</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>net/https</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_use_ssl'>use_ssl</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_verify_mode'>verify_mode</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_mode'>ssl_verify_mode</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_PEER</span>
    <span class='id identifier rubyid_store'>store</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Store</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert'>ssl_ca_cert</span><span class='rbracket'>]</span>
      <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert'>ssl_ca_cert</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cert'>cert</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span> <span class='id identifier rubyid_cert'>cert</span>
          <span class='id identifier rubyid_store'>store</span><span class='period'>.</span><span class='id identifier rubyid_add_path'>add_path</span> <span class='id identifier rubyid_cert'>cert</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_store'>store</span><span class='period'>.</span><span class='id identifier rubyid_add_file'>add_file</span> <span class='id identifier rubyid_cert'>cert</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_store'>store</span><span class='period'>.</span><span class='id identifier rubyid_set_default_paths'>set_default_paths</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_cert_store'>cert_store</span> <span class='op'>=</span> <span class='id identifier rubyid_store'>store</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_read_timeout'>read_timeout</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_read_timeout'>read_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_read_timeout'>read_timeout</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_open_timeout'>open_timeout</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_open_timeout'>open_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_open_timeout'>open_timeout</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_resp'>resp</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTP</span><span class='op'>::</span><span class='const'>Get</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_request_uri'>request_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_header'>header</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_http_basic_authentication'>http_basic_authentication</span>
      <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_pass'>pass</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_http_basic_authentication'>http_basic_authentication</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_basic_auth'>basic_auth</span> <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_pass'>pass</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_http'>http</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span><span class='lparen'>(</span><span class='id identifier rubyid_req'>req</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
      <span class='id identifier rubyid_resp'>resp</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_content_length_proc'>content_length_proc</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPSuccess</span> <span class='op'>===</span> <span class='id identifier rubyid_resp'>resp</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Length</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_content_length_proc'>content_length_proc</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_resp'>resp</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Length</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_content_length_proc'>content_length_proc</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_read_body'>read_body</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_str'>str</span><span class='op'>|</span>
        <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_str'>str</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_progress_proc'>progress_proc</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPSuccess</span> <span class='op'>===</span> <span class='id identifier rubyid_resp'>resp</span>
          <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_progress_proc'>progress_proc</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span>
  <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_rewind'>rewind</span>
  <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span><span class='comma'>,</span> <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_each_name'>each_name</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_meta_add_field2'>meta_add_field2</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_resp'>resp</span><span class='period'>.</span><span class='id identifier rubyid_get_fields'>get_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_resp'>resp</span>
  <span class='kw'>when</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPSuccess</span>
  <span class='kw'>when</span> <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPMovedPermanently</span><span class='comma'>,</span> <span class='comment'># 301
</span>       <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPFound</span><span class='comma'>,</span> <span class='comment'># 302
</span>       <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPSeeOther</span><span class='comma'>,</span> <span class='comment'># 303
</span>       <span class='const'>Net</span><span class='op'>::</span><span class='const'>HTTPTemporaryRedirect</span> <span class='comment'># 307
</span>    <span class='kw'>begin</span>
      <span class='id identifier rubyid_loc_uri'>loc_uri</span> <span class='op'>=</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_resp'>resp</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>location</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='op'>::</span><span class='const'>InvalidURIError</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenURI</span><span class='op'>::</span><span class='const'><a href="OpenURI/HTTPError.html" title="OpenURI::HTTPError (class)">HTTPError</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="OpenURI/HTTPError.html#new-class_method" title="OpenURI::HTTPError.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> (Invalid Location URI)</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_throw'>throw</span> <span class='symbeg'>:</span><span class='id identifier rubyid_open_uri_redirect'>open_uri_redirect</span><span class='comma'>,</span> <span class='id identifier rubyid_loc_uri'>loc_uri</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>OpenURI</span><span class='op'>::</span><span class='const'><a href="OpenURI/HTTPError.html" title="OpenURI::HTTPError (class)">HTTPError</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="OpenURI/HTTPError.html#new-class_method" title="OpenURI::HTTPError.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="open_loop-class_method">
  <h3 class='signature nodoc'>
    .<strong>open_loop</strong>(uri, options)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/lib/open-uri.rb#L168-L242'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open-uri.rb', line 168</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='const'>OpenURI</span><span class='period'>.</span><span class='id identifier rubyid_open_loop'>open_loop</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_proxy_opts'>proxy_opts</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_proxy_opts'>proxy_opts</span> <span class='op'>&lt;&lt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_proxy_http_basic_authentication'>proxy_http_basic_authentication</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_proxy_http_basic_authentication'>proxy_http_basic_authentication</span>
  <span class='id identifier rubyid_proxy_opts'>proxy_opts</span> <span class='op'>&lt;&lt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_proxy'>proxy</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_proxy'>proxy</span>
  <span class='id identifier rubyid_proxy_opts'>proxy_opts</span><span class='period'>.</span><span class='id identifier rubyid_compact!'>compact!</span>
  <span class='kw'>if</span> <span class='int'>1</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_proxy_opts'>proxy_opts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>multiple proxy options specified</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_proxy_opts'>proxy_opts</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_proxy_http_basic_authentication'>proxy_http_basic_authentication</span>
    <span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_proxy_http_basic_authentication'>proxy_http_basic_authentication</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='period'>.</span><span class='id identifier rubyid_to_str'>to_str</span>
    <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='period'>.</span><span class='id identifier rubyid_to_str'>to_str</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_opt_proxy'>opt_proxy</span> <span class='op'>==</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid authenticated proxy option: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_proxy_http_basic_authentication'>proxy_http_basic_authentication</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_proxy'>proxy</span>
    <span class='id identifier rubyid_opt_proxy'>opt_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_proxy'>proxy</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>when</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_opt_proxy'>opt_proxy</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_proxy_user'>proxy_user</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_proxy_pass'>proxy_pass</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_opt_proxy'>opt_proxy</span>
  <span class='kw'>when</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_find_proxy'>find_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='id identifier rubyid_pxy'>pxy</span> <span class='op'>=</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_find_proxy'>find_proxy</span><span class='semicolon'>;</span> <span class='id identifier rubyid_pxy'>pxy</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='id identifier rubyid_pxy'>pxy</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>nil</span><span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_find_proxy'>find_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='kw'>nil</span><span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'>String</span>
    <span class='id identifier rubyid_opt_proxy'>opt_proxy</span> <span class='op'>=</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_find_proxy'>find_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='op'>::</span><span class='const'>Generic</span>
    <span class='id identifier rubyid_find_proxy'>find_proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_user'>proxy_user</span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_pass'>proxy_pass</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid proxy option: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opt_proxy'>opt_proxy</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_uri_set'>uri_set</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='op'>=</span> <span class='id identifier rubyid_catch'>catch</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_open_uri_redirect'>open_uri_redirect</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='const'><a href="OpenURI/Buffer.html" title="OpenURI::Buffer (class)">Buffer</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="OpenURI/Buffer.html#new-class_method" title="OpenURI::Buffer.new (method)">new</a></span>
      <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_buffer_open'>buffer_open</span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='id identifier rubyid_find_proxy'>find_proxy</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
      <span class='kw'>nil</span>
    <span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_redirect'>redirect</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_redirect'>redirect</span><span class='period'>.</span><span class='id identifier rubyid_relative?'>relative?</span>
        <span class='comment'># Although it violates RFC2616, Location: field may have relative
</span>        <span class='comment'># URI.  It is converted to absolute URI using uri as a base URI.
</span>        <span class='id identifier rubyid_redirect'>redirect</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span> <span class='op'>+</span> <span class='id identifier rubyid_redirect'>redirect</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_redirect'>redirect</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="OpenURI/HTTPRedirect.html" title="OpenURI::HTTPRedirect (class)">HTTPRedirect</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="OpenURI/HTTPRedirect.html#new-class_method" title="OpenURI::HTTPRedirect.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_redirect'>redirect</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>unless</span> <span class='const'>OpenURI</span><span class='period'>.</span><span class='id identifier rubyid_redirectable?'><a href="#redirectable%3F-class_method" title="OpenURI.redirectable? (method)">redirectable?</a></span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_redirect'>redirect</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redirection forbidden: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='embexpr_end'>}</span><span class='tstring_content'> -&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_redirect'>redirect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_http_basic_authentication'>http_basic_authentication</span>
        <span class='comment'># send authentication only for the URI directly specified.
</span>        <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
        <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='symbeg'>:</span><span class='id identifier rubyid_http_basic_authentication'>http_basic_authentication</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='id identifier rubyid_redirect'>redirect</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP redirection loop: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_uri_set'>uri_set</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='id identifier rubyid_uri_set'>uri_set</span><span class='lbracket'>[</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>else</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_io'>io</span>
  <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span>
  <span class='id identifier rubyid_io'>io</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="open_uri-class_method">
  <h3 class='signature nodoc'>
    .<strong>open_uri</strong>(name, *rest)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/lib/open-uri.rb#L132-L166'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open-uri.rb', line 132</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='const'>OpenURI</span><span class='period'>.</span><span class='id identifier rubyid_open_uri'>open_uri</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='op'>::</span><span class='const'>Generic</span> <span class='op'>===</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>?</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>:</span> <span class='const'><a href="URI.html" title="URI (module)">URI</a></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='const'>OpenURI</span><span class='period'>.</span><span class='id identifier rubyid_scan_open_optional_arguments'><a href="#scan_open_optional_arguments-class_method" title="OpenURI.scan_open_optional_arguments (method)">scan_open_optional_arguments</a></span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extra arguments</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='const'>OpenURI</span><span class='period'>.</span><span class='id identifier rubyid_check_options'><a href="#check_options-class_method" title="OpenURI.check_options (method)">check_options</a></span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Arb?(?:\Z|:([^:]+))</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_mode'>mode</span>
    <span class='id identifier rubyid_encoding'>encoding</span><span class='comma'>,</span> <span class='op'>=</span> <span class='backref'>$1</span><span class='comma'>,</span><span class='const'>Encoding</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='backref'>$1</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='backref'>$1</span>
    <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span>
         <span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>r</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span>
         <span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='const'>File</span><span class='op'>::</span><span class='const'>RDONLY</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid access mode </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mode'>mode</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> resource is read only.)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_open_loop'>open_loop</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_set_encoding'>set_encoding</span><span class='lparen'>(</span><span class='id identifier rubyid_encoding'>encoding</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_encoding'>encoding</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_io'>io</span>
    <span class='kw'>ensure</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_close!'>close!</span>
        <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_close!'>close!</span> <span class='comment'># Tempfile
</span>      <span class='kw'>else</span>
        <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_io'>io</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="redirectable?-class_method">
  <h3 class='signature nodoc'>
    .<strong>redirectable?</strong>(uri1, uri2)  &#x21d2; <code>Boolean</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/lib/open-uri.rb#L244-L253'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


244
245
246
247
248
249
250
251
252
253</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open-uri.rb', line 244</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='const'>OpenURI</span><span class='period'>.</span><span class='id identifier rubyid_redirectable?'>redirectable?</span><span class='lparen'>(</span><span class='id identifier rubyid_uri1'>uri1</span><span class='comma'>,</span> <span class='id identifier rubyid_uri2'>uri2</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='comment'># This test is intended to forbid a redirection from http://... to
</span>  <span class='comment'># file:///etc/passwd, file:///dev/zero, etc.  CVE-2011-1521
</span>  <span class='comment'># https to http redirect is also forbidden intentionally.
</span>  <span class='comment'># It avoids sending secure cookie or referer by non-secure HTTP protocol.
</span>  <span class='comment'># (RFC 2109 4.3.1, RFC 2965 3.3, RFC 2616 15.1.3)
</span>  <span class='comment'># However this is ad hoc.  It should be extensible/configurable.
</span>  <span class='id identifier rubyid_uri1'>uri1</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='id identifier rubyid_uri2'>uri2</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>||</span>
  <span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(?:http|ftp)\z</span><span class='regexp_end'>/i</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_uri1'>uri1</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span> <span class='op'>&amp;&amp;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(?:https?|ftp)\z</span><span class='regexp_end'>/i</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_uri2'>uri2</span><span class='period'>.</span><span class='id identifier rubyid_scheme'>scheme</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="scan_open_optional_arguments-class_method">
  <h3 class='signature nodoc'>
    .<strong>scan_open_optional_arguments</strong>(*rest)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/lib/open-uri.rb#L122-L130'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


122
123
124
125
126
127
128
129
130</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open-uri.rb', line 122</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='const'>OpenURI</span><span class='period'>.</span><span class='id identifier rubyid_scan_open_optional_arguments'>scan_open_optional_arguments</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>String</span> <span class='op'>===</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>||</span> <span class='const'>Integer</span> <span class='op'>===</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='const'>Integer</span> <span class='op'>===</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='id identifier rubyid_perm'>perm</span> <span class='op'>=</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_shift'>shift</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span> <span class='id identifier rubyid_perm'>perm</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.8 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.5.0p-1)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>