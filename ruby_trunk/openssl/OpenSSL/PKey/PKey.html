<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: OpenSSL::PKey::PKey &mdash; openssl</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "OpenSSL::PKey::PKey",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
        <a href='../../../../index.html'>Home</a> &raquo; 
        <a href='../../../index.html'>Ruby-2.5.0</a> &raquo; 
        <a href='../../index.html'>openssl</a> &raquo; 
        <a href='../../_index.html#alpha_P'>Index (P)</a> &raquo; 
        <a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a> &raquo; 
        <a href="../PKey.html" title="OpenSSL::PKey (module)">PKey</a> &raquo; 
        <span class='title'><a id='t2_doc_top' href='#'>PKey&nbsp;&#x25B2;</a></span>
      </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: OpenSSL::PKey::PKey</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a href="DH.html" title="OpenSSL::PKey::DH (class)">DH</a>, <a href="DSA.html" title="OpenSSL::PKey::DSA (class)">DSA</a>, <a href="EC.html" title="OpenSSL::PKey::EC (class)">EC</a>, <a href="RSA.html" title="OpenSSL::PKey::RSA (class)">RSA</a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dh.c#L580'>ext/openssl/ossl_pkey_dh.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey.c#L464'>ext/openssl/ossl_pkey.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_dsa.c#L613'>ext/openssl/ossl_pkey_dsa.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_ec.c#L1681'>ext/openssl/ossl_pkey_ec.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey_rsa.c#L694'>ext/openssl/ossl_pkey_rsa.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>An abstract class that bundles signature creation (PKey#sign) and
validation (PKey#verify) that is common to all implementations except
<a href="DH.html" title="OpenSSL::PKey::DH (class)">DH</a></p>
<ul><li>
<p><a href="RSA.html" title="OpenSSL::PKey::RSA (class)">RSA</a></p>
</li><li>
<p><a href="DSA.html" title="OpenSSL::PKey::DSA (class)">DSA</a></p>
</li><li>
<p><a href="EC.html" title="OpenSSL::PKey::EC (class)">EC</a></p>
</li></ul>

  </div>
</div>
</div>        

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="PKeyClass.new (class method)"><strong>PKeyClass.new</strong>  &#x21d2; self </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Because PKey is an abstract class, actually calling this method explicitly
will raise a <code>NotImplementedError</code>.</p></div>
    </div>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#sign-instance_method" title="#sign (instance method)">#<strong>sign</strong>(digest, data)  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>To sign the <code>String</code> <code>data</code>, <code>digest</code>, an instance of <a href="../Digest.html" title="OpenSSL::Digest (class)">::OpenSSL::Digest</a>,
must be provided.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#verify-instance_method" title="#verify (instance method)">#<strong>verify</strong>(digest, signature, data)  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>To verify the <code>String</code> <code>signature</code>, <code>digest</code>, an instance of
<a href="../Digest.html" title="OpenSSL::Digest (class)">::OpenSSL::Digest</a>, must be provided to re-compute the message digest of the
original <code>data</code>, also a <code>String</code>.</p></div>
    </div>
  </li>
</ul>
</div>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    <strong>PKeyClass.new</strong>  &#x21d2; <code>self</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Because PKey is an abstract class, actually calling this method explicitly
will raise a <code>NotImplementedError</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey.c#L264-L271'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


264
265
266
267
268
269
270
271</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey.c', line 264</span></pre>
<pre class='code cpp'>

static VALUE
ossl_pkey_initialize(VALUE self)
{
    if (rb_obj_is_instance_of(self, cPKey)) {
	ossl_raise(rb_eTypeError, &quot;OpenSSL::PKey::PKey can&#39;t be instantiated directly&quot;);
    }
    return self;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="sign-instance_method">
  <h3 class='signature  first'>
    #<strong>sign</strong>(digest, data)  &#x21d2; <code>String</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>To sign the <code>String</code> <code>data</code>, <code>digest</code>, an instance of <a href="../Digest.html" title="OpenSSL::Digest (class)">::OpenSSL::Digest</a>,
must be provided. The return value is again a <code>String</code> containing the
signature. A PKeyError is raised should errors occur. Any previous state of
the <a href="../Digest.html" title="OpenSSL::Digest (class)">::OpenSSL::Digest</a> instance is irrelevant to the signature outcome, the digest
instance is reset to its initial state during the operation.</p>

<h3 id="label-Example">Example</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sign me!</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_digest'>digest</span> <span class='op'>=</span> <span class='const'><a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span><span class='op'>::</span><span class='const'><a href="../Digest.html" title="OpenSSL::Digest (class)">Digest</a></span><span class='op'>::</span><span class='const'>SHA256</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_pkey'>pkey</span> <span class='op'>=</span> <span class='const'><a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span><span class='op'>::</span><span class='const'><a href="../PKey.html" title="OpenSSL::PKey (module)">PKey</a></span><span class='op'>::</span><span class='const'><a href="RSA.html" title="OpenSSL::PKey::RSA (class)">RSA</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="RSA.html#new-class_method" title="OpenSSL::PKey::RSA.new (method)">new</a></span><span class='lparen'>(</span><span class='int'>2048</span><span class='rparen'>)</span>
<span class='id identifier rubyid_signature'>signature</span> <span class='op'>=</span> <span class='id identifier rubyid_pkey'>pkey</span><span class='period'>.</span><span class='id identifier rubyid_sign'>sign</span><span class='lparen'>(</span><span class='id identifier rubyid_digest'>digest</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey.c#L290-L323'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey.c', line 290</span></pre>
<pre class='code cpp'>

static VALUE
ossl_pkey_sign(VALUE self, VALUE digest, VALUE data)
{
    EVP_PKEY *pkey;
    const EVP_MD *md;
    EVP_MD_CTX *ctx;
    unsigned int buf_len;
    VALUE str;
    int result;

    pkey = GetPrivPKeyPtr(self);
    md = GetDigestPtr(digest);
    StringValue(data);
    str = rb_str_new(0, EVP_PKEY_size(pkey));

    ctx = EVP_MD_CTX_new();
    if (!ctx)
	ossl_raise(ePKeyError, &quot;EVP_MD_CTX_new&quot;);
    if (!EVP_SignInit_ex(ctx, md, NULL)) {
	EVP_MD_CTX_free(ctx);
	ossl_raise(ePKeyError, &quot;EVP_SignInit_ex&quot;);
    }
    if (!EVP_SignUpdate(ctx, RSTRING_PTR(data), RSTRING_LEN(data))) {
	EVP_MD_CTX_free(ctx);
	ossl_raise(ePKeyError, &quot;EVP_SignUpdate&quot;);
    }
    result = EVP_SignFinal(ctx, (unsigned char *)RSTRING_PTR(str), &amp;buf_len, pkey);
    EVP_MD_CTX_free(ctx);
    if (!result)
	ossl_raise(ePKeyError, &quot;EVP_SignFinal&quot;);
    rb_str_set_len(str, buf_len);

    return str;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify-instance_method">
  <h3 class='signature '>
    #<strong>verify</strong>(digest, signature, data)  &#x21d2; <code>String</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>To verify the <code>String</code> <code>signature</code>, <code>digest</code>, an instance of
<a href="../Digest.html" title="OpenSSL::Digest (class)">::OpenSSL::Digest</a>, must be provided to re-compute the message digest of the
original <code>data</code>, also a <code>String</code>. The return value is <code>true</code> if the
signature is valid, <code>false</code> otherwise. A PKeyError is raised should errors
occur. Any previous state of the <a href="../Digest.html" title="OpenSSL::Digest (class)">::OpenSSL::Digest</a> instance is irrelevant to the
validation outcome, the digest instance is reset to its initial state
during the operation.</p>

<h3 id="label-Example">Example</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sign me!</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_digest'>digest</span> <span class='op'>=</span> <span class='const'><a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span><span class='op'>::</span><span class='const'><a href="../Digest.html" title="OpenSSL::Digest (class)">Digest</a></span><span class='op'>::</span><span class='const'>SHA256</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_pkey'>pkey</span> <span class='op'>=</span> <span class='const'><a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span><span class='op'>::</span><span class='const'><a href="../PKey.html" title="OpenSSL::PKey (module)">PKey</a></span><span class='op'>::</span><span class='const'><a href="RSA.html" title="OpenSSL::PKey::RSA (class)">RSA</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="RSA.html#new-class_method" title="OpenSSL::PKey::RSA.new (method)">new</a></span><span class='lparen'>(</span><span class='int'>2048</span><span class='rparen'>)</span>
<span class='id identifier rubyid_signature'>signature</span> <span class='op'>=</span> <span class='id identifier rubyid_pkey'>pkey</span><span class='period'>.</span><span class='id identifier rubyid_sign'>sign</span><span class='lparen'>(</span><span class='id identifier rubyid_digest'>digest</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
<span class='id identifier rubyid_pub_key'>pub_key</span> <span class='op'>=</span> <span class='id identifier rubyid_pkey'>pkey</span><span class='period'>.</span><span class='id identifier rubyid_public_key'>public_key</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_pub_key'>pub_key</span><span class='period'>.</span><span class='id identifier rubyid_verify'>verify</span><span class='lparen'>(</span><span class='id identifier rubyid_digest'>digest</span><span class='comma'>,</span> <span class='id identifier rubyid_signature'>signature</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='comment'># =&gt; true</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/trunk/ext/openssl/ossl_pkey.c#L346-L383'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey.c', line 346</span></pre>
<pre class='code cpp'>

static VALUE
ossl_pkey_verify(VALUE self, VALUE digest, VALUE sig, VALUE data)
{
    EVP_PKEY *pkey;
    const EVP_MD *md;
    EVP_MD_CTX *ctx;
    int siglen, result;

    GetPKey(self, pkey);
    pkey_check_public_key(pkey);
    md = GetDigestPtr(digest);
    StringValue(sig);
    siglen = RSTRING_LENINT(sig);
    StringValue(data);

    ctx = EVP_MD_CTX_new();
    if (!ctx)
	ossl_raise(ePKeyError, &quot;EVP_MD_CTX_new&quot;);
    if (!EVP_VerifyInit_ex(ctx, md, NULL)) {
	EVP_MD_CTX_free(ctx);
	ossl_raise(ePKeyError, &quot;EVP_VerifyInit_ex&quot;);
    }
    if (!EVP_VerifyUpdate(ctx, RSTRING_PTR(data), RSTRING_LEN(data))) {
	EVP_MD_CTX_free(ctx);
	ossl_raise(ePKeyError, &quot;EVP_VerifyUpdate&quot;);
    }
    result = EVP_VerifyFinal(ctx, (unsigned char *)RSTRING_PTR(sig), siglen, pkey);
    EVP_MD_CTX_free(ctx);
    switch (result) {
    case 0:
	ossl_clear_error();
	return Qfalse;
    case 1:
	return Qtrue;
    default:
	ossl_raise(ePKeyError, &quot;EVP_VerifyFinal&quot;);
    }
}
</pre>
  </div>
</div>
</section>


<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.8 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.5.0p-1)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>