<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: WEBrick::GenericServer &mdash; webrick  Ruby-2.3.3 p224 2016-11-24</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "WEBrick::GenericServer",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='y_list' class='d h'>
    <header id='list_header'>
      <div id='list_title'>&#160;</div>
      <div id='list_menu'>
        <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
        <span>&#160;</span>
      </div>
      <input  id='list_search_text' type='search' placeholder='List Search' size='12' value='' autocomplete='off' class='search_input'/>
      <svg id='list_search_icon' viewBox='0 0 30 30'>
        <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
        <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
        <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
      </svg>
      <button class='y_minus' title='Collapse All'></button>
      <button class='y_plus' title='Expand All'></button>
    </header>
    <nav id= 'list_nav' class='y_nav l_nav'>
      <ul id='list_items'></ul>
    </nav>
  </div>
  <div id='y_toc' class='f h'>
    <header id='toc_header'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <div>Table of Contents</div>
      <input  id='toc_search_text' type='search' placeholder='Method Search' size='12' value='' autocomplete='off' class='search_input'/>
      <svg id='toc_search_icon' viewBox='0 0 30 30'>
        <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
        <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
        <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
      </svg>
      <button class='y_minus' title='Collapse All'></button>
      <button class='y_plus' title='Expand All' ></button>
    </header>
    <nav id= 'toc_nav' class='y_nav t_nav'>
    <ol id='toc_items'></ol>
    </nav>
  </div>
  <div id='y_main' tabindex='-1'>
    <header id='y_header'>
      <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.3.3</a> &raquo; 
          <a href='../index.html'>webrick</a> &raquo; 
          <a href='../_index.html#alpha_G'>Index (G)</a> &raquo; 
          <a href="../WEBrick.html" title="WEBrick (module)">WEBrick</a> &raquo; 
          <span class='title'><a id='t2_doc_top' href='#'>GenericServer&nbsp;&#x25B2;</a></span>
        </div>

      <div id='y_measure_em' class='y_measure'></div>
      <div id='y_measure_vh' class='y_measure'></div>
      <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
      <a id='list_href' href="../class_list.html"></a>
      <div id='hdr_button'>
        <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
            <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
          </svg><svg class='o' viewBox='0 0 34 28'>
            <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
          </svg></button>
        <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
          <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
        <button id='toc_loc'  class='f' title='TOC Location' >T<svg class='f' viewBox='0 0 36 28'>
          <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
        <button id='list_vis' title='LIST Show / Hide'>LIST</button>
        <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
      </div>
      <div id='y_debug'></div>
    </header>
<div id='content' class='class'>
<h1>Class: WEBrick::GenericServer</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a href="HTTPProxyServer.html" title="WEBrick::HTTPProxyServer (class)">HTTPProxyServer</a>, <a href="HTTPServer.html" title="WEBrick::HTTPServer (class)">HTTPServer</a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/ssl.rb#L138'>lib/webrick/ssl.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L63'>lib/webrick/server.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div><h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Base TCP server class.  You must subclass <code>GenericServer</code> and
provide a <a href="#run-instance_method" title="WEBrick::GenericServer#run (method)">#run</a> method.</p>

  </div>
</div>
</div>        
<h2 class='h2_sum'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(config = {}, default = Config::General)  &#x21d2; GenericServer </a>
    </span>
        <span class='note title constructor'>constructor</span>    <span class='summary_desc'>
      <div class='inline'>
<p>Creates a new generic server from <a href="#config-instance_method" title="WEBrick::GenericServer#config (method)">#config</a>+.</p>
</div>
    </span>
  </li>
</ul>
</div>
        
<h2 class='h2_sum'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#config-instance_method" title="#config (instance method)">#<strong>config</strong>  </a>
    </span>
        <span class='note title readonly'>readonly</span>    <span class='summary_desc'>
      <div class='inline'>
<p>The server configuration</p>
</div>
    </span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#listeners-instance_method" title="#listeners (instance method)">#<strong>listeners</strong>  </a>
    </span>
        <span class='note title readonly'>readonly</span>    <span class='summary_desc'>
      <div class='inline'>
<p>Sockets listening for connections.</p>
</div>
    </span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#logger-instance_method" title="#logger (instance method)">#<strong>logger</strong>  </a>
    </span>
        <span class='note title readonly'>readonly</span>    <span class='summary_desc'>
      <div class='inline'>
<p>The server logger.</p>
</div>
    </span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#status-instance_method" title="#status (instance method)">#<strong>status</strong>  </a>
    </span>
        <span class='note title readonly'>readonly</span>    <span class='summary_desc'>
      <div class='inline'>
<p>The server status.</p>
</div>
    </span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#tokens-instance_method" title="#tokens (instance method)">#<strong>tokens</strong>  </a>
    </span>
        <span class='note title readonly'>readonly</span>    <span class='summary_desc'>
      <div class='inline'>
<p>Tokens control the number of outstanding clients.</p>
</div>
    </span>
  </li>
</ul>
</div>
        
<h2 class='h2_sum'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(key)  </a>
    </span>
        <span class='summary_desc'>
      <div class='inline'>
<p>Retrieves <tt>key</tt>+ from the configuration</p>
</div>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#run-instance_method" title="#run (instance method)">#<strong>run</strong>(sock)  </a>
    </span>
        <span class='summary_desc'>
      <div class='inline'>
<p>You must subclass <code>GenericServer</code> and implement #run which
accepts a TCP client socket</p>
</div>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#shutdown-instance_method" title="#shutdown (instance method)">#<strong>shutdown</strong>  </a>
    </span>
        <span class='summary_desc'>
      <div class='inline'>
<p>Shuts down the server and all listening sockets.</p>
</div>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#start-instance_method" title="#start (instance method)">#<strong>start</strong>(&amp;block)  </a>
    </span>
        <span class='summary_desc'>
      <div class='inline'>
<p>Starts the server and runs the <tt>block</tt>+ for each connection.</p>
</div>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stop-instance_method" title="#stop (instance method)">#<strong>stop</strong>  </a>
    </span>
        <span class='summary_desc'>
      <div class='inline'>
<p>Stops the server from accepting new connections.</p>
</div>
    </span>
  </li>
</ul>
</div>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
  .<strong>new</strong>(config = {}, default = Config::General)  &#x21d2; <tt>GenericServer</tt> 
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a new generic server from <a href="#config-instance_method" title="WEBrick::GenericServer#config (method)">#config</a>+.  The default configuration
comes from <tt>default</tt>+.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L95-L120'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 95</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_config'>config</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_default'>default</span><span class='op'>=</span><span class='const'>Config</span><span class='op'>::</span><span class='const'>General</span><span class='rparen'>)</span>
  <span class='ivar'>@config</span> <span class='op'>=</span> <span class='id identifier rubyid_default'>default</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_config'>config</span><span class='rparen'>)</span>
  <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Stop</span>
  <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Logger</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><a href="Log.html" title="WEBrick::Log (class)">Log</a></span><span class='op'>::</span><span class='id identifier rubyid_new'><a href="Log.html#new-class_method" title="WEBrick::Log.new (method)">new</a></span>
  <span class='ivar'>@logger</span> <span class='op'>=</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Logger</span><span class='rbracket'>]</span>

  <span class='ivar'>@tokens</span> <span class='op'>=</span> <span class='const'>SizedQueue</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>MaxClients</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>MaxClients</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='lbrace'>{</span> <span class='ivar'>@tokens</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_webrickv'>webrickv</span> <span class='op'>=</span> <span class='const'><a href="../WEBrick.html" title="WEBrick (module)">WEBrick</a></span><span class='op'>::</span><span class='const'><a href="../WEBrick.html#VERSION-constant" title="WEBrick::VERSION (constant)">VERSION</a></span>
  <span class='id identifier rubyid_rubyv'>rubyv</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>RUBY_VERSION</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='const'>RUBY_RELEASE_DATE</span><span class='embexpr_end'>}</span><span class='tstring_content'>) [</span><span class='embexpr_beg'>#{</span><span class='const'>RUBY_PLATFORM</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WEBrick </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_webrickv'>webrickv</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ruby </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rubyv'>rubyv</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@listeners</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@shutdown_pipe</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>unless</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>DoNotListen</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Listen</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:Listen option is deprecated; use GenericServer#listen</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span><span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>BindAddress</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Port</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Port</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Port</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@listeners</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="config-instance_method">
  <h3 class='signature ro first'>
  #<strong>config</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>The server configuration</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L73-L73'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


73</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 73</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'>config</span>
</pre>
  </div>
</div>
</section>
<section class='method_details' id="listeners-instance_method">
  <h3 class='signature ro'>
  #<strong>listeners</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>Sockets listening for connections.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L89-L89'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


89</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 89</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_listeners'>listeners</span>
</pre>
  </div>
</div>
</section>
<section class='method_details' id="logger-instance_method">
  <h3 class='signature ro'>
  #<strong>logger</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>The server logger.  This is independent from the HTTP access log.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L78-L78'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


78</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 78</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_logger'>logger</span>
</pre>
  </div>
</div>
</section>
<section class='method_details' id="status-instance_method">
  <h3 class='signature ro'>
  #<strong>status</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>The server status.  One of :Stop, :Running or :Shutdown</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L68-L68'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


68</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 68</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span>
</pre>
  </div>
</div>
</section>
<section class='method_details' id="tokens-instance_method">
  <h3 class='signature ro'>
  #<strong>tokens</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>Tokens control the number of outstanding clients.  The
<code>:MaxClients</code> configuration sets this.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L84-L84'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


84</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 84</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tokens'>tokens</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="[]-instance_method">
  <h3 class='signature  first'>
  #<strong>[]</strong>(key)  
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>Retrieves <tt>key</tt>+ from the configuration</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L125-L127'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


125
126
127</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 125</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<section class='method_details' id="run-instance_method">
  <h3 class='signature '>
  #<strong>run</strong>(sock)  
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>You must subclass <code>GenericServer</code> and implement #run which
accepts a TCP client socket</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L248-L250'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


248
249
250</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 248</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_fatal'>fatal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>run() must be provided by user.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<section class='method_details' id="shutdown-instance_method">
  <h3 class='signature '>
  #<strong>shutdown</strong>  
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>Shuts down the server and all listening sockets.  New listeners must be
provided to restart the server.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L238-L242'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


238
239
240
241
242</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 238</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_shutdown'>shutdown</span>
  <span class='id identifier rubyid_stop'>stop</span>

  <span class='id identifier rubyid_alarm_shutdown_pipe'>alarm_shutdown_pipe</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span><span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<section class='method_details' id="start-instance_method">
  <h3 class='signature '>
  #<strong>start</strong>(&amp;block)  
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>Starts the server and runs the <tt>block</tt>+ for each connection.  This method
does not return until the server is stopped from a signal handler or
another thread using <a href="#stop-instance_method" title="WEBrick::GenericServer#stop (method)">#stop</a> or <a href="#shutdown-instance_method" title="WEBrick::GenericServer#shutdown (method)">#shutdown</a>.</p>

<p>If the block raises a subclass of StandardError the exception is logged and
ignored.  If an IOError or <tt>Errno::EBADF</tt> exception is raised the exception
is ignored.  If an Exception subclass is raised the exception is logged and
re-raised which stops the server.</p>

<p>To completely shut down a server call <a href="#shutdown-instance_method" title="WEBrick::GenericServer#shutdown (method)">#shutdown</a> from ensure:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='const'><a href="../WEBrick.html" title="WEBrick (module)">WEBrick</a></span><span class='op'>::</span><span class='const'>GenericServer</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="WEBrick::GenericServer.new (method)">new</a></span>
<span class='comment'># or WEBrick::HTTPServer.new
</span>
<span class='kw'>begin</span>
  <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_shutdown'>shutdown</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ServerError.html" title="WEBrick::ServerError (class)">ServerError</a>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L158-L221'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 158</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ServerError.html" title="WEBrick::ServerError (class)">ServerError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>already started.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@status</span> <span class='op'>!=</span> <span class='symbeg'>:</span><span class='const'>Stop</span>
  <span class='id identifier rubyid_server_type'>server_type</span> <span class='op'>=</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>ServerType</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><a href="SimpleServer.html" title="WEBrick::SimpleServer (class)">SimpleServer</a></span>

  <span class='id identifier rubyid_setup_shutdown_pipe'>setup_shutdown_pipe</span>

  <span class='id identifier rubyid_server_type'>server_type</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lbrace'>{</span>
    <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>#start: pid=</span><span class='embexpr_beg'>#{</span><span class='gvar'>$$</span><span class='embexpr_end'>}</span><span class='tstring_content'> port=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Port</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_call_callback'>call_callback</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='const'>StartCallback</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_shutdown_pipe'>shutdown_pipe</span> <span class='op'>=</span> <span class='ivar'>@shutdown_pipe</span>

    <span class='id identifier rubyid_thgroup'>thgroup</span> <span class='op'>=</span> <span class='const'>ThreadGroup</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Running</span>
    <span class='kw'>begin</span>
      <span class='kw'>while</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='const'>Running</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_sp'>sp</span> <span class='op'>=</span> <span class='id identifier rubyid_shutdown_pipe'>shutdown_pipe</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_svrs'>svrs</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_sp'>sp</span><span class='comma'>,</span> <span class='op'>*</span><span class='ivar'>@listeners</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='float'>2.0</span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_svrs'>svrs</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_sp'>sp</span>
              <span class='comment'># swallow shutdown pipe
</span>              <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='const'>String</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
              <span class='kw'>nil</span> <span class='kw'>while</span> <span class='const'>String</span> <span class='op'>===</span>
                        <span class='id identifier rubyid_sp'>sp</span><span class='period'>.</span><span class='id identifier rubyid_read_nonblock'>read_nonblock</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_sp'>sp</span><span class='period'>.</span><span class='id identifier rubyid_nread'>nread</span><span class='comma'>,</span> <span class='int'>8</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span><span class='comma'>,</span> <span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='kw'>break</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_svrs'>svrs</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_svr'>svr</span><span class='op'>|</span>
              <span class='ivar'>@tokens</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>          <span class='comment'># blocks while no token is there.
</span>              <span class='kw'>if</span> <span class='id identifier rubyid_sock'>sock</span> <span class='op'>=</span> <span class='id identifier rubyid_accept_client'>accept_client</span><span class='lparen'>(</span><span class='id identifier rubyid_svr'>svr</span><span class='rparen'>)</span>
                <span class='kw'>unless</span> <span class='id identifier rubyid_config'>config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>DoNotReverseLookup</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                  <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span> <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_config'>config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>DoNotReverseLookup</span><span class='rbracket'>]</span>
                <span class='kw'>end</span>
                <span class='id identifier rubyid_th'>th</span> <span class='op'>=</span> <span class='id identifier rubyid_start_thread'>start_thread</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_th'>th</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>WEBrickThread</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
                <span class='id identifier rubyid_thgroup'>thgroup</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_th'>th</span><span class='rparen'>)</span>
              <span class='kw'>else</span>
                <span class='ivar'>@tokens</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
              <span class='kw'>end</span>
            <span class='rbrace'>}</span>
          <span class='kw'>end</span>
        <span class='kw'>rescue</span> <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'>EBADF</span><span class='comma'>,</span> <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'>ENOTSOCK</span><span class='comma'>,</span> <span class='const'>IOError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
          <span class='comment'># if the listening socket was closed in GenericServer#shutdown,
</span>          <span class='comment'># IO::select raise it.
</span>        <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
          <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='id identifier rubyid_msg'>msg</span>
        <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
          <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_fatal'>fatal</span> <span class='id identifier rubyid_ex'>ex</span>
          <span class='id identifier rubyid_raise'>raise</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_cleanup_shutdown_pipe'>cleanup_shutdown_pipe</span><span class='lparen'>(</span><span class='id identifier rubyid_shutdown_pipe'>shutdown_pipe</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cleanup_listener'>cleanup_listener</span>
      <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Shutdown</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>going to shutdown ...</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_thgroup'>thgroup</span><span class='period'>.</span><span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_th'>th</span><span class='op'>|</span> <span class='id identifier rubyid_th'>th</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='kw'>if</span> <span class='id identifier rubyid_th'>th</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>WEBrickThread</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_call_callback'>call_callback</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='const'>StopCallback</span><span class='rparen'>)</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>#start done.</span><span class='tstring_end'>&quot;</span></span>
      <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Stop</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<section class='method_details' id="stop-instance_method">
  <h3 class='signature '>
  #<strong>stop</strong>  
</h3>

<div class='docstring'>
  <div class='discussion'>
    
<p>Stops the server from accepting new connections.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/ruby_2_3/lib/webrick/server.rb#L226-L232'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


226
227
228
229
230
231
232</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 226</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
  <span class='kw'>if</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='const'>Running</span>
    <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Shutdown</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_alarm_shutdown_pipe'>alarm_shutdown_pipe</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_write_nonblock'>write_nonblock</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\0</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.3.2p182)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>