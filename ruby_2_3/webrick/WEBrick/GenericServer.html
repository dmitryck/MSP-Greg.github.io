<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: WEBrick::GenericServer &mdash; webrick  Ruby-2.3.3 p222</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "WEBrick::GenericServer",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
        <a href='../../../index.html'>Home</a> &raquo; 
        <a href='../../index.html'>Ruby-2.3.3</a> &raquo; 
        <a href='../index.html'>webrick</a> &raquo; 
        <a href='../_index.html#alpha_G'>Index (G)</a> &raquo; 
        <a href="../WEBrick.html" title="WEBrick (module)">WEBrick</a> &raquo; 
        <span class='title'><a id='t2_doc_top' href='#'>GenericServer&nbsp;&#x25B2;</a></span>
      </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: WEBrick::GenericServer</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a href="HTTPProxyServer.html" title="WEBrick::HTTPProxyServer (class)">HTTPProxyServer</a>, <a href="HTTPServer.html" title="WEBrick::HTTPServer (class)">HTTPServer</a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/ssl.rb#L138'>lib/webrick/ssl.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L63'>lib/webrick/server.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Base TCP server class.  You must subclass <code>GenericServer</code> and
provide a <a href="#run-instance_method" title="WEBrick::GenericServer#run (method)">#run</a> method.</p>

  </div>
</div>
</div>        

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(config = {}, default = Config::General)  &#x21d2; GenericServer </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new generic server from <a href="#config-instance_method" title="WEBrick::GenericServer#config (method)">#config</a>.</p></div>
    </div>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#config-instance_method" title="#config (instance method)">#<strong>config</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>The server configuration.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#listeners-instance_method" title="#listeners (instance method)">#<strong>listeners</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sockets listening for connections.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#logger-instance_method" title="#logger (instance method)">#<strong>logger</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>The server logger.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#status-instance_method" title="#status (instance method)">#<strong>status</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>The server status.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#tokens-instance_method" title="#tokens (instance method)">#<strong>tokens</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Tokens control the number of outstanding clients.</p></div>
    </div>
  </li>
</ul>
</div>
        

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(key)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Retrieves <code>key</code> from the configuration.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#run-instance_method" title="#run (instance method)">#<strong>run</strong>(sock)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>You must subclass <code>GenericServer</code> and implement #run which
accepts a TCP client socket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#shutdown-instance_method" title="#shutdown (instance method)">#<strong>shutdown</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Shuts down the server and all listening sockets.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#start-instance_method" title="#start (instance method)">#<strong>start</strong>(&amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Starts the server and runs the <code>block</code> for each connection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stop-instance_method" title="#stop (instance method)">#<strong>stop</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Stops the server from accepting new connections.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#accept_client-instance_method" title="#accept_client (instance method)">#<strong>accept_client</strong>(svr)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Accepts a TCP client socket from the TCP server socket <code>svr</code> and returns
the client socket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#alarm_shutdown_pipe-instance_method" title="#alarm_shutdown_pipe (instance method)">#<strong>alarm_shutdown_pipe</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#call_callback-instance_method" title="#call_callback (instance method)">#<strong>call_callback</strong>(callback_name, *args)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Calls the callback <code>callback_name</code> from the configuration with <code>args</code></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#cleanup_listener-instance_method" title="#cleanup_listener (instance method)">#<strong>cleanup_listener</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#cleanup_shutdown_pipe-instance_method" title="#cleanup_shutdown_pipe (instance method)">#<strong>cleanup_shutdown_pipe</strong>(shutdown_pipe)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#setup_shutdown_pipe-instance_method" title="#setup_shutdown_pipe (instance method)">#<strong>setup_shutdown_pipe</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#start_thread-instance_method" title="#start_thread (instance method)">#<strong>start_thread</strong>(sock, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Starts a server thread for the client socket <code>sock</code> that runs the given
<code>block</code>.</p></div>
    </div>
  </li>
</ul>
</div>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(config = {}, default = Config::General)  &#x21d2; <code>GenericServer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a new generic server from <a href="#config-instance_method" title="WEBrick::GenericServer#config (method)">#config</a>.  The default configuration
comes from <code>default</code>.</p>

  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L95-L120'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 95</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_config'>config</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_default'>default</span><span class='op'>=</span><span class='const'>Config</span><span class='op'>::</span><span class='const'>General</span><span class='rparen'>)</span>
  <span class='ivar'>@config</span> <span class='op'>=</span> <span class='id identifier rubyid_default'>default</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_config'>config</span><span class='rparen'>)</span>
  <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Stop</span>
  <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Logger</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><a href="Log.html" title="WEBrick::Log (class)">Log</a></span><span class='op'>::</span><span class='id identifier rubyid_new'><a href="Log.html#new-class_method" title="WEBrick::Log.new (method)">new</a></span>
  <span class='ivar'>@logger</span> <span class='op'>=</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Logger</span><span class='rbracket'>]</span>

  <span class='ivar'>@tokens</span> <span class='op'>=</span> <span class='const'>SizedQueue</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>MaxClients</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>MaxClients</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='lbrace'>{</span> <span class='ivar'>@tokens</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_webrickv'>webrickv</span> <span class='op'>=</span> <span class='const'><a href="../WEBrick.html" title="WEBrick (module)">WEBrick</a></span><span class='op'>::</span><span class='const'><a href="../WEBrick.html#VERSION-constant" title="WEBrick::VERSION (constant)">VERSION</a></span>
  <span class='id identifier rubyid_rubyv'>rubyv</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>RUBY_VERSION</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='const'>RUBY_RELEASE_DATE</span><span class='embexpr_end'>}</span><span class='tstring_content'>) [</span><span class='embexpr_beg'>#{</span><span class='const'>RUBY_PLATFORM</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WEBrick </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_webrickv'>webrickv</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ruby </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rubyv'>rubyv</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='ivar'>@listeners</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@shutdown_pipe</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>unless</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>DoNotListen</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Listen</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:Listen option is deprecated; use GenericServer#listen</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span><span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>BindAddress</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Port</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Port</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Port</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@listeners</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="config-instance_method">
  <h3 class='signature ro first'>
    #<strong>config</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The server configuration</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L73-L73'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


73</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 73</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_config'>config</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="listeners-instance_method">
  <h3 class='signature ro'>
    #<strong>listeners</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sockets listening for connections.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L89-L89'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


89</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 89</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_listeners'>listeners</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="logger-instance_method">
  <h3 class='signature ro'>
    #<strong>logger</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The server logger.  This is independent from the HTTP access log.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L78-L78'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


78</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 78</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_logger'>logger</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="status-instance_method">
  <h3 class='signature ro'>
    #<strong>status</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The server status.  One of :Stop, :Running or :Shutdown</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L68-L68'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


68</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 68</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="tokens-instance_method">
  <h3 class='signature ro'>
    #<strong>tokens</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Tokens control the number of outstanding clients.  The
<code>:MaxClients</code> configuration sets this.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L84-L84'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


84</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 84</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tokens'>tokens</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="[]-instance_method">
  <h3 class='signature  first'>
    #<strong>[]</strong>(key)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Retrieves <code>key</code> from the configuration</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L125-L127'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


125
126
127</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 125</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="accept_client-instance_method">
  <h3 class='signature priv'>
    #<strong>accept_client</strong>(svr)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Accepts a TCP client socket from the TCP server socket <code>svr</code> and returns
the client socket.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L260-L273'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


260
261
262
263
264
265
266
267
268
269
270
271
272
273</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 260</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_accept_client'>accept_client</span><span class='lparen'>(</span><span class='id identifier rubyid_svr'>svr</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sock'>sock</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_sock'>sock</span> <span class='op'>=</span> <span class='id identifier rubyid_svr'>svr</span><span class='period'>.</span><span class='id identifier rubyid_accept'>accept</span>
    <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='const'><a href="Utils.html" title="WEBrick::Utils (module)">Utils</a></span><span class='op'>::</span><span class='id identifier rubyid_set_non_blocking'><a href="Utils.html#set_non_blocking-class_method" title="WEBrick::Utils.set_non_blocking (method)">set_non_blocking</a></span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'><a href="../Errno/ECONNRESET.html" title="Errno::ECONNRESET (class)">ECONNRESET</a></span><span class='comma'>,</span> <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'><a href="../Errno/ECONNABORTED.html" title="Errno::ECONNABORTED (class)">ECONNABORTED</a></span><span class='comma'>,</span>
         <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'><a href="../Errno/EPROTO.html" title="Errno::EPROTO (class)">EPROTO</a></span><span class='comma'>,</span> <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'>EINVAL</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
    <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='id identifier rubyid_msg'>msg</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_sock'>sock</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="alarm_shutdown_pipe-instance_method">
  <h3 class='signature priv'>
    #<strong>alarm_shutdown_pipe</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L346-L356'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


346
347
348
349
350
351
352
353
354
355
356</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 346</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_alarm_shutdown_pipe'>alarm_shutdown_pipe</span>
  <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_pipe'>pipe</span> <span class='op'>=</span> <span class='ivar'>@shutdown_pipe</span> <span class='comment'># another thread may modify @shutdown_pipe.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_pipe'>pipe</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pipe'>pipe</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
      <span class='kw'>begin</span>
        <span class='kw'>yield</span> <span class='id identifier rubyid_pipe'>pipe</span>
      <span class='kw'>rescue</span> <span class='const'>IOError</span> <span class='comment'># closed by another thread.
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="call_callback-instance_method">
  <h3 class='signature priv'>
    #<strong>call_callback</strong>(callback_name, *args)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Calls the callback <code>callback_name</code> from the configuration with <code>args</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L320-L324'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


320
321
322
323
324</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 320</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_call_callback'>call_callback</span><span class='lparen'>(</span><span class='id identifier rubyid_callback_name'>callback_name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_cb'>cb</span> <span class='op'>=</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='id identifier rubyid_callback_name'>callback_name</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_cb'>cb</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cleanup_listener-instance_method">
  <h3 class='signature priv'>
    #<strong>cleanup_listener</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L358-L378'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 358</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cleanup_listener'>cleanup_listener</span>
  <span class='ivar'>@listeners</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug?'>debug?</span>
      <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_addr'>addr</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>close TCPSocket(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_shutdown'>shutdown</span>
    <span class='kw'>rescue</span> <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'>ENOTCONN</span>
      <span class='comment'># when `Errno::ENOTCONN: Socket is not connected&#39; on some platforms,
</span>      <span class='comment'># call #close instead of #shutdown.
</span>      <span class='comment'># (ignore @config[:ShutdownSocketWithoutClose])
</span>      <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>else</span>
      <span class='kw'>unless</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>ShutdownSocketWithoutClose</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@listeners</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cleanup_shutdown_pipe-instance_method">
  <h3 class='signature priv'>
    #<strong>cleanup_shutdown_pipe</strong>(shutdown_pipe)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L333-L344'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


333
334
335
336
337
338
339
340
341
342
343
344</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 333</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cleanup_shutdown_pipe'>cleanup_shutdown_pipe</span><span class='lparen'>(</span><span class='id identifier rubyid_shutdown_pipe'>shutdown_pipe</span><span class='rparen'>)</span>
  <span class='ivar'>@shutdown_pipe</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_shutdown_pipe'>shutdown_pipe</span>
  <span class='id identifier rubyid_shutdown_pipe'>shutdown_pipe</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
      <span class='kw'>rescue</span> <span class='const'>IOError</span> <span class='comment'># another thread closed io.
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run-instance_method">
  <h3 class='signature '>
    #<strong>run</strong>(sock)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>You must subclass <code>GenericServer</code> and implement #run which
accepts a TCP client socket</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L248-L250'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


248
249
250</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 248</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_fatal'>fatal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>run() must be provided by user.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setup_shutdown_pipe-instance_method">
  <h3 class='signature priv'>
    #<strong>setup_shutdown_pipe</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L326-L331'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


326
327
328
329
330
331</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 326</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_shutdown_pipe'>setup_shutdown_pipe</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@shutdown_pipe</span>
    <span class='ivar'>@shutdown_pipe</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_pipe'>pipe</span>
  <span class='kw'>end</span>
  <span class='ivar'>@shutdown_pipe</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shutdown-instance_method">
  <h3 class='signature '>
    #<strong>shutdown</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Shuts down the server and all listening sockets.  New listeners must be
provided to restart the server.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L238-L242'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


238
239
240
241
242</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 238</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_shutdown'>shutdown</span>
  <span class='id identifier rubyid_stop'>stop</span>

  <span class='id identifier rubyid_alarm_shutdown_pipe'>alarm_shutdown_pipe</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span><span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="start-instance_method">
  <h3 class='signature '>
    #<strong>start</strong>(&amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Starts the server and runs the <code>block</code> for each connection.  This method
does not return until the server is stopped from a signal handler or
another thread using <a href="#stop-instance_method" title="WEBrick::GenericServer#stop (method)">#stop</a> or <a href="#shutdown-instance_method" title="WEBrick::GenericServer#shutdown (method)">#shutdown</a>.</p>

<p>If the block raises a subclass of StandardError the exception is logged and
ignored.  If an IOError or <code>Errno::EBADF</code> exception is raised the exception
is ignored.  If an Exception subclass is raised the exception is logged and
re-raised which stops the server.</p>

<p>To completely shut down a server call <a href="#shutdown-instance_method" title="WEBrick::GenericServer#shutdown (method)">#shutdown</a> from ensure:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='const'><a href="../WEBrick.html" title="WEBrick (module)">WEBrick</a></span><span class='op'>::</span><span class='const'>GenericServer</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="WEBrick::GenericServer.new (method)">new</a></span>
<span class='comment'># or WEBrick::HTTPServer.new
</span>
<span class='kw'>begin</span>
  <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_shutdown'>shutdown</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ServerError.html" title="WEBrick::ServerError (class)">ServerError</a>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L158-L221'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 158</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ServerError.html" title="WEBrick::ServerError (class)">ServerError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>already started.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@status</span> <span class='op'>!=</span> <span class='symbeg'>:</span><span class='const'>Stop</span>
  <span class='id identifier rubyid_server_type'>server_type</span> <span class='op'>=</span> <span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>ServerType</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><a href="SimpleServer.html" title="WEBrick::SimpleServer (class)">SimpleServer</a></span>

  <span class='id identifier rubyid_setup_shutdown_pipe'>setup_shutdown_pipe</span>

  <span class='id identifier rubyid_server_type'>server_type</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lbrace'>{</span>
    <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>#start: pid=</span><span class='embexpr_beg'>#{</span><span class='gvar'>$$</span><span class='embexpr_end'>}</span><span class='tstring_content'> port=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>Port</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_call_callback'>call_callback</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='const'>StartCallback</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_shutdown_pipe'>shutdown_pipe</span> <span class='op'>=</span> <span class='ivar'>@shutdown_pipe</span>

    <span class='id identifier rubyid_thgroup'>thgroup</span> <span class='op'>=</span> <span class='const'>ThreadGroup</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Running</span>
    <span class='kw'>begin</span>
      <span class='kw'>while</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='const'>Running</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_sp'>sp</span> <span class='op'>=</span> <span class='id identifier rubyid_shutdown_pipe'>shutdown_pipe</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_svrs'>svrs</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_sp'>sp</span><span class='comma'>,</span> <span class='op'>*</span><span class='ivar'>@listeners</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='float'>2.0</span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_svrs'>svrs</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_sp'>sp</span>
              <span class='comment'># swallow shutdown pipe
</span>              <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='const'>String</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
              <span class='kw'>nil</span> <span class='kw'>while</span> <span class='const'>String</span> <span class='op'>===</span>
                        <span class='id identifier rubyid_sp'>sp</span><span class='period'>.</span><span class='id identifier rubyid_read_nonblock'>read_nonblock</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_sp'>sp</span><span class='period'>.</span><span class='id identifier rubyid_nread'>nread</span><span class='comma'>,</span> <span class='int'>8</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span><span class='comma'>,</span> <span class='id identifier rubyid_buf'>buf</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>false</span><span class='rparen'>)</span>
              <span class='kw'>break</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_svrs'>svrs</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_svr'>svr</span><span class='op'>|</span>
              <span class='ivar'>@tokens</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>          <span class='comment'># blocks while no token is there.
</span>              <span class='kw'>if</span> <span class='id identifier rubyid_sock'>sock</span> <span class='op'>=</span> <span class='id identifier rubyid_accept_client'>accept_client</span><span class='lparen'>(</span><span class='id identifier rubyid_svr'>svr</span><span class='rparen'>)</span>
                <span class='kw'>unless</span> <span class='id identifier rubyid_config'>config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>DoNotReverseLookup</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                  <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span> <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_config'>config</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>DoNotReverseLookup</span><span class='rbracket'>]</span>
                <span class='kw'>end</span>
                <span class='id identifier rubyid_th'>th</span> <span class='op'>=</span> <span class='id identifier rubyid_start_thread'>start_thread</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_th'>th</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>WEBrickThread</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
                <span class='id identifier rubyid_thgroup'>thgroup</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_th'>th</span><span class='rparen'>)</span>
              <span class='kw'>else</span>
                <span class='ivar'>@tokens</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
              <span class='kw'>end</span>
            <span class='rbrace'>}</span>
          <span class='kw'>end</span>
        <span class='kw'>rescue</span> <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'>EBADF</span><span class='comma'>,</span> <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'>ENOTSOCK</span><span class='comma'>,</span> <span class='const'>IOError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
          <span class='comment'># if the listening socket was closed in GenericServer#shutdown,
</span>          <span class='comment'># IO::select raise it.
</span>        <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
          <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='id identifier rubyid_msg'>msg</span>
        <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
          <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_fatal'>fatal</span> <span class='id identifier rubyid_ex'>ex</span>
          <span class='id identifier rubyid_raise'>raise</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_cleanup_shutdown_pipe'>cleanup_shutdown_pipe</span><span class='lparen'>(</span><span class='id identifier rubyid_shutdown_pipe'>shutdown_pipe</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cleanup_listener'>cleanup_listener</span>
      <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Shutdown</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>going to shutdown ...</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_thgroup'>thgroup</span><span class='period'>.</span><span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_th'>th</span><span class='op'>|</span> <span class='id identifier rubyid_th'>th</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='kw'>if</span> <span class='id identifier rubyid_th'>th</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>WEBrickThread</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_call_callback'>call_callback</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='const'>StopCallback</span><span class='rparen'>)</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>#start done.</span><span class='tstring_end'>&quot;</span></span>
      <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Stop</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="start_thread-instance_method">
  <h3 class='signature priv'>
    #<strong>start_thread</strong>(sock, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Starts a server thread for the client socket <code>sock</code> that runs the given
<code>block</code>.</p>

<p>Sets the socket to the <code>:WEBrickSocket</code> thread local variable in
the thread.</p>

<p>If any errors occur in the block they are logged and handled.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L284-L315'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 284</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_start_thread'>start_thread</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lbrace'>{</span>
    <span class='kw'>begin</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>WEBrickSocket</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_peeraddr'>peeraddr</span>
        <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>accept: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>rescue</span> <span class='const'>SocketError</span>
        <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>accept: &lt;address unknown&gt;</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_raise'>raise</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_call_callback'>call_callback</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='const'>AcceptCallback</span><span class='comma'>,</span> <span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_block'>block</span> <span class='op'>?</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'><a href="../Errno.html" title="Errno (module)">Errno</a></span><span class='op'>::</span><span class='const'>ENOTCONN</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Errno::ENOTCONN raised</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>rescue</span> <span class='const'><a href="ServerError.html" title="WEBrick::ServerError (class)">ServerError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ex'>ex</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ex'>ex</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='id identifier rubyid_ex'>ex</span>
    <span class='kw'>ensure</span>
      <span class='ivar'>@tokens</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='const'>WEBrickSocket</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span>
        <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>close: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>else</span>
        <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>close: &lt;address unknown&gt;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>unless</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stop-instance_method">
  <h3 class='signature '>
    #<strong>stop</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Stops the server from accepting new connections.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v2_3_3/lib/webrick/server.rb#L226-L232'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


226
227
228
229
230
231
232</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/webrick/server.rb', line 226</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
  <span class='kw'>if</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='const'>Running</span>
    <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='const'>Shutdown</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_alarm_shutdown_pipe'>alarm_shutdown_pipe</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_write_nonblock'>write_nonblock</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\0</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.8 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.9.0 (ruby-2.5.0p-1)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>